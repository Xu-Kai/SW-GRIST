
module module_ra_rrtm_v2
use grist_constants,    only: r4

! parameters

      integer, private :: idata
      integer, parameter :: mg=16 
      integer, parameter :: nbands=16
      integer, parameter :: ngpt=140
      integer, parameter :: ng1=8
      integer, parameter :: ng2=14
      integer, parameter :: ng3=16
      integer, parameter :: ng4=14
      integer, parameter :: ng5=16 
      integer, parameter :: ng6=8
      integer, parameter :: ng7=12
      integer, parameter :: ng8=8
      integer, parameter :: ng9=12
      integer, parameter :: ng10=6 
      integer, parameter :: ng11=8
      integer, parameter :: ng12=8
      integer, parameter :: ng13=4
      integer, parameter :: ng14=2
      integer, parameter :: ng15=2
      integer, parameter :: ng16=2
      integer, parameter :: maxinpx=35
      integer, parameter :: maxxsec=4

      integer, parameter :: nmol = 6
      real, parameter :: oneminus = 1. - 1.e-6

! var

      real    , save    :: fluxfac
      integer , save    :: nlayers
!
! data 1
!
      real,save ::  abscoefl1(5,13,mg),    abscoefh1(5,13:59,mg),   &
                    selfref1(10,mg)
      real,save ::  abscoefl2(5,13,mg),    abscoefh2(5,13:59,mg),   &
                    selfref2(10,mg)
      real,save ::  abscoefl3(10,5,13,mg), abscoefh3(5,5,13:59,mg), &
                    selfref3(10,mg)
      real,save ::  abscoefl4(9,5,13,mg),  abscoefh4(6,5,13:59,mg), &
                    selfref4(10,mg)
      real,save ::  abscoefl5(9,5,13,mg),  abscoefh5(5,5,13:59,mg), &
                    selfref5(10,mg)
      real,save ::  abscoefl6(5,13,mg),    selfref6(10,mg)
      real,save ::  abscoefl7(9,5,13,mg),  abscoefh7(5,13:59,mg),   &
                    selfref7(10,mg)
      real,save ::  abscoefl8(5,7,mg),     abscoefh8(5,7:59,mg),    &
                    selfref8(10,mg)
      real,save ::  abscoefl9(11,5,13,mg), abscoefh9(5,13:59,mg),   &
                    selfref9(10,mg)
      real,save ::  abscoefl10(5,13,mg),   abscoefh10(5,13:59,mg)  
      real,save ::  abscoefl11(5,13,mg),   abscoefh11(5,13:59,mg),  &
                    selfref11(10,mg)
      real,save ::  abscoefl12(9,5,13,mg), selfref12(10,mg)
      real,save ::  abscoefl13(9,5,13,mg), selfref13(10,mg)
      real,save ::  abscoefl14(5,13,mg),   abscoefh14(5,13:59,mg),  &
                    selfref14(10,mg)
      real,save ::  abscoefl15(9,5,13,mg), selfref15(10,mg)
      real,save ::  abscoefl16(9,5,13,mg), selfref16(10,mg)
!
! below data are for read, because the above will be converted to r8
!
      real(r4),save ::  abscoefl1_r4(5,13,mg),    abscoefh1_r4(5,13:59,mg),   selfref1_r4(10,mg)
      real(r4),save ::  abscoefl2_r4(5,13,mg),    abscoefh2_r4(5,13:59,mg),   selfref2_r4(10,mg)
      real(r4),save ::  abscoefl3_r4(10,5,13,mg), abscoefh3_r4(5,5,13:59,mg), selfref3_r4(10,mg)
      real(r4),save ::  abscoefl4_r4(9,5,13,mg),  abscoefh4_r4(6,5,13:59,mg), selfref4_r4(10,mg)
      real(r4),save ::  abscoefl5_r4(9,5,13,mg),  abscoefh5_r4(5,5,13:59,mg), selfref5_r4(10,mg)
      real(r4),save ::  abscoefl6_r4(5,13,mg),                                selfref6_r4(10,mg)
      real(r4),save ::  abscoefl7_r4(9,5,13,mg),  abscoefh7_r4(5,13:59,mg),   selfref7_r4(10,mg)
      real(r4),save ::  abscoefl8_r4(5,7,mg),     abscoefh8_r4(5,7:59,mg),    selfref8_r4(10,mg)
      real(r4),save ::  abscoefl9_r4(11,5,13,mg), abscoefh9_r4(5,13:59,mg),   selfref9_r4(10,mg)
      real(r4),save ::  abscoefl10_r4(5,13,mg),   abscoefh10_r4(5,13:59,mg)
      real(r4),save ::  abscoefl11_r4(5,13,mg),   abscoefh11_r4(5,13:59,mg),  selfref11_r4(10,mg)
      real(r4),save ::  abscoefl12_r4(9,5,13,mg),                             selfref12_r4(10,mg)
      real(r4),save ::  abscoefl13_r4(9,5,13,mg),                             selfref13_r4(10,mg)
      real(r4),save ::  abscoefl14_r4(5,13,mg),   abscoefh14_r4(5,13:59,mg),  selfref14_r4(10,mg)
      real(r4),save ::  abscoefl15_r4(9,5,13,mg),                             selfref15_r4(10,mg)
      real(r4),save ::  abscoefl16_r4(9,5,13,mg),                             selfref16_r4(10,mg)
!
! data 2
!
      integer,save ::  ngm(mg*nbands), ngc(nbands), ngs(nbands),       &
                    ngn(ngpt), ngb(ngpt)
      real,save ::  wt(mg)
!
! data 3
!
      real,save ::  fracrefa1(mg), fracrefb1(mg), forref1(mg)   
      real,save ::  fracrefa2(mg,13), fracrefb2(mg), forref2(mg)
      real,save ::  fracrefa3(mg,10), fracrefb3(mg,5)        
      real,save ::  forref3(mg), absn2oa3(mg), absn2ob3(mg)   
      real,save ::  fracrefa4(mg,9), fracrefb4(mg,6)        
      real,save ::  fracrefa5(mg,9), fracrefb5(mg,5), ccl45(mg) 
      real,save ::  fracrefa6(mg), absco26(mg), cfc11adj6(mg), cfc126(mg)    
      real,save ::  fracrefa7(mg,9), fracrefb7(mg), absco27(mg)        
      real,save ::  fracrefa8(mg), fracrefb8(mg), absco2a8(mg), absco2b8(mg)
      real,save ::  absn2oa8(mg), absn2ob8(mg), cfc128(mg), cfc22adj8(mg)  
      real,save ::  fracrefa9(mg,9), fracrefb9(mg), absn2o9(3*mg)
      real,save ::  fracrefa10(mg), fracrefb10(mg)        
      real,save ::  fracrefa11(mg), fracrefb11(mg)        
      real,save ::  fracrefa12(mg,9)        
      real,save ::  fracrefa13(mg,9)        
      real,save ::  fracrefa14(mg), fracrefb14(mg)
      real,save ::  fracrefa15(mg,9)
      real,save ::  fracrefa16(mg,9)
!
! data 4
!
      integer,save :: nxmol, ixindx(maxinpx)

! data 5 

      real,save    :: wavenum1(nbands),wavenum2(nbands),delwave(nbands)

! data 6

      integer,save :: ng(nbands),nspa(nbands),nspb(nbands)
      real,   save :: heatfac
      real,   save :: pref(59),preflog(59),tref(59)

! data 7 

      real,   save :: totplnk(181,nbands), totplk16(181)

! data

      real,    save :: tau(0:5000),tf(0:5000),trans(0:5000)
!
      real,    save :: absa1(5*13,ng1), absb1(5*(59-13+1),ng1),         &
                       selfrefc1(10,ng1), forrefc1(ng1)
      real,    save :: absa2(5*13,ng2), absb2(5*(59-13+1),ng2),         &
                       selfrefc2(10,ng2), forrefc2(ng2)
      real,    save :: absa3(10*5*13,ng3), absb3(5*5*(59-13+1),ng3),    &     
                       selfrefc3(10,ng3), forrefc3(ng3),                &
                       absn2oac3(ng3), absn2obc3(ng3)        
      real,    save :: absa4(9*5*13,ng4), absb4(6*5*(59-13+1),ng4),     &
                       selfrefc4(10,ng4)        
      real,    save :: absa5(9*5*13,ng5), absb5(5*5*(59-13+1),ng5),     &
                       selfrefc5(10,ng5), ccl4c5(ng5)        
      real,    save :: absa6(5*13,ng6), selfrefc6(10,ng6),              &        
                       absco2c6(ng6), cfc11adjc6(ng6), cfc12c6(ng6)  
      real,    save :: absa7(9*5*13,ng7), absb7(5*(59-13+1),ng7),       &  
                       selfrefc7(10,ng7), absco2c7(ng7)        
      real,    save :: absa8(5*7,ng8), absb8(5*(59-7+1),ng8),           &
                       selfrefc8(10,ng8),                               &
                       absco2ac8(ng8), absco2bc8(ng8),                  &
                       absn2oac8(ng8), absn2obc8(ng8),                  &       
                       cfc12c8(ng8), cfc22adjc8(ng8)      
      real,    save :: absa9(11*5*13,ng9), absb9(5*(59-13+1),ng9),      &
                       selfrefc9(10,ng9), absn2oc9(3*ng9)
      real,    save :: absa10(5*13,ng10), absb10(5*(59-13+1),ng10)
      real,    save :: absa11(5*13,ng11), absb11(5*(59-13+1),ng11),     &
                       selfrefc11(10,ng11)
      real,    save :: absa12(9*5*13,ng12), selfrefc12(10,ng12)
      real,    save :: absa13(9*5*13,ng13), selfrefc13(10,ng13)
      real,    save :: absa14(5*13,ng14), absb14(5*(59-13+1),ng14),    &
                       selfrefc14(10,ng14)
      real,    save :: absa15(9*5*13,ng15), selfrefc15(10,ng15)
      real,    save :: absa16(9*5*13,ng16), selfrefc16(10,ng16)

      real,    save :: fracrefac1(ng1), fracrefbc1(ng1)
      real,    save :: fracrefac2(ng2,13), fracrefbc2(ng2)
      real,    save :: fracrefac3(ng3,10), fracrefbc3(ng3,5)
      real,    save :: fracrefac4(ng4,9), fracrefbc4(ng4,6)
      real,    save :: fracrefac5(ng5,9), fracrefbc5(ng5,5)      
      real,    save :: fracrefac6(ng6)                              
      real,    save :: fracrefac7(ng7,9), fracrefbc7(ng7)    
      real,    save :: fracrefac8(ng8), fracrefbc8(ng8)  
      real,    save :: fracrefac9(ng9,9), fracrefbc9(ng9)      
      real,    save :: fracrefac10(ng10), fracrefbc10(ng10)       
      real,    save :: fracrefac11(ng11), fracrefbc11(ng11)  
      real,    save :: fracrefac12(ng12,9)                     
      real,    save :: fracrefac13(ng13,9)           
      real,    save :: fracrefac14(ng14), fracrefbc14(ng14)    
      real,    save :: fracrefac15(ng15,9)                      
      real,    save :: fracrefac16(ng16,9)                 
      
      real,    save :: corr1(0:200),corr2(0:200)
      real,    save :: bpade
      real,    save :: rwgt(mg*nbands)

!----------------------------------------------------------------------------
!
! start data 2
                                                                                 
!     arrays for the g-point reduction from 256 to 140 for the 16 lw bands:      
!     this mapping from 256 to 140 points has been carefully selected to         
!     minimize the effect on the resulting fluxes and cooling rates, and         
!     caution should be used if the mapping is modified.                         
!                                                                                
!     ngpt    the total number of new g-points                                   
!     ngc     the number of new g-points in each band                            
!     ngm     the index of each new g-point relative to the original             
!             16 g-points for each band.                                         
!     ngn     the number of original g-points that are combined to make          
!             each new g-point in each band.                                     
!     ngb     the band index for each new g-point.                               
!     wt      rrtm weights for 16 g-points.                                      
                                                                                 
! data statements                                                                
      data ngc  /8,14,16,14,16,8,12,8,12,6,8,8,4,2,2,2/                          
      data ngs  /8,22,38,52,68,76,88,96,108,114,122,130,134,136,138,140/         
      data ngm  /1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8, &             ! band 1            
                 1,2,3,4,5,6,7,8,9,10,11,12,13,13,14,14, &      ! band 2            
                 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16, &      ! band 3            
                 1,2,3,4,5,6,7,8,9,10,11,12,13,14,14,14, &      ! band 4            
                 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16, &      ! band 5            
                 1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8, &             ! band 6            
                 1,1,2,2,3,4,5,6,7,8,9,10,11,11,12,12, &        ! band 7            
                 1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8, &             ! band 8            
                 1,2,3,4,5,6,7,8,9,9,10,10,11,11,12,12, &       ! band 9            
                 1,1,2,2,3,3,4,4,5,5,5,5,6,6,6,6, &             ! band 10           
                 1,2,3,3,4,4,5,5,6,6,7,7,7,8,8,8, &             ! band 11           
                 1,2,3,4,5,5,6,6,7,7,7,7,8,8,8,8, &             ! band 12           
                 1,1,1,2,2,2,3,3,3,3,4,4,4,4,4,4, &             ! band 13           
                 1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2, &             ! band 14           
                 1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2, &             ! band 15           
                 1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2/               ! band 16           
      data ngn  /2,2,2,2,2,2,2,2, &                             ! band 1            
                 1,1,1,1,1,1,1,1,1,1,1,1,2,2, &                 ! band 2            
                 16*1, &                                        ! band 3            
                 1,1,1,1,1,1,1,1,1,1,1,1,1,3, &                 ! band 4            
                 16*1, &                                        ! band 5            
                 2,2,2,2,2,2,2,2, &                             ! band 6            
                 2,2,1,1,1,1,1,1,1,1,2,2, &                     ! band 7            
                 2,2,2,2,2,2,2,2, &                             ! band 8            
                 1,1,1,1,1,1,1,1,2,2,2,2, &                     ! band 9            
                 2,2,2,2,4,4, &                                 ! band 10           
                 1,1,2,2,2,2,3,3, &                             ! band 11           
                 1,1,1,1,2,2,4,4, &                             ! band 12           
                 3,3,4,6, &                                     ! band 13           
                 8,8, &                                         ! band 14           
                 8,8, &                                         ! band 15           
                 8,8/                                           ! band 16           
      data ngb  /8*1, &                                         ! band 1            
                 14*2, &                                        ! band 2            
                 16*3, &                                        ! band 3            
                 14*4, &                                        ! band 4            
                 16*5, &                                        ! band 5            
                 8*6, &                                         ! band 6            
                 12*7, &                                        ! band 7            
                 8*8, &                                         ! band 8            
                 12*9, &                                        ! band 9            
                 6*10, &                                        ! band 10           
                 8*11, &                                        ! band 11           
                 8*12, &                                        ! band 12           
                 4*13, &                                        ! band 13           
                 2*14, &                                        ! band 14           
                 2*15, &                                        ! band 15           
                 2*16/                                       ! band 16           
      data wt/ &                                                                  
           0.1527534276,0.1491729617,0.1420961469,0.1316886544, &                   
           0.1181945205,0.1019300893,0.0832767040,0.0626720116, &                   
           0.0424925,0.0046269894,0.0038279891,0.0030260086, &                      
           0.0022199750,0.0014140010,0.000533,0.000075/                          

!
! end of data 2
!
!-----------------------------------------------------------------------

! start data 3

                                                                                 
! data

      data fracrefa1/ &                                                            
          0.08452097,0.17952873,0.16214369,0.13602182, &                            
          0.12760490,0.10302561,0.08392423,0.06337652, &                            
          0.04206551,0.00487497,0.00410743,0.00344421, &                            
          0.00285731,0.00157327,0.00080648,0.00012406/                           
      data fracrefb1/ &                                                            
          0.15492001,0.17384727,0.15165100,0.12675308, &                            
          0.10986247,0.09006091,0.07584465,0.05990077, &                            
          0.04113461,0.00438638,0.00374754,0.00313924, &                            
          0.00234381,0.00167167,0.00062744,0.00010889/                           
                                                                                 
      data forref1/   &                                                            
         -4.50470e-02,-1.18908e-01,-7.21730e-02,-2.83862e-02, &                     
         -3.01961e-02,-1.56877e-02,-1.53684e-02,-1.29135e-02, &                     
         -1.27963e-02,-1.81742e-03, 4.40008e-05, 1.05260e-02, &                     
          2.17290e-02, 1.65571e-02, 7.60751e-02, 1.47405e-01/                    

                                                                                 
! data                                                                           
                                                                                 
!     the ith set of reference fractions are from the ith reference              
!     pressure level.                                                            

      data fracrefa2/ &
          0.18068060,0.16803175,0.15140158,0.12221480, 0.10240850,0.09330297,0.07518960,0.05611294, &
          0.03781487,0.00387192,0.00321285,0.00244440, 0.00179546,0.00107704,0.00038798,0.00005060, &
          0.17927621,0.16731168,0.15129538,0.12328085, 0.10243484,0.09354796,0.07538418,0.05633071, &
          0.03810832,0.00398347,0.00320262,0.00250029, 0.00178666,0.00111127,0.00039438,0.00005169, &
          0.17762886,0.16638555,0.15115446,0.12470623, 0.10253213,0.09383459,0.07560240,0.05646568, &
          0.03844077,0.00409142,0.00322521,0.00254918, 0.00179296,0.00113652,0.00040169,0.00005259, &
          0.17566043,0.16539773,0.15092199,0.12571971, 0.10340609,0.09426189,0.07559051,0.05678188, &
          0.03881499,0.00414102,0.00328551,0.00258795, 0.00181648,0.00115145,0.00040969,0.00005357, &
          0.17335825,0.16442548,0.15070701,0.12667464, 0.10452303,0.09450833,0.07599410,0.05706393, &
          0.03910370,0.00417880,0.00335256,0.00261708, 0.00185491,0.00116627,0.00041759,0.00005464, &
          0.17082544,0.16321516,0.15044247,0.12797612, 0.10574646,0.09470057,0.07647423,0.05738756, &
          0.03935621,0.00423789,0.00342651,0.00264549, 0.00190188,0.00118281,0.00042592,0.00005583, &
          0.16809277,0.16193336,0.15013184,0.12937409, 0.10720784,0.09485368,0.07692636,0.05771774, &
          0.03966988,0.00427754,0.00349696,0.00268946, 0.00193536,0.00120222,0.00043462,0.00005712, &
          0.16517997,0.16059248,0.14984852,0.13079269, 0.10865030,0.09492947,0.07759736,0.05812201, &
          0.03997169,0.00432356,0.00355308,0.00274031, 0.00197243,0.00122401,0.00044359,0.00005849, &
          0.16209179,0.15912023,0.14938223,0.13198245, 0.11077233,0.09487948,0.07831636,0.05863440, &
          0.04028239,0.00436804,0.00360407,0.00279885, 0.00200364,0.00124861,0.00045521,0.00005996, &
          0.15962425,0.15789343,0.14898103,0.13275230, 0.11253940,0.09503502,0.07884382,0.05908009, &
          0.04053524,0.00439971,0.00364269,0.00284965, 0.00202758,0.00127076,0.00046408,0.00006114, &
          0.15926200,0.15770932,0.14891729,0.13283882, 0.11276010,0.09507311,0.07892222,0.05919230, &
          0.04054824,0.00440833,0.00365575,0.00286459, 0.00203786,0.00128405,0.00046504,0.00006146, &
          0.15926351,0.15770483,0.14891177,0.13279966, 0.11268171,0.09515216,0.07890341,0.05924807, &
          0.04052851,0.00440870,0.00365425,0.00286878, 0.00205747,0.00128916,0.00046589,0.00006221, &
          0.15937765,0.15775780,0.14892603,0.13273248, 0.11252731,0.09521657,0.07885858,0.05927679, &
          0.04050184,0.00440285,0.00365748,0.00286791, 0.00207507,0.00129193,0.00046679,0.00006308/
!     from p = 0.432 mb.                                                         
      data fracrefb2/ &                                                             
          0.17444289,0.16467269,0.15021490,0.12460902, &                         
          0.10400643,0.09481928,0.07590704,0.05752856, &                         
          0.03931715,0.00428572,0.00349352,0.00278938, &                         
          0.00203448,0.00130037,0.00051560,0.00006255/                           
                                                                                 
      data forref2/ &                                                               
         -2.34550e-03,-8.42698e-03,-2.01816e-02,-5.66701e-02, &                  
         -8.93189e-02,-6.37487e-02,-4.56455e-02,-4.41417e-02, &                  
         -4.48605e-02,-4.74696e-02,-5.16648e-02,-5.63099e-02, &                  
         -4.74781e-02,-3.84704e-02,-2.49905e-02, 2.02114e-03/                    
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa3/ &                                                             
!     from p = 1053.6 mb.                                                        
          0.15116400,0.14875700,0.14232300,0.13234501, 0.11881600,0.10224100,0.08345580,0.06267490, &                         
          0.04250650,0.00462650,0.00382259,0.00302600, 0.00222004,0.00141397,0.00053379,0.00007421, &                         
          0.15266000,0.14888400,0.14195900,0.13179500, 0.11842700,0.10209000,0.08336130,0.06264370, &                         
          0.04247660,0.00461946,0.00381536,0.00302601, 0.00222004,0.00141397,0.00053302,0.00007498, &                         
          0.15282799,0.14903000,0.14192399,0.13174300, 0.11835300,0.10202700,0.08329830,0.06264830, &                         
          0.04246910,0.00460242,0.00381904,0.00301573, 0.00222004,0.00141397,0.00053379,0.00007421, &                         
          0.15298399,0.14902800,0.14193401,0.13173500, 0.11833300,0.10195800,0.08324730,0.06264770, &                         
          0.04246490,0.00460489,0.00381123,0.00301893, 0.00221093,0.00141397,0.00053379,0.00007421, &                         
          0.15307599,0.14907201,0.14198899,0.13169800, 0.11827300,0.10192300,0.08321600,0.06263490, &                         
          0.04245600,0.00460846,0.00380836,0.00301663, 0.00221402,0.00141167,0.00052807,0.00007376, &                         
          0.15311401,0.14915401,0.14207301,0.13167299, 0.11819300,0.10188900,0.08318760,0.06261960, &                         
          0.04243890,0.00461584,0.00380929,0.00300815, 0.00221736,0.00140588,0.00052776,0.00007376, &                         
          0.15316001,0.14925499,0.14213000,0.13170999, 0.11807700,0.10181400,0.08317400,0.06260300, &                         
          0.04242720,0.00461520,0.00381381,0.00301285, 0.00220275,0.00140371,0.00052776,0.00007376, &                         
          0.15321200,0.14940999,0.14222500,0.13164200, 0.11798200,0.10174500,0.08317500,0.06253640, &                         
          0.04243130,0.00461724,0.00381534,0.00300320, 0.00220091,0.00140364,0.00052852,0.00007300, &                         
          0.15312800,0.14973100,0.14234400,0.13168900, 0.11795200,0.10156100,0.08302990,0.06252240, &                         
          0.04240980,0.00461035,0.00381381,0.00300176, 0.00220160,0.00140284,0.00052774,0.00007376, &                         
          0.15292500,0.14978001,0.14242400,0.13172600, 0.11798800,0.10156400,0.08303050,0.06251670, &                         
          0.04240970,0.00461302,0.00381452,0.00300250, 0.00220126,0.00140324,0.00052850,0.00007300/                           
      data fracrefb3/ &                                                             
!     from p = 64.1 mb.                                                          
          0.16340201,0.15607700,0.14601400,0.13182700, &                         
          0.11524700,0.09666570,0.07825360,0.05849780, &                         
          0.03949650,0.00427980,0.00353719,0.00279303, &                         
          0.00204788,0.00130139,0.00049055,0.00006904, &                         
          0.15762900,0.15494700,0.14659800,0.13267800, &                         
          0.11562700,0.09838360,0.07930420,0.05962700, &                         
          0.04036360,0.00438053,0.00361463,0.00285723, &                         
          0.00208345,0.00132135,0.00050528,0.00008003, &                         
          0.15641500,0.15394500,0.14633600,0.13180400, &                         
          0.11617100,0.09924170,0.08000510,0.06021420, &                         
          0.04082730,0.00441694,0.00365364,0.00287723, &                         
          0.00210914,0.00135784,0.00054651,0.00008003, &                         
          0.15482700,0.15286300,0.14392500,0.13244100, &                         
          0.11712000,0.09994920,0.08119200,0.06104360, &                         
          0.04135600,0.00446685,0.00368377,0.00290767, &                         
          0.00215445,0.00142865,0.00056142,0.00008003, &                         
          0.15975100,0.15653500,0.14214399,0.12892200, &                         
          0.11508400,0.09906020,0.08087940,0.06078190, &                         
          0.04140530,0.00452724,0.00374558,0.00295328, &                         
          0.00218509,0.00138644,0.00056018,0.00008003/                           
                                                                                 
      data absn2oa3/ &                                                              
          1.50387e-01,2.91407e-01,6.28803e-01,9.65619e-01, &                     
          1.15054e-00,2.23424e-00,1.83392e-00,1.39033e-00, &                     
          4.28457e-01,2.73502e-01,1.84307e-01,1.61325e-01, &                     
          7.66314e-02,1.33862e-01,6.71196e-07,1.59293e-06/                       
      data absn2ob3/ &                                                              
          9.37044e-05,1.23318e-03,7.91720e-03,5.33005e-02, &                     
          1.72343e-01,4.29571e-01,1.01288e+00,3.83863e+00, &                     
          1.15312e+01,1.08383e+00,2.24847e+00,1.51268e+00, &                     
          3.33177e-01,7.82102e-01,3.44631e-01,1.61039e-03/                       
      data forref3/ &                                                               
          1.76842e-04, 1.77913e-04, 1.25186e-04, 1.07912e-04, &                  
          1.05217e-04, 7.48726e-05, 1.11701e-04, 7.68921e-05, &                  
          9.87242e-05, 9.85711e-05, 6.16557e-05,-1.61291e-05, &                  
         -1.26794e-04,-1.19011e-04,-2.67814e-04, 6.95005e-05/                    
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa4/ &                                                             
!     from p =                                                                   
          0.15579100,0.14918099,0.14113800,0.13127001, &                         
          0.11796300,0.10174300,0.08282370,0.06238150, &                         
          0.04213440,0.00458968,0.00377949,0.00298736, &                         
          0.00220743,0.00140644,0.00053024,0.00007459, &                         
          0.15292799,0.15004000,0.14211500,0.13176700, &                         
          0.11821100,0.10186300,0.08288040,0.06241390, &                         
          0.04220720,0.00459006,0.00377919,0.00298743, &                         
          0.00220743,0.00140644,0.00053024,0.00007459, &                         
          0.14386199,0.15125300,0.14650001,0.13377000, &                         
          0.11895900,0.10229400,0.08312110,0.06239520, &                         
          0.04225560,0.00459428,0.00378865,0.00298860, &                         
          0.00220743,0.00140644,0.00053024,0.00007459, &                         
          0.14359100,0.14561599,0.14479300,0.13740200, &                         
          0.12150100,0.10315400,0.08355480,0.06247240, &                         
          0.04230980,0.00459916,0.00378373,0.00300063, &                         
          0.00221111,0.00140644,0.00053024,0.00007459, &                         
          0.14337599,0.14451601,0.14238000,0.13520500, &                         
          0.12354200,0.10581200,0.08451810,0.06262440, &                         
          0.04239590,0.00460297,0.00378701,0.00300466, &                         
          0.00221899,0.00141020,0.00053024,0.00007459, &                         
          0.14322001,0.14397401,0.14117201,0.13401900, &                         
          0.12255500,0.10774100,0.08617650,0.06296420, &                         
          0.04249590,0.00463406,0.00378241,0.00302037, &                         
          0.00221583,0.00141103,0.00053814,0.00007991, &                         
          0.14309500,0.14364301,0.14043900,0.13348100, &                         
          0.12211600,0.10684700,0.08820590,0.06374610, &                         
          0.04264730,0.00464231,0.00384022,0.00303427, &                         
          0.00221825,0.00140943,0.00055564,0.00007991, &                         
          0.15579100,0.14918099,0.14113800,0.13127001, &                         
          0.11796300,0.10174300,0.08282370,0.06238150, &                         
          0.04213440,0.00458968,0.00377949,0.00298736, &                         
          0.00220743,0.00140644,0.00053024,0.00007459, &                         
          0.15937001,0.15159500,0.14242800,0.13078900, &                         
          0.11671300,0.10035700,0.08143450,0.06093850, &                         
          0.04105320,0.00446233,0.00369844,0.00293784, &                         
          0.00216425,0.00143403,0.00054571,0.00007991/                           
      data fracrefb4/ &                                                             
!     from p = 1.17 mb.                                                          
          0.15558299,0.14930600,0.14104301,0.13124099, &                         
          0.11792900,0.10159200,0.08314130,0.06240450, &                         
          0.04217020,0.00459313,0.00379798,0.00299835, &                         
          0.00218950,0.00140615,0.00053010,0.00007457, &                         
          0.15592700,0.14918999,0.14095700,0.13115700, &                         
          0.11788900,0.10158000,0.08313780,0.06240240, &                         
          0.04217000,0.00459313,0.00379798,0.00299835, &                         
          0.00218950,0.00140615,0.00053010,0.00007457, &                         
          0.15949000,0.15014900,0.14162201,0.13080800, &                         
          0.11713500,0.10057100,0.08170080,0.06128110, &                         
          0.04165600,0.00459202,0.00379835,0.00299717, &                         
          0.00218958,0.00140616,0.00053010,0.00007457, &                         
          0.15967900,0.15038200,0.14196999,0.13074800, &                         
          0.11701700,0.10053000,0.08160790,0.06122690, &                         
          0.04128310,0.00456598,0.00379486,0.00299457, &                         
          0.00219016,0.00140619,0.00053011,0.00007456, &                         
          0.15989800,0.15057300,0.14207700,0.13068600, &                         
          0.11682900,0.10053900,0.08163610,0.06121870, &                         
          0.04121690,0.00449061,0.00371235,0.00294207, &                         
          0.00217778,0.00139877,0.00053011,0.00007455, &                         
          0.15950100,0.15112500,0.14199100,0.13071300, &                         
          0.11680800,0.10054600,0.08179050,0.06120910, &                         
          0.04126050,0.00444324,0.00366843,0.00289369, &                         
          0.00211550,0.00134746,0.00050874,0.00007863/                           
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa5/ &                                                             
!     from p = 387.6 mb.                                                         
          0.13966499,0.14138900,0.13763399,0.13076700, &                         
          0.12299100,0.10747700,0.08942000,0.06769200, &                         
          0.04587610,0.00501173,0.00415809,0.00328398, &                         
          0.00240015,0.00156222,0.00059104,0.00008323, &                         
          0.13958199,0.14332899,0.13785399,0.13205400, &                         
          0.12199700,0.10679600,0.08861080,0.06712320, &                         
          0.04556030,0.00500863,0.00416315,0.00328629, &                         
          0.00240023,0.00156220,0.00059104,0.00008323, &                         
          0.13907100,0.14250501,0.13889600,0.13297300, &                         
          0.12218700,0.10683800,0.08839260,0.06677310, &                         
          0.04538570,0.00495402,0.00409863,0.00328219, &                         
          0.00240805,0.00156266,0.00059104,0.00008323, &                         
          0.13867700,0.14190100,0.13932300,0.13327099, &                         
          0.12280800,0.10692500,0.08844510,0.06658510, &                         
          0.04519340,0.00492276,0.00408832,0.00323856, &                         
          0.00239289,0.00155698,0.00059104,0.00008323, &                         
          0.13845000,0.14158800,0.13929300,0.13295600, &                         
          0.12348300,0.10736700,0.08859480,0.06650610, &                         
          0.04498230,0.00491335,0.00406968,0.00322901, &                         
          0.00234666,0.00155235,0.00058813,0.00008323, &                         
          0.13837101,0.14113200,0.13930500,0.13283101, &                         
          0.12349200,0.10796400,0.08890490,0.06646480, &                         
          0.04485990,0.00489554,0.00405264,0.00320313, &                         
          0.00234742,0.00151159,0.00058438,0.00008253, &                         
          0.13834500,0.14093500,0.13896500,0.13262001, &                         
          0.12326900,0.10828900,0.08950050,0.06674610, &                         
          0.04476560,0.00489624,0.00400962,0.00317423, &                         
          0.00233479,0.00148249,0.00058590,0.00008253, &                         
          0.13831300,0.14069000,0.13871400,0.13247600, &                         
          0.12251400,0.10831300,0.08977090,0.06776920, &                         
          0.04498390,0.00484111,0.00398948,0.00316069, &                         
          0.00229741,0.00150104,0.00058608,0.00008253, &                         
          0.14027201,0.14420401,0.14215700,0.13446601, &                         
          0.12303700,0.10596100,0.08650370,0.06409570, &                         
          0.04312310,0.00471110,0.00393954,0.00310850, &                         
          0.00229588,0.00146366,0.00058194,0.00008253/                           
      data fracrefb5/ &                                                             
!     from p = 1.17 mb.                                                          
          0.14339100,0.14358699,0.13935301,0.13306700, &                         
          0.12135700,0.10590600,0.08688240,0.06553220, &                         
          0.04446740,0.00483580,0.00399413,0.00316225, &                         
          0.00233007,0.00149135,0.00056246,0.00008059, &                         
          0.14330500,0.14430299,0.14053699,0.13355300, &                         
          0.12151200,0.10529100,0.08627630,0.06505230, &                         
          0.04385850,0.00476555,0.00395010,0.00313878, &                         
          0.00232273,0.00149354,0.00056246,0.00008059, &                         
          0.14328399,0.14442700,0.14078601,0.13390100, &                         
          0.12132600,0.10510600,0.08613660,0.06494630, &                         
          0.04381310,0.00475378,0.00394166,0.00313076, &                         
          0.00231235,0.00149159,0.00056301,0.00008059, &                         
          0.14326900,0.14453100,0.14114200,0.13397101, &                         
          0.12127200,0.10493400,0.08601380,0.06483360, &                         
          0.04378900,0.00474655,0.00393549,0.00312583, &                         
          0.00230686,0.00148433,0.00056502,0.00008059, &                         
          0.14328900,0.14532700,0.14179000,0.13384600, &                         
          0.12093700,0.10461500,0.08573010,0.06461340, &                         
          0.04366570,0.00473087,0.00392539,0.00311238, &                         
          0.00229865,0.00147572,0.00056517,0.00007939/                           
                                                                                 
      data ccl45/ &                                                                 
           26.1407,  53.9776,  63.8085,  36.1701, &                              
           15.4099, 10.23116,  4.82948,  5.03836, &                              
           1.75558,0.,0.,0., &                                                   
           0.,0.,0.,0./                                                          
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa6/ &                                                             
!     from p = 706 mb.                                                           
          0.13739009,0.14259538,0.14033118,0.13547136, &                         
          0.12569460,0.11028396,0.08626066,0.06245148, &                         
          0.04309394,0.00473551,0.00403920,0.00321695, &                         
          0.00232470,0.00147662,0.00056095,0.00007373/                           
                                                                                 
      data cfc11adj6/ &                                                             
           0.,  0., 36.7627,  150.757,   &                                      
           81.4109, 74.9112, 56.9325, 49.3226, &                                 
           57.1074, 66.1202, 109.557, 89.0562, &                                 
           149.865, 196.140, 258.393, 80.9923/                                   
      data cfc126/ &                                                                
           62.8368, 43.2626, 26.7549, 22.2487, &                                 
           23.5029, 34.8323, 26.2335, 23.2306, &                                 
           18.4062, 13.9534, 22.6268, 24.2604, &                                 
           30.0088, 26.3634, 15.8237, 57.5050/                                   
      data absco26/ &                                                               
           7.44852e-05, 6.29208e-05, 7.34031e-05, 6.65218e-05, &                 
           7.87511e-05, 1.22489e-04, 3.39785e-04, 9.33040e-04, &                 
           1.54323e-03, 4.07220e-04, 4.34332e-04, 8.76418e-05, &                 
           9.80381e-05, 3.51680e-05, 5.31766e-05, 1.01542e-05/                   
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa7/ &                                                             
          0.16461779, 0.14889984, 0.14233345, 0.13156526, &                      
          0.11679733, 0.09988949, 0.08078653, 0.06006384, &                      
          0.04028391, 0.00435899, 0.00359173, 0.00281707, &                      
          0.00206767, 0.00135012, 0.00050720, 0.00007146, &                      
          0.16442357, 0.14944240, 0.14245804, 0.13111183, &                      
          0.11688625, 0.09983791, 0.08085148, 0.05993948, &                      
          0.04028057, 0.00435939, 0.00358708, 0.00284036, &                      
          0.00208869, 0.00133256, 0.00049260, 0.00006931, &                      
          0.16368519, 0.15018989, 0.14262174, 0.13084342, &                      
          0.11682195, 0.09996257, 0.08074036, 0.05985692, &                      
          0.04045362, 0.00436208, 0.00358257, 0.00287122, &                      
          0.00211004, 0.00133804, 0.00049260, 0.00006931, &                      
          0.16274056, 0.15133780, 0.14228874, 0.13081114, &                      
          0.11688486, 0.09979610, 0.08073687, 0.05996741, &                      
          0.04040616, 0.00439869, 0.00368910, 0.00293041, &                      
          0.00211604, 0.00133536, 0.00049260, 0.00006931, &                      
          0.16176532, 0.15207882, 0.14226955, 0.13079646, &                      
          0.11688191, 0.09966998, 0.08066384, 0.06020275, &                      
          0.04047901, 0.00446696, 0.00377456, 0.00294410, &                      
          0.00211082, 0.00133536, 0.00049260, 0.00006931, &                      
          0.15993737, 0.15305527, 0.14259829, 0.13078023, &                      
          0.11686983, 0.09980131, 0.08058286, 0.06031430, &                      
          0.04082833, 0.00450509, 0.00377574, 0.00294823, &                      
          0.00210977, 0.00133302, 0.00049260, 0.00006931, &                      
          0.15371189, 0.15592396, 0.14430280, 0.13076764, &                      
          0.11720382, 0.10023471, 0.08066396, 0.06073554, &                      
          0.04121581, 0.00451202, 0.00377832, 0.00294609, &                      
          0.00210943, 0.00133336, 0.00049260, 0.00006931, &                      
          0.14262275, 0.14572631, 0.14560597, 0.13736825, &                      
          0.12271351, 0.10419556, 0.08294533, 0.06199794, &                      
          0.04157615, 0.00452842, 0.00377704, 0.00293852, &                      
          0.00211034, 0.00133278, 0.00049259, 0.00006931, &                      
          0.14500433, 0.14590444, 0.14430299, 0.13770708, &                      
          0.12288283, 0.10350952, 0.08269450, 0.06130579, &                      
          0.04144571, 0.00452096, 0.00377382, 0.00294532, &                      
          0.00210943, 0.00133228, 0.00049260, 0.00006931/                        
      data fracrefb7/ &                                                             
          0.15355594,0.15310939,0.14274909,0.13129812, &                         
          0.11736792,0.10118213,0.08215259,0.06165591, &                         
          0.04164486,0.00451141,0.00372837,0.00294095, &                         
          0.00215259,0.00136792,0.00051233,0.00007075/                           
                                                                                 
      data absco27/ &                                                               
          9.30038e-05, 1.74061e-04, 2.09293e-04, 2.52360e-04, &                  
          3.13404e-04, 4.16619e-04, 6.27394e-04, 1.29386e-03, &                  
          4.05192e-03, 3.97050e-03, 7.00634e-04, 6.06617e-04, &                  
          7.66978e-04, 6.70661e-04, 7.89971e-04, 7.55709e-04/                    
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa8/ &                                                             
!     from p = 1053.6 mb.                                                        
          0.15309700,0.15450300,0.14458799,0.13098200, &                         
          0.11817900,0.09953490,0.08132080,0.06139960, &                         
          0.04132010,0.00446788,0.00372533,0.00294053, &                         
          0.00211371,0.00128122,0.00048050,0.00006759/                           
      data fracrefb8/ &                                                             
!     from p = 28.9 mb.                                                          
          0.14105400,0.14728899,0.14264800,0.13331699, &                         
          0.12034100,0.10467000,0.08574980,0.06469390, &                         
          0.04394640,0.00481284,0.00397375,0.00315006, &                         
          0.00228636,0.00144606,0.00054604,0.00007697/                           
                                                                                 
      data cfc128/ &                                                                
           85.4027, 89.4696, 74.0959, 67.7480, &                                 
           61.2444, 59.9073, 60.8296, 63.0998, &                                 
           59.6110, 64.0735, 57.2622, 58.9721, &                                 
           43.5505, 26.1192, 32.7023, 32.8667/                                   
      data cfc22adj8/ &                                                             
!     original cfc22 is multiplied by 1.485 to account for the 780-850 cm-1      
!     and 1290-1335 cm-1 bands.                                                  
           135.335, 89.6642, 76.2375, 65.9748, &                                 
           63.1164, 60.2935, 64.0299, 75.4264, &                                 
           51.3018, 7.07911, 5.86928, 0.398693, &                                
           2.82885, 9.12751, 6.28271, 0./                                        
      data absco2a8/ &                                                              
           1.11233e-05, 3.92400e-05, 6.62059e-05, 8.51687e-05, &                 
           7.79035e-05, 1.34058e-04, 2.82553e-04, 5.41741e-04, &                 
           1.47029e-05, 2.34982e-05, 6.91094e-08, 8.48917e-08, &                 
           6.58783e-08, 4.64849e-08, 3.62742e-08, 3.62742e-08/                   
      data absco2b8/ &                                                              
           4.10977e-09, 5.65200e-08, 1.70800e-07, 4.16840e-07, &                 
           9.53684e-07, 2.36468e-06, 7.29502e-06, 4.93883e-05, &                 
           5.10440e-04, 9.75248e-04, 1.36495e-03, 2.40451e-03, &                 
           4.50277e-03, 2.24486e-02, 4.06756e-02, 2.17447e-10/                   
      data absn2oa8/ &                                                              
           1.28527e-02,5.28651e-02,1.01668e-01,1.57224e-01, &                    
           2.76947e-01,4.93048e-01,6.71387e-01,3.48809e-01, &                    
           4.19840e-01,3.13558e-01,2.44432e-01,2.05108e-01, &                    
           1.21423e-01,1.22158e-01,1.49702e-01,1.47799e-01/                      
      data absn2ob8/ &                                                              
           3.15864e-03,4.87347e-03,8.63235e-03,2.16053e-02, &                    
           3.63699e-02,7.89149e-02,3.53807e-01,1.27140e-00, &                    
           2.31464e-00,7.75834e-02,5.15063e-02,4.07059e-02, &                    
           5.91947e-02,5.83546e-02,3.12716e-01,1.47456e-01/                      
                                                                                 
!  data                                                                          
                                                                                 
      data fracrefa9/ &                                                             
!     from p = 1053.6 mb.                                                        
          0.16898900,0.15898301,0.13575301,0.12600900, &                         
          0.11545800,0.09879170,0.08106830,0.06063440, &                         
          0.03988780,0.00421760,0.00346635,0.00278779, &                         
          0.00206225,0.00132324,0.00050033,0.00007038, &                         
          0.18209399,0.15315101,0.13571000,0.12504999, &                         
          0.11379100,0.09680810,0.08008570,0.05970280, &                         
          0.03942860,0.00413383,0.00343186,0.00275558, &                         
          0.00204657,0.00130219,0.00045454,0.00005664, &                         
          0.18459500,0.15512000,0.13395500,0.12576801, &                         
          0.11276800,0.09645190,0.07956650,0.05903340, &                         
          0.03887050,0.00412226,0.00339453,0.00273518, &                         
          0.00196922,0.00119411,0.00040263,0.00005664, &                         
          0.18458800,0.15859900,0.13278100,0.12589300, &                         
          0.11272700,0.09599660,0.07903030,0.05843600, &                         
          0.03843400,0.00405181,0.00337980,0.00263818, &                         
          0.00186869,0.00111807,0.00040263,0.00005664, &                         
          0.18459301,0.16176100,0.13235000,0.12528200, &                         
          0.11237100,0.09618840,0.07833760,0.05800770, &                         
          0.03787610,0.00408253,0.00330363,0.00250445, &                         
          0.00176725,0.00111753,0.00040263,0.00005664, &                         
          0.18454400,0.16505300,0.13221300,0.12476600, &                         
          0.11158300,0.09618120,0.07797340,0.05740380, &                         
          0.03742820,0.00392691,0.00312208,0.00246306, &                         
          0.00176735,0.00111721,0.00040263,0.00005664, &                         
          0.18452001,0.16697501,0.13445500,0.12391300, &                         
          0.11059100,0.09596890,0.07761050,0.05643200, &                         
          0.03686520,0.00377086,0.00309351,0.00246297, &                         
          0.00176765,0.00111700,0.00040263,0.00005664, &                         
          0.18460999,0.16854499,0.13922299,0.12266400, &                         
          0.10962200,0.09452030,0.07653800,0.05551340, &                         
          0.03609660,0.00377043,0.00309367,0.00246304, &                         
          0.00176749,0.00111689,0.00040263,0.00005664, &                         
          0.18312500,0.16787501,0.14720701,0.12766500, &                         
          0.10890900,0.08935530,0.07310870,0.05443140, &                         
          0.03566380,0.00376446,0.00309521,0.00246510, &                         
          0.00176139,0.00111543,0.00040263,0.00005664/                           
      data fracrefb9/ &                                                             
!     from p = 0.071 mb.                                                         
          0.20148601,0.15252700,0.13376500,0.12184600, &                         
          0.10767800,0.09307410,0.07674570,0.05876940, &                         
          0.04001480,0.00424612,0.00346896,0.00269954, &                         
          0.00196864,0.00122562,0.00043628,0.00004892/                           
                                                                                 
      data absn2o9/ &                                                               
!     from p = 952 mb.                                                           
           3.26267e-01,2.42869e-00,1.15455e+01,7.39478e-00, &                    
           5.16550e-00,2.54474e-00,3.53082e-00,3.82278e-00, &                    
           1.81297e-00,6.65313e-01,1.23652e-01,1.83895e-03, &                    
           1.70592e-03,2.68434e-09,0.,0., &                                      
!     from p = 620 mb.                                                           
           2.08632e-01,1.11865e+00,4.95975e+00,8.10907e+00, &                    
           1.10408e+01,5.45460e+00,4.18611e+00,3.53422e+00, &                    
           2.54164e+00,3.65093e-01,5.84480e-01,2.26918e-01, &                    
           1.36230e-03,5.54400e-10,6.83703e-10,0., &                             
!     from p = 313 mb.                                                           
           6.20022e-02,2.69521e-01,9.81928e-01,1.65004e-00, &                    
           3.08089e-00,5.38696e-00,1.14600e+01,2.41211e+01, &                    
           1.69655e+01,1.37556e-00,5.43254e-01,3.52079e-01, &                    
           4.31888e-01,4.82523e-06,5.74747e-11,0./                               
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa10/ &                                                             
!     from p = 473 mb.                                                           
          0.16271301,0.15141940,0.14065412,0.12899506, &                         
          0.11607002,0.10142808,0.08116794,0.06104711, &                         
          0.04146209,0.00447386,0.00372902,0.00287258, &                         
          0.00206028,0.00134634,0.00049232,0.00006927/                           
      data fracrefb10/ &                                                             
!     from p = 1.17 mb.                                                          
          0.16571465,0.15262246,0.14036226,0.12620729, &                         
          0.11477834,0.09967982,0.08155201,0.06159503, &                         
          0.04196607,0.00453940,0.00376881,0.00300437, &                         
          0.00223034,0.00139432,0.00051516,0.00007095/                           
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa11/ &                                                             
!     from p = 473 mb.                                                           
          0.14152819,0.13811260,0.14312185,0.13705885, &                         
          0.11944738,0.10570189,0.08866373,0.06565409, &                         
          0.04428961,0.00481540,0.00387058,0.00329187, &                         
          0.00238294,0.00150971,0.00049287,0.00005980/                           
      data fracrefb11/ &                                                             
!     from p = 1.17 mb.                                                          
          0.10874039,0.15164889,0.15149839,0.14515044, &                         
          0.12486220,0.10725017,0.08715712,0.06463144, &                         
          0.04332319,0.00441193,0.00393819,0.00305960, &                         
          0.00224221,0.00145100,0.00055586,0.00007934/                           
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa12/ &                                                             
!     from p = 706.3 mb.                                                         
          0.21245100,0.15164700,0.14486700,0.13075501, &                         
          0.11629600,0.09266050,0.06579930,0.04524000, &                         
          0.03072870,0.00284297,0.00234660,0.00185208, &                         
          0.00133978,0.00082214,0.00031016,0.00004363, &                         
          0.14703900,0.16937999,0.15605700,0.14159000, &                         
          0.12088500,0.10058500,0.06809110,0.05131470, &                         
          0.03487040,0.00327281,0.00250183,0.00190024, &                         
          0.00133978,0.00082214,0.00031016,0.00004363, &                         
          0.13689300,0.16610400,0.15723500,0.14299500, &                         
          0.12399400,0.09907820,0.07169690,0.05367370, &                         
          0.03671630,0.00378148,0.00290510,0.00221076, &                         
          0.00142810,0.00093527,0.00031016,0.00004363, &                         
          0.13054299,0.16273800,0.15874299,0.14279599, &                         
          0.12674300,0.09664900,0.07462200,0.05620080, &                         
          0.03789090,0.00411690,0.00322920,0.00245036, &                         
          0.00178303,0.00098595,0.00040802,0.00010150, &                         
          0.12828299,0.15824600,0.15688400,0.14449100, &                         
          0.12787800,0.09517830,0.07679350,0.05890820, &                         
          0.03883570,0.00442304,0.00346796,0.00255333, &                         
          0.00212519,0.00116168,0.00067065,0.00010150, &                         
          0.12649800,0.15195100,0.15646499,0.14569700, &                         
          0.12669300,0.09653520,0.07887920,0.06106920, &                         
          0.04043910,0.00430390,0.00364453,0.00314360, &                         
          0.00203206,0.00187787,0.00067075,0.00010150, &                         
          0.12500300,0.14460599,0.15672199,0.14724600, &                         
          0.11978900,0.10190200,0.08196710,0.06315770, &                         
          0.04240100,0.00433645,0.00404097,0.00329466, &                         
          0.00288491,0.00187803,0.00067093,0.00010150, &                         
          0.12317200,0.14118700,0.15242000,0.13794300, &                         
          0.12119200,0.10655400,0.08808350,0.06521370, &                         
          0.04505680,0.00485949,0.00477105,0.00401468, &                         
          0.00288491,0.00187786,0.00067110,0.00010150, &                         
          0.10193600,0.11693000,0.13236099,0.14053200, &                         
          0.13749801,0.12193100,0.10221000,0.07448910, &                         
          0.05205320,0.00572312,0.00476882,0.00403380, &                         
          0.00288871,0.00187396,0.00067218,0.00010150/                           
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa13/ &                                                             
!     from p = 706.3 mb.                                                         
          0.17683899,0.17319500,0.15712699,0.13604601, &                         
          0.10776200,0.08750010,0.06808820,0.04905150, &                         
          0.03280360,0.00350836,0.00281864,0.00219862, &                         
          0.00160943,0.00101885,0.00038147,0.00005348, &                         
          0.17535400,0.16999300,0.15610200,0.13589200, &                         
          0.10842100,0.08988550,0.06943920,0.04974900, &                         
          0.03323400,0.00352752,0.00289402,0.00231003, &                         
          0.00174659,0.00101884,0.00038147,0.00005348, &                         
          0.17409500,0.16846400,0.15641899,0.13503000, &                         
          0.10838600,0.08985800,0.07092720,0.05075710, &                         
          0.03364180,0.00354241,0.00303507,0.00243391, &                         
          0.00177502,0.00114638,0.00043585,0.00005348, &                         
          0.17248300,0.16778600,0.15543500,0.13496999, &                         
          0.10826300,0.09028740,0.07156720,0.05187120, &                         
          0.03424890,0.00363933,0.00324715,0.00255030, &                         
          0.00187380,0.00116978,0.00051229,0.00009768, &                         
          0.17061099,0.16715799,0.15405200,0.13471501, &                         
          0.10896400,0.09069460,0.07229760,0.05218280, &                         
          0.03555340,0.00379576,0.00330240,0.00274693, &                         
          0.00201587,0.00119598,0.00061885,0.00009768, &                         
          0.16789700,0.16629100,0.15270300,0.13360199, &                         
          0.11047200,0.09151080,0.07325000,0.05261450, &                         
          0.03657990,0.00450092,0.00349537,0.00283321, &                         
          0.00208396,0.00140354,0.00066587,0.00009768, &                         
          0.16412200,0.16387400,0.15211500,0.13062200, &                         
          0.11325100,0.09348130,0.07381380,0.05434740, &                         
          0.03803160,0.00481346,0.00393592,0.00296633, &                         
          0.00222532,0.00163762,0.00066648,0.00009768, &                         
          0.15513401,0.15768200,0.14850400,0.13330200, &                         
          0.11446500,0.09868230,0.07642050,0.05624170, &                         
          0.04197810,0.00502288,0.00429452,0.00315347, &                         
          0.00263559,0.00171772,0.00066860,0.00009768, &                         
          0.15732600,0.15223300,0.14271900,0.13563600, &                         
          0.11859600,0.10274200,0.07934560,0.05763410, &                         
          0.03921740,0.00437741,0.00337921,0.00280212, &                         
          0.00200156,0.00124812,0.00064664,0.00009768/                           
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa14/ &                                                             
!     from p = 1053.6 mb.                                                        
          0.18446200,0.16795200,0.14949700,0.12036000, &                         
          0.10440100,0.09024280,0.07435880,0.05629380, &                         
          0.03825420,0.00417276,0.00345278,0.00272949, &                         
          0.00200378,0.00127404,0.00050721,0.00004141/                           
      data fracrefb14/ &                                                             
!     from p = 0.64 mb.                                                          
          0.19128500,0.16495700,0.14146100,0.11904500, &                         
          0.10350200,0.09151190,0.07604270,0.05806020, &                         
          0.03979950,0.00423959,0.00357439,0.00287559, &                         
          0.00198860,0.00116529,0.00043616,0.00005987/                           
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa15/ &                                                             
!     from p = 1053.6 mb.                                                        
          0.11287100,0.12070200,0.12729000,0.12858100, &                         
          0.12743001,0.11961800,0.10290400,0.07888980, &                         
          0.05900120,0.00667979,0.00552926,0.00436993, &                         
          0.00320611,0.00204765,0.00077371,0.00010894, &                         
          0.13918801,0.16353001,0.16155800,0.14090499, &                         
          0.11322300,0.08757720,0.07225720,0.05173390, &                         
          0.04731360,0.00667979,0.00552926,0.00436993, &                         
          0.00320611,0.00204765,0.00077371,0.00010894, &                         
          0.14687300,0.17853101,0.15664500,0.13351700, &                         
          0.10791200,0.08684320,0.07158090,0.05198410, &                         
          0.04340110,0.00667979,0.00552926,0.00436993, &                         
          0.00320611,0.00204765,0.00077371,0.00010894, &                         
          0.15760700,0.17759100,0.15158001,0.13193300, &                         
          0.10742800,0.08693760,0.07159490,0.05196250, &                         
          0.04065270,0.00667979,0.00552926,0.00436993, &                         
          0.00320611,0.00204765,0.00077371,0.00010894, &                         
          0.16646700,0.17299300,0.15018500,0.13138700, &                         
          0.10735900,0.08713110,0.07130330,0.05279420, &                         
          0.03766730,0.00667979,0.00552926,0.00436993, &                         
          0.00320611,0.00204765,0.00077371,0.00010894, &                         
          0.17546000,0.16666500,0.14969499,0.13105400, &                         
          0.10782500,0.08718610,0.07156770,0.05308320, &                         
          0.03753960,0.00432465,0.00509623,0.00436993, &                         
          0.00320611,0.00204765,0.00077371,0.00010894, &                         
          0.18378501,0.16064601,0.14940400,0.13146400, &                         
          0.10810300,0.08775740,0.07115360,0.05400040, &                         
          0.03689970,0.00388333,0.00323610,0.00353414, &                         
          0.00320611,0.00204765,0.00077371,0.00010894, &                         
          0.18966800,0.15744300,0.14993000,0.13152599, &                         
          0.10899200,0.08858690,0.07142920,0.05399600, &                         
          0.03433460,0.00374886,0.00302066,0.00240653, &                         
          0.00199205,0.00204765,0.00077371,0.00010894, &                         
          0.11887100,0.12479600,0.12569501,0.12839900, &                         
          0.12473500,0.12012800,0.11086700,0.08493590, &                         
          0.05063770,0.00328723,0.00266849,0.00210232, &                         
          0.00152114,0.00095635,0.00035374,0.00004980/                           
                                                                                 
! data                                                                           
                                                                                 
      data fracrefa16/ &                                                             
!     from p = 862.6 mb.                                                         
          0.17356300,0.18880001,0.17704099,0.13661300, &                         
          0.10691600,0.08222480,0.05939860,0.04230810, &                         
          0.02526330,0.00244532,0.00193541,0.00150415, &                         
          0.00103528,0.00067068,0.00024951,0.00003348, &                         
          0.17779499,0.19837400,0.16557600,0.13470000, &                         
          0.11013600,0.08342720,0.05987030,0.03938700, &                         
          0.02293650,0.00238849,0.00192400,0.00149921, &                         
          0.00103539,0.00067150,0.00024822,0.00003348, &                         
          0.18535601,0.19407199,0.16053200,0.13300700, &                         
          0.10779000,0.08408500,0.06480450,0.04070160, &                         
          0.02203590,0.00227779,0.00189074,0.00146888, &                         
          0.00103147,0.00066770,0.00024751,0.00003348, &                         
          0.19139200,0.18917400,0.15748601,0.13240699, &                         
          0.10557300,0.08383260,0.06724060,0.04364450, &                         
          0.02175820,0.00225436,0.00184421,0.00143153, &                         
          0.00103027,0.00066066,0.00024222,0.00003148, &                         
          0.19547801,0.18539500,0.15442000,0.13114899, &                         
          0.10515600,0.08350350,0.06909780,0.04671630, &                         
          0.02168820,0.00224400,0.00182009,0.00139098, &                         
          0.00102582,0.00065367,0.00023202,0.00003148, &                         
          0.19757500,0.18266800,0.15208900,0.12897800, &                         
          0.10637200,0.08391220,0.06989830,0.04964120, &                         
          0.02155800,0.00224310,0.00177358,0.00138184, &                         
          0.00101538,0.00063370,0.00023227,0.00003148, &                         
          0.20145500,0.17692900,0.14940600,0.12690400, &                         
          0.10828800,0.08553720,0.07004940,0.05153430, &                         
          0.02268740,0.00216943,0.00178603,0.00137754, &                         
          0.00098344,0.00063165,0.00023218,0.00003148, &                         
          0.20383500,0.17047501,0.14570600,0.12679300, &                         
          0.11043100,0.08719150,0.07045440,0.05345420, &                         
          0.02448340,0.00215839,0.00175893,0.00138296, &                         
          0.00098318,0.00063188,0.00023199,0.00003148, &                         
          0.18680701,0.15961801,0.15092900,0.13049100, &                         
          0.11418400,0.09380540,0.07093450,0.05664280, &                         
          0.02938410,0.00217751,0.00176766,0.00138275, &                         
          0.00098377,0.00063181,0.00023193,0.00003148/                           
               

!
! end of data 3
!

!-----------------------------------------------------------------------

! start data 4

      data nxmol  /2/
      data ixindx /0,2,3,0,31*0/
                                                                  
!
! end of data 4
!
!-----------------------------------------------------------------------

! start data 5
                                                                  
!     
!  longwave spectral band data                                                   

      data wavenum1(1) /10./, wavenum2(1) /250./, delwave(1) /240./              
      data wavenum1(2) /250./, wavenum2(2) /500./, delwave(2) /250./             
      data wavenum1(3) /500./, wavenum2(3) /630./, delwave(3) /130./             
      data wavenum1(4) /630./, wavenum2(4) /700./, delwave(4) /70./              
      data wavenum1(5) /700./, wavenum2(5) /820./, delwave(5) /120./             
      data wavenum1(6) /820./, wavenum2(6) /980./, delwave(6) /160./             
      data wavenum1(7) /980./, wavenum2(7) /1080./, delwave(7) /100./            
      data wavenum1(8) /1080./, wavenum2(8) /1180./, delwave(8) /100./           
      data wavenum1(9) /1180./, wavenum2(9) /1390./, delwave(9) /210./           
      data wavenum1(10) /1390./,wavenum2(10) /1480./,delwave(10) /90./           
      data wavenum1(11) /1480./,wavenum2(11) /1800./,delwave(11) /320./          
      data wavenum1(12) /1800./,wavenum2(12) /2080./,delwave(12) /280./          
      data wavenum1(13) /2080./,wavenum2(13) /2250./,delwave(13) /170./          
      data wavenum1(14) /2250./,wavenum2(14) /2380./,delwave(14) /130./          
      data wavenum1(15) /2380./,wavenum2(15) /2600./,delwave(15) /220./          
      data wavenum1(16) /2600./,wavenum2(16) /3000./,delwave(16) /400./          
                                                                                 
!
! end of data 5
!
!-----------------------------------------------------------------------

! start data 6

              
      data ng  /16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16/                 
      data nspa /1, 1,10, 9, 9, 1, 9, 1,11, 1, 1, 9, 9, 1, 9, 9/                 
      data nspb /1, 1, 5, 6, 5, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0/                 
                                                                                 
!     heatfac is the factor by which one must multiply delta-flux/               
!     delta-pressure, with flux in w/m-2 and pressure in mbar, to get            
!     the heating rate in units of degrees/day.  it is equal to                  
!           (g)x(#sec/day)x(1e-5)/(specific heat of air at const. p)             
!        =  (9.8066)(3600)(1e-5)/(1.004)                                         

      data heatfac /8.4391/                                                      
                                                                           
!     these pressures are chosen such that the ln of the first pressure          
!     has only a few non-zero digits (i.e. ln(pref(1)) = 6.96000) and            
!     each subsequent ln(pressure) differs from the previous one by 0.2.         

      data pref / &                                                                 
          1.05363e+03,8.62642e+02,7.06272e+02,5.78246e+02,4.73428e+02, & 
          3.87610e+02,3.17348e+02,2.59823e+02,2.12725e+02,1.74164e+02, & 
          1.42594e+02,1.16746e+02,9.55835e+01,7.82571e+01,6.40715e+01, & 
          5.24573e+01,4.29484e+01,3.51632e+01,2.87892e+01,2.35706e+01, & 
          1.92980e+01,1.57998e+01,1.29358e+01,1.05910e+01,8.67114e+00, & 
          7.09933e+00,5.81244e+00,4.75882e+00,3.89619e+00,3.18993e+00, & 
          2.61170e+00,2.13828e+00,1.75067e+00,1.43333e+00,1.17351e+00, & 
          9.60789e-01,7.86628e-01,6.44036e-01,5.27292e-01,4.31710e-01, & 
          3.53455e-01,2.89384e-01,2.36928e-01,1.93980e-01,1.58817e-01, & 
          1.30029e-01,1.06458e-01,8.71608e-02,7.13612e-02,5.84256e-02, & 
          4.78349e-02,3.91639e-02,3.20647e-02,2.62523e-02,2.14936e-02, & 
          1.75975e-02,1.44076e-02,1.17959e-02,9.65769e-03/                       
      data preflog / &                                                              
           6.9600e+00, 6.7600e+00, 6.5600e+00, 6.3600e+00, 6.1600e+00, & 
           5.9600e+00, 5.7600e+00, 5.5600e+00, 5.3600e+00, 5.1600e+00, & 
           4.9600e+00, 4.7600e+00, 4.5600e+00, 4.3600e+00, 4.1600e+00, & 
           3.9600e+00, 3.7600e+00, 3.5600e+00, 3.3600e+00, 3.1600e+00, & 
           2.9600e+00, 2.7600e+00, 2.5600e+00, 2.3600e+00, 2.1600e+00, & 
           1.9600e+00, 1.7600e+00, 1.5600e+00, 1.3600e+00, 1.1600e+00, & 
           9.6000e-01, 7.6000e-01, 5.6000e-01, 3.6000e-01, 1.6000e-01, & 
          -4.0000e-02,-2.4000e-01,-4.4000e-01,-6.4000e-01,-8.4000e-01, & 
          -1.0400e+00,-1.2400e+00,-1.4400e+00,-1.6400e+00,-1.8400e+00, & 
          -2.0400e+00,-2.2400e+00,-2.4400e+00,-2.6400e+00,-2.8400e+00, & 
          -3.0400e+00,-3.2400e+00,-3.4400e+00,-3.6400e+00,-3.8400e+00, & 
          -4.0400e+00,-4.2400e+00,-4.4400e+00,-4.6400e+00/                       
!     these are the temperatures associated with the respective                  
!     pressures for the mls standard atmosphere.                                 
      data tref / &                                                                 
           2.9420e+02, 2.8799e+02, 2.7894e+02, 2.6925e+02, 2.5983e+02, & 
           2.5017e+02, 2.4077e+02, 2.3179e+02, 2.2306e+02, 2.1578e+02, & 
           2.1570e+02, 2.1570e+02, 2.1570e+02, 2.1706e+02, 2.1858e+02, & 
           2.2018e+02, 2.2174e+02, 2.2328e+02, 2.2479e+02, 2.2655e+02, & 
           2.2834e+02, 2.3113e+02, 2.3401e+02, 2.3703e+02, 2.4022e+02, & 
           2.4371e+02, 2.4726e+02, 2.5085e+02, 2.5457e+02, 2.5832e+02, & 
           2.6216e+02, 2.6606e+02, 2.6999e+02, 2.7340e+02, 2.7536e+02, & 
           2.7568e+02, 2.7372e+02, 2.7163e+02, 2.6955e+02, 2.6593e+02, & 
           2.6211e+02, 2.5828e+02, 2.5360e+02, 2.4854e+02, 2.4348e+02, & 
           2.3809e+02, 2.3206e+02, 2.2603e+02, 2.2000e+02, 2.1435e+02, & 
           2.0887e+02, 2.0340e+02, 1.9792e+02, 1.9290e+02, 1.8809e+02, & 
           1.8329e+02, 1.7849e+02, 1.7394e+02, 1.7212e+02/                       
                                                                                 
!
! end of data 6
!
!-----------------------------------------------------------------------

! start data 7

      data (totplnk(idata, 1),idata=1,50)/ &                                                
      1.13735e-06,1.15150e-06,1.16569e-06,1.17992e-06,1.19419e-06, & 
      1.20850e-06,1.22285e-06,1.23723e-06,1.25164e-06,1.26610e-06, & 
      1.28059e-06,1.29511e-06,1.30967e-06,1.32426e-06,1.33889e-06, & 
      1.35355e-06,1.36824e-06,1.38296e-06,1.39772e-06,1.41250e-06, & 
      1.42732e-06,1.44217e-06,1.45704e-06,1.47195e-06,1.48689e-06, & 
      1.50185e-06,1.51684e-06,1.53186e-06,1.54691e-06,1.56198e-06, & 
      1.57709e-06,1.59222e-06,1.60737e-06,1.62255e-06,1.63776e-06, & 
      1.65299e-06,1.66825e-06,1.68352e-06,1.69883e-06,1.71416e-06, & 
      1.72951e-06,1.74488e-06,1.76028e-06,1.77570e-06,1.79114e-06, & 
      1.80661e-06,1.82210e-06,1.83760e-06,1.85313e-06,1.86868e-06/               
      data (totplnk(idata, 1),idata=51,100)/ &                                              
      1.88425e-06,1.89985e-06,1.91546e-06,1.93109e-06,1.94674e-06, & 
      1.96241e-06,1.97811e-06,1.99381e-06,2.00954e-06,2.02529e-06, & 
      2.04105e-06,2.05684e-06,2.07264e-06,2.08846e-06,2.10429e-06, & 
      2.12015e-06,2.13602e-06,2.15190e-06,2.16781e-06,2.18373e-06, & 
      2.19966e-06,2.21562e-06,2.23159e-06,2.24758e-06,2.26358e-06, & 
      2.27959e-06,2.29562e-06,2.31167e-06,2.32773e-06,2.34381e-06, & 
      2.35990e-06,2.37601e-06,2.39212e-06,2.40825e-06,2.42440e-06, & 
      2.44056e-06,2.45673e-06,2.47292e-06,2.48912e-06,2.50533e-06, & 
      2.52157e-06,2.53781e-06,2.55406e-06,2.57032e-06,2.58660e-06, & 
      2.60289e-06,2.61919e-06,2.63550e-06,2.65183e-06,2.66817e-06/               
      data (totplnk(idata, 1),idata=101,150)/ &                                             
      2.68452e-06,2.70088e-06,2.71726e-06,2.73364e-06,2.75003e-06, & 
      2.76644e-06,2.78286e-06,2.79929e-06,2.81572e-06,2.83218e-06, & 
      2.84864e-06,2.86510e-06,2.88159e-06,2.89807e-06,2.91458e-06, & 
      2.93109e-06,2.94762e-06,2.96415e-06,2.98068e-06,2.99724e-06, & 
      3.01379e-06,3.03036e-06,3.04693e-06,3.06353e-06,3.08013e-06, & 
      3.09674e-06,3.11335e-06,3.12998e-06,3.14661e-06,3.16324e-06, & 
      3.17989e-06,3.19656e-06,3.21323e-06,3.22991e-06,3.24658e-06, & 
      3.26328e-06,3.27998e-06,3.29669e-06,3.31341e-06,3.33013e-06, & 
      3.34686e-06,3.36360e-06,3.38034e-06,3.39709e-06,3.41387e-06, & 
      3.43063e-06,3.44742e-06,3.46420e-06,3.48099e-06,3.49779e-06/               
      data (totplnk(idata, 1),idata=151,181)/ &                                             
      3.51461e-06,3.53141e-06,3.54824e-06,3.56506e-06,3.58191e-06, & 
      3.59875e-06,3.61559e-06,3.63244e-06,3.64931e-06,3.66617e-06, & 
      3.68305e-06,3.69992e-06,3.71682e-06,3.73372e-06,3.75061e-06, & 
      3.76753e-06,3.78443e-06,3.80136e-06,3.81829e-06,3.83522e-06, & 
      3.85215e-06,3.86910e-06,3.88605e-06,3.90301e-06,3.91997e-06, & 
      3.93694e-06,3.95390e-06,3.97087e-06,3.98788e-06,4.00485e-06, & 
      4.02187e-06/                                                               
      data (totplnk(idata, 2),idata=1,50)/ &                                                
      2.13441e-06,2.18076e-06,2.22758e-06,2.27489e-06,2.32268e-06, & 
      2.37093e-06,2.41966e-06,2.46886e-06,2.51852e-06,2.56864e-06, & 
      2.61922e-06,2.67026e-06,2.72175e-06,2.77370e-06,2.82609e-06, & 
      2.87893e-06,2.93221e-06,2.98593e-06,3.04008e-06,3.09468e-06, & 
      3.14970e-06,3.20515e-06,3.26103e-06,3.31732e-06,3.37404e-06, & 
      3.43118e-06,3.48873e-06,3.54669e-06,3.60506e-06,3.66383e-06, & 
      3.72301e-06,3.78259e-06,3.84256e-06,3.90293e-06,3.96368e-06, & 
      4.02483e-06,4.08636e-06,4.14828e-06,4.21057e-06,4.27324e-06, & 
      4.33629e-06,4.39971e-06,4.46350e-06,4.52765e-06,4.59217e-06, & 
      4.65705e-06,4.72228e-06,4.78787e-06,4.85382e-06,4.92011e-06/               
      data (totplnk(idata, 2),idata=51,100)/ &                                              
      4.98675e-06,5.05374e-06,5.12106e-06,5.18873e-06,5.25674e-06, & 
      5.32507e-06,5.39374e-06,5.46274e-06,5.53207e-06,5.60172e-06, & 
      5.67169e-06,5.74198e-06,5.81259e-06,5.88352e-06,5.95475e-06, & 
      6.02629e-06,6.09815e-06,6.17030e-06,6.24276e-06,6.31552e-06, & 
      6.38858e-06,6.46192e-06,6.53557e-06,6.60950e-06,6.68373e-06, & 
      6.75824e-06,6.83303e-06,6.90810e-06,6.98346e-06,7.05909e-06, & 
      7.13500e-06,7.21117e-06,7.28763e-06,7.36435e-06,7.44134e-06, & 
      7.51859e-06,7.59611e-06,7.67388e-06,7.75192e-06,7.83021e-06, & 
      7.90875e-06,7.98755e-06,8.06660e-06,8.14589e-06,8.22544e-06, & 
      8.30522e-06,8.38526e-06,8.46553e-06,8.54604e-06,8.62679e-06/               
      data (totplnk(idata, 2),idata=101,150)/ &                                             
      8.70777e-06,8.78899e-06,8.87043e-06,8.95211e-06,9.03402e-06, & 
      9.11616e-06,9.19852e-06,9.28109e-06,9.36390e-06,9.44692e-06, & 
      9.53015e-06,9.61361e-06,9.69729e-06,9.78117e-06,9.86526e-06, & 
      9.94957e-06,1.00341e-05,1.01188e-05,1.02037e-05,1.02888e-05, & 
      1.03742e-05,1.04597e-05,1.05454e-05,1.06313e-05,1.07175e-05, & 
      1.08038e-05,1.08903e-05,1.09770e-05,1.10639e-05,1.11509e-05, & 
      1.12382e-05,1.13257e-05,1.14133e-05,1.15011e-05,1.15891e-05, & 
      1.16773e-05,1.17656e-05,1.18542e-05,1.19429e-05,1.20317e-05, & 
      1.21208e-05,1.22100e-05,1.22994e-05,1.23890e-05,1.24787e-05, & 
      1.25686e-05,1.26587e-05,1.27489e-05,1.28393e-05,1.29299e-05/               
      data (totplnk(idata, 2),idata=151,181)/ &                                             
      1.30206e-05,1.31115e-05,1.32025e-05,1.32937e-05,1.33850e-05, & 
      1.34765e-05,1.35682e-05,1.36600e-05,1.37520e-05,1.38441e-05, & 
      1.39364e-05,1.40288e-05,1.41213e-05,1.42140e-05,1.43069e-05, & 
      1.43999e-05,1.44930e-05,1.45863e-05,1.46797e-05,1.47733e-05, & 
      1.48670e-05,1.49608e-05,1.50548e-05,1.51489e-05,1.52431e-05, & 
      1.53375e-05,1.54320e-05,1.55267e-05,1.56214e-05,1.57164e-05, & 
      1.58114e-05/                                                               
      data (totplnk(idata, 3),idata=1,50)/ &                                                
      1.34822e-06,1.39134e-06,1.43530e-06,1.48010e-06,1.52574e-06, & 
      1.57222e-06,1.61956e-06,1.66774e-06,1.71678e-06,1.76666e-06, & 
      1.81741e-06,1.86901e-06,1.92147e-06,1.97479e-06,2.02898e-06, & 
      2.08402e-06,2.13993e-06,2.19671e-06,2.25435e-06,2.31285e-06, & 
      2.37222e-06,2.43246e-06,2.49356e-06,2.55553e-06,2.61837e-06, & 
      2.68207e-06,2.74664e-06,2.81207e-06,2.87837e-06,2.94554e-06, & 
      3.01356e-06,3.08245e-06,3.15221e-06,3.22282e-06,3.29429e-06, & 
      3.36662e-06,3.43982e-06,3.51386e-06,3.58876e-06,3.66451e-06, & 
      3.74112e-06,3.81857e-06,3.89688e-06,3.97602e-06,4.05601e-06, & 
      4.13685e-06,4.21852e-06,4.30104e-06,4.38438e-06,4.46857e-06/               
      data (totplnk(idata, 3),idata=51,100)/ &                                              
      4.55358e-06,4.63943e-06,4.72610e-06,4.81359e-06,4.90191e-06, & 
      4.99105e-06,5.08100e-06,5.17176e-06,5.26335e-06,5.35573e-06, & 
      5.44892e-06,5.54292e-06,5.63772e-06,5.73331e-06,5.82970e-06, & 
      5.92688e-06,6.02485e-06,6.12360e-06,6.22314e-06,6.32346e-06, & 
      6.42455e-06,6.52641e-06,6.62906e-06,6.73247e-06,6.83664e-06, & 
      6.94156e-06,7.04725e-06,7.15370e-06,7.26089e-06,7.36883e-06, & 
      7.47752e-06,7.58695e-06,7.69712e-06,7.80801e-06,7.91965e-06, & 
      8.03201e-06,8.14510e-06,8.25891e-06,8.37343e-06,8.48867e-06, & 
      8.60463e-06,8.72128e-06,8.83865e-06,8.95672e-06,9.07548e-06, & 
      9.19495e-06,9.31510e-06,9.43594e-06,9.55745e-06,9.67966e-06/               
      data (totplnk(idata, 3),idata=101,150)/ &                                             
      9.80254e-06,9.92609e-06,1.00503e-05,1.01752e-05,1.03008e-05, & 
      1.04270e-05,1.05539e-05,1.06814e-05,1.08096e-05,1.09384e-05, & 
      1.10679e-05,1.11980e-05,1.13288e-05,1.14601e-05,1.15922e-05, & 
      1.17248e-05,1.18581e-05,1.19920e-05,1.21265e-05,1.22616e-05, & 
      1.23973e-05,1.25337e-05,1.26706e-05,1.28081e-05,1.29463e-05, & 
      1.30850e-05,1.32243e-05,1.33642e-05,1.35047e-05,1.36458e-05, & 
      1.37875e-05,1.39297e-05,1.40725e-05,1.42159e-05,1.43598e-05, & 
      1.45044e-05,1.46494e-05,1.47950e-05,1.49412e-05,1.50879e-05, & 
      1.52352e-05,1.53830e-05,1.55314e-05,1.56803e-05,1.58297e-05, & 
      1.59797e-05,1.61302e-05,1.62812e-05,1.64327e-05,1.65848e-05/               
      data (totplnk(idata, 3),idata=151,181)/ &                                             
      1.67374e-05,1.68904e-05,1.70441e-05,1.71982e-05,1.73528e-05, & 
      1.75079e-05,1.76635e-05,1.78197e-05,1.79763e-05,1.81334e-05, & 
      1.82910e-05,1.84491e-05,1.86076e-05,1.87667e-05,1.89262e-05, & 
      1.90862e-05,1.92467e-05,1.94076e-05,1.95690e-05,1.97309e-05, & 
      1.98932e-05,2.00560e-05,2.02193e-05,2.03830e-05,2.05472e-05, & 
      2.07118e-05,2.08768e-05,2.10423e-05,2.12083e-05,2.13747e-05, & 
      2.15414e-05/                                                               
      data (totplnk(idata, 4),idata=1,50)/ &                                                
      8.90528e-07,9.24222e-07,9.58757e-07,9.94141e-07,1.03038e-06, & 
      1.06748e-06,1.10545e-06,1.14430e-06,1.18403e-06,1.22465e-06, & 
      1.26618e-06,1.30860e-06,1.35193e-06,1.39619e-06,1.44136e-06, & 
      1.48746e-06,1.53449e-06,1.58246e-06,1.63138e-06,1.68124e-06, & 
      1.73206e-06,1.78383e-06,1.83657e-06,1.89028e-06,1.94495e-06, & 
      2.00060e-06,2.05724e-06,2.11485e-06,2.17344e-06,2.23303e-06, & 
      2.29361e-06,2.35519e-06,2.41777e-06,2.48134e-06,2.54592e-06, & 
      2.61151e-06,2.67810e-06,2.74571e-06,2.81433e-06,2.88396e-06, & 
      2.95461e-06,3.02628e-06,3.09896e-06,3.17267e-06,3.24741e-06, & 
      3.32316e-06,3.39994e-06,3.47774e-06,3.55657e-06,3.63642e-06/               
      data (totplnk(idata, 4),idata=51,100)/ &                                              
      3.71731e-06,3.79922e-06,3.88216e-06,3.96612e-06,4.05112e-06, & 
      4.13714e-06,4.22419e-06,4.31227e-06,4.40137e-06,4.49151e-06, & 
      4.58266e-06,4.67485e-06,4.76806e-06,4.86229e-06,4.95754e-06, & 
      5.05383e-06,5.15113e-06,5.24946e-06,5.34879e-06,5.44916e-06, & 
      5.55053e-06,5.65292e-06,5.75632e-06,5.86073e-06,5.96616e-06, & 
      6.07260e-06,6.18003e-06,6.28848e-06,6.39794e-06,6.50838e-06, & 
      6.61983e-06,6.73229e-06,6.84573e-06,6.96016e-06,7.07559e-06, & 
      7.19200e-06,7.30940e-06,7.42779e-06,7.54715e-06,7.66749e-06, & 
      7.78882e-06,7.91110e-06,8.03436e-06,8.15859e-06,8.28379e-06, & 
      8.40994e-06,8.53706e-06,8.66515e-06,8.79418e-06,8.92416e-06/               
      data (totplnk(idata, 4),idata=101,150)/ &                                             
      9.05510e-06,9.18697e-06,9.31979e-06,9.45356e-06,9.58826e-06, & 
      9.72389e-06,9.86046e-06,9.99793e-06,1.01364e-05,1.02757e-05, & 
      1.04159e-05,1.05571e-05,1.06992e-05,1.08422e-05,1.09861e-05, & 
      1.11309e-05,1.12766e-05,1.14232e-05,1.15707e-05,1.17190e-05, & 
      1.18683e-05,1.20184e-05,1.21695e-05,1.23214e-05,1.24741e-05, & 
      1.26277e-05,1.27822e-05,1.29376e-05,1.30939e-05,1.32509e-05, & 
      1.34088e-05,1.35676e-05,1.37273e-05,1.38877e-05,1.40490e-05, & 
      1.42112e-05,1.43742e-05,1.45380e-05,1.47026e-05,1.48680e-05, & 
      1.50343e-05,1.52014e-05,1.53692e-05,1.55379e-05,1.57074e-05, & 
      1.58778e-05,1.60488e-05,1.62207e-05,1.63934e-05,1.65669e-05/               
      data (totplnk(idata, 4),idata=151,181)/ &                                             
      1.67411e-05,1.69162e-05,1.70920e-05,1.72685e-05,1.74459e-05, & 
      1.76240e-05,1.78029e-05,1.79825e-05,1.81629e-05,1.83440e-05, & 
      1.85259e-05,1.87086e-05,1.88919e-05,1.90760e-05,1.92609e-05, & 
      1.94465e-05,1.96327e-05,1.98199e-05,2.00076e-05,2.01961e-05, & 
      2.03853e-05,2.05752e-05,2.07658e-05,2.09571e-05,2.11491e-05, & 
      2.13418e-05,2.15352e-05,2.17294e-05,2.19241e-05,2.21196e-05, & 
      2.23158e-05/                                                               
      data (totplnk(idata, 5),idata=1,50)/ &                                                
      5.70230e-07,5.94788e-07,6.20085e-07,6.46130e-07,6.72936e-07, & 
      7.00512e-07,7.28869e-07,7.58019e-07,7.87971e-07,8.18734e-07, & 
      8.50320e-07,8.82738e-07,9.15999e-07,9.50110e-07,9.85084e-07, & 
      1.02093e-06,1.05765e-06,1.09527e-06,1.13378e-06,1.17320e-06, & 
      1.21353e-06,1.25479e-06,1.29698e-06,1.34011e-06,1.38419e-06, & 
      1.42923e-06,1.47523e-06,1.52221e-06,1.57016e-06,1.61910e-06, & 
      1.66904e-06,1.71997e-06,1.77192e-06,1.82488e-06,1.87886e-06, & 
      1.93387e-06,1.98991e-06,2.04699e-06,2.10512e-06,2.16430e-06, & 
      2.22454e-06,2.28584e-06,2.34821e-06,2.41166e-06,2.47618e-06, & 
      2.54178e-06,2.60847e-06,2.67626e-06,2.74514e-06,2.81512e-06/               
      data (totplnk(idata, 5),idata=51,100)/ &                                              
      2.88621e-06,2.95841e-06,3.03172e-06,3.10615e-06,3.18170e-06, & 
      3.25838e-06,3.33618e-06,3.41511e-06,3.49518e-06,3.57639e-06, & 
      3.65873e-06,3.74221e-06,3.82684e-06,3.91262e-06,3.99955e-06, & 
      4.08763e-06,4.17686e-06,4.26725e-06,4.35880e-06,4.45150e-06, & 
      4.54537e-06,4.64039e-06,4.73659e-06,4.83394e-06,4.93246e-06, & 
      5.03215e-06,5.13301e-06,5.23504e-06,5.33823e-06,5.44260e-06, & 
      5.54814e-06,5.65484e-06,5.76272e-06,5.87177e-06,5.98199e-06, & 
      6.09339e-06,6.20596e-06,6.31969e-06,6.43460e-06,6.55068e-06, & 
      6.66793e-06,6.78636e-06,6.90595e-06,7.02670e-06,7.14863e-06, & 
      7.27173e-06,7.39599e-06,7.52142e-06,7.64802e-06,7.77577e-06/               
      data (totplnk(idata, 5),idata=101,150)/ &                                             
      7.90469e-06,8.03477e-06,8.16601e-06,8.29841e-06,8.43198e-06, & 
      8.56669e-06,8.70256e-06,8.83957e-06,8.97775e-06,9.11706e-06, & 
      9.25753e-06,9.39915e-06,9.54190e-06,9.68580e-06,9.83085e-06, & 
      9.97704e-06,1.01243e-05,1.02728e-05,1.04224e-05,1.05731e-05, & 
      1.07249e-05,1.08779e-05,1.10320e-05,1.11872e-05,1.13435e-05, & 
      1.15009e-05,1.16595e-05,1.18191e-05,1.19799e-05,1.21418e-05, & 
      1.23048e-05,1.24688e-05,1.26340e-05,1.28003e-05,1.29676e-05, & 
      1.31361e-05,1.33056e-05,1.34762e-05,1.36479e-05,1.38207e-05, & 
      1.39945e-05,1.41694e-05,1.43454e-05,1.45225e-05,1.47006e-05, & 
      1.48797e-05,1.50600e-05,1.52413e-05,1.54236e-05,1.56070e-05/               
      data (totplnk(idata, 5),idata=151,181)/ &                                             
      1.57914e-05,1.59768e-05,1.61633e-05,1.63509e-05,1.65394e-05, & 
      1.67290e-05,1.69197e-05,1.71113e-05,1.73040e-05,1.74976e-05, & 
      1.76923e-05,1.78880e-05,1.80847e-05,1.82824e-05,1.84811e-05, & 
      1.86808e-05,1.88814e-05,1.90831e-05,1.92857e-05,1.94894e-05, & 
      1.96940e-05,1.98996e-05,2.01061e-05,2.03136e-05,2.05221e-05, & 
      2.07316e-05,2.09420e-05,2.11533e-05,2.13657e-05,2.15789e-05, & 
      2.17931e-05/                                                               
      data (totplnk(idata, 6),idata=1,50)/ &                                                
      2.73493e-07,2.87408e-07,3.01848e-07,3.16825e-07,3.32352e-07, & 
      3.48439e-07,3.65100e-07,3.82346e-07,4.00189e-07,4.18641e-07, & 
      4.37715e-07,4.57422e-07,4.77774e-07,4.98784e-07,5.20464e-07, & 
      5.42824e-07,5.65879e-07,5.89638e-07,6.14115e-07,6.39320e-07, & 
      6.65266e-07,6.91965e-07,7.19427e-07,7.47666e-07,7.76691e-07, & 
      8.06516e-07,8.37151e-07,8.68607e-07,9.00896e-07,9.34029e-07, & 
      9.68018e-07,1.00287e-06,1.03860e-06,1.07522e-06,1.11274e-06, & 
      1.15117e-06,1.19052e-06,1.23079e-06,1.27201e-06,1.31418e-06, & 
      1.35731e-06,1.40141e-06,1.44650e-06,1.49257e-06,1.53965e-06, & 
      1.58773e-06,1.63684e-06,1.68697e-06,1.73815e-06,1.79037e-06/               
      data (totplnk(idata, 6),idata=51,100)/ &                                              
      1.84365e-06,1.89799e-06,1.95341e-06,2.00991e-06,2.06750e-06, & 
      2.12619e-06,2.18599e-06,2.24691e-06,2.30895e-06,2.37212e-06, & 
      2.43643e-06,2.50189e-06,2.56851e-06,2.63628e-06,2.70523e-06, & 
      2.77536e-06,2.84666e-06,2.91916e-06,2.99286e-06,3.06776e-06, & 
      3.14387e-06,3.22120e-06,3.29975e-06,3.37953e-06,3.46054e-06, & 
      3.54280e-06,3.62630e-06,3.71105e-06,3.79707e-06,3.88434e-06, & 
      3.97288e-06,4.06270e-06,4.15380e-06,4.24617e-06,4.33984e-06, & 
      4.43479e-06,4.53104e-06,4.62860e-06,4.72746e-06,4.82763e-06, & 
      4.92911e-06,5.03191e-06,5.13603e-06,5.24147e-06,5.34824e-06, & 
      5.45634e-06,5.56578e-06,5.67656e-06,5.78867e-06,5.90213e-06/               
      data (totplnk(idata, 6),idata=101,150)/ &                                             
      6.01694e-06,6.13309e-06,6.25060e-06,6.36947e-06,6.48968e-06, & 
      6.61126e-06,6.73420e-06,6.85850e-06,6.98417e-06,7.11120e-06, & 
      7.23961e-06,7.36938e-06,7.50053e-06,7.63305e-06,7.76694e-06, & 
      7.90221e-06,8.03887e-06,8.17690e-06,8.31632e-06,8.45710e-06, & 
      8.59928e-06,8.74282e-06,8.88776e-06,9.03409e-06,9.18179e-06, & 
      9.33088e-06,9.48136e-06,9.63323e-06,9.78648e-06,9.94111e-06, & 
      1.00971e-05,1.02545e-05,1.04133e-05,1.05735e-05,1.07351e-05, & 
      1.08980e-05,1.10624e-05,1.12281e-05,1.13952e-05,1.15637e-05, & 
      1.17335e-05,1.19048e-05,1.20774e-05,1.22514e-05,1.24268e-05, & 
      1.26036e-05,1.27817e-05,1.29612e-05,1.31421e-05,1.33244e-05/               
      data (totplnk(idata, 6),idata=151,181)/ &                                             
      1.35080e-05,1.36930e-05,1.38794e-05,1.40672e-05,1.42563e-05, & 
      1.44468e-05,1.46386e-05,1.48318e-05,1.50264e-05,1.52223e-05, & 
      1.54196e-05,1.56182e-05,1.58182e-05,1.60196e-05,1.62223e-05, & 
      1.64263e-05,1.66317e-05,1.68384e-05,1.70465e-05,1.72559e-05, & 
      1.74666e-05,1.76787e-05,1.78921e-05,1.81069e-05,1.83230e-05, & 
      1.85404e-05,1.87591e-05,1.89791e-05,1.92005e-05,1.94232e-05, & 
      1.96471e-05/                                                               
      data (totplnk(idata, 7),idata=1,50)/ &                                                
      1.25349e-07,1.32735e-07,1.40458e-07,1.48527e-07,1.56954e-07, & 
      1.65748e-07,1.74920e-07,1.84481e-07,1.94443e-07,2.04814e-07, & 
      2.15608e-07,2.26835e-07,2.38507e-07,2.50634e-07,2.63229e-07, & 
      2.76301e-07,2.89864e-07,3.03930e-07,3.18508e-07,3.33612e-07, & 
      3.49253e-07,3.65443e-07,3.82195e-07,3.99519e-07,4.17428e-07, & 
      4.35934e-07,4.55050e-07,4.74785e-07,4.95155e-07,5.16170e-07, & 
      5.37844e-07,5.60186e-07,5.83211e-07,6.06929e-07,6.31355e-07, & 
      6.56498e-07,6.82373e-07,7.08990e-07,7.36362e-07,7.64501e-07, & 
      7.93420e-07,8.23130e-07,8.53643e-07,8.84971e-07,9.17128e-07, & 
      9.50123e-07,9.83969e-07,1.01868e-06,1.05426e-06,1.09073e-06/               
      data (totplnk(idata, 7),idata=51,100)/ &                                              
      1.12810e-06,1.16638e-06,1.20558e-06,1.24572e-06,1.28680e-06, & 
      1.32883e-06,1.37183e-06,1.41581e-06,1.46078e-06,1.50675e-06, & 
      1.55374e-06,1.60174e-06,1.65078e-06,1.70087e-06,1.75200e-06, & 
      1.80421e-06,1.85749e-06,1.91186e-06,1.96732e-06,2.02389e-06, & 
      2.08159e-06,2.14040e-06,2.20035e-06,2.26146e-06,2.32372e-06, & 
      2.38714e-06,2.45174e-06,2.51753e-06,2.58451e-06,2.65270e-06, & 
      2.72210e-06,2.79272e-06,2.86457e-06,2.93767e-06,3.01201e-06, & 
      3.08761e-06,3.16448e-06,3.24261e-06,3.32204e-06,3.40275e-06, & 
      3.48476e-06,3.56808e-06,3.65271e-06,3.73866e-06,3.82595e-06, & 
      3.91456e-06,4.00453e-06,4.09584e-06,4.18851e-06,4.28254e-06/               
      data (totplnk(idata, 7),idata=101,150)/ &                                             
      4.37796e-06,4.47475e-06,4.57293e-06,4.67249e-06,4.77346e-06, & 
      4.87583e-06,4.97961e-06,5.08481e-06,5.19143e-06,5.29948e-06, & 
      5.40896e-06,5.51989e-06,5.63226e-06,5.74608e-06,5.86136e-06, & 
      5.97810e-06,6.09631e-06,6.21597e-06,6.33713e-06,6.45976e-06, & 
      6.58388e-06,6.70950e-06,6.83661e-06,6.96521e-06,7.09531e-06, & 
      7.22692e-06,7.36005e-06,7.49468e-06,7.63084e-06,7.76851e-06, & 
      7.90773e-06,8.04846e-06,8.19072e-06,8.33452e-06,8.47985e-06, & 
      8.62674e-06,8.77517e-06,8.92514e-06,9.07666e-06,9.22975e-06, & 
      9.38437e-06,9.54057e-06,9.69832e-06,9.85762e-06,1.00185e-05, & 
      1.01810e-05,1.03450e-05,1.05106e-05,1.06777e-05,1.08465e-05/               
      data (totplnk(idata, 7),idata=151,181)/ &                                             
      1.10168e-05,1.11887e-05,1.13621e-05,1.15372e-05,1.17138e-05, & 
      1.18920e-05,1.20718e-05,1.22532e-05,1.24362e-05,1.26207e-05, & 
      1.28069e-05,1.29946e-05,1.31839e-05,1.33749e-05,1.35674e-05, & 
      1.37615e-05,1.39572e-05,1.41544e-05,1.43533e-05,1.45538e-05, & 
      1.47558e-05,1.49595e-05,1.51647e-05,1.53716e-05,1.55800e-05, & 
      1.57900e-05,1.60017e-05,1.62149e-05,1.64296e-05,1.66460e-05, & 
      1.68640e-05/                                                               
      data (totplnk(idata, 8),idata=1,50)/ &                                                
      6.74445e-08,7.18176e-08,7.64153e-08,8.12456e-08,8.63170e-08, & 
      9.16378e-08,9.72168e-08,1.03063e-07,1.09184e-07,1.15591e-07, & 
      1.22292e-07,1.29296e-07,1.36613e-07,1.44253e-07,1.52226e-07, & 
      1.60540e-07,1.69207e-07,1.78236e-07,1.87637e-07,1.97421e-07, & 
      2.07599e-07,2.18181e-07,2.29177e-07,2.40598e-07,2.52456e-07, & 
      2.64761e-07,2.77523e-07,2.90755e-07,3.04468e-07,3.18673e-07, & 
      3.33381e-07,3.48603e-07,3.64352e-07,3.80638e-07,3.97474e-07, & 
      4.14871e-07,4.32841e-07,4.51395e-07,4.70547e-07,4.90306e-07, & 
      5.10687e-07,5.31699e-07,5.53357e-07,5.75670e-07,5.98652e-07, & 
      6.22315e-07,6.46672e-07,6.71731e-07,6.97511e-07,7.24018e-07/               
      data (totplnk(idata, 8),idata=51,100)/ &                                              
      7.51266e-07,7.79269e-07,8.08038e-07,8.37584e-07,8.67922e-07, & 
      8.99061e-07,9.31016e-07,9.63797e-07,9.97417e-07,1.03189e-06, & 
      1.06722e-06,1.10343e-06,1.14053e-06,1.17853e-06,1.21743e-06, & 
      1.25726e-06,1.29803e-06,1.33974e-06,1.38241e-06,1.42606e-06, & 
      1.47068e-06,1.51630e-06,1.56293e-06,1.61056e-06,1.65924e-06, & 
      1.70894e-06,1.75971e-06,1.81153e-06,1.86443e-06,1.91841e-06, & 
      1.97350e-06,2.02968e-06,2.08699e-06,2.14543e-06,2.20500e-06, & 
      2.26573e-06,2.32762e-06,2.39068e-06,2.45492e-06,2.52036e-06, & 
      2.58700e-06,2.65485e-06,2.72393e-06,2.79424e-06,2.86580e-06, & 
      2.93861e-06,3.01269e-06,3.08803e-06,3.16467e-06,3.24259e-06/               
      data (totplnk(idata, 8),idata=101,150)/ &                                             
      3.32181e-06,3.40235e-06,3.48420e-06,3.56739e-06,3.65192e-06, & 
      3.73779e-06,3.82502e-06,3.91362e-06,4.00359e-06,4.09494e-06, & 
      4.18768e-06,4.28182e-06,4.37737e-06,4.47434e-06,4.57273e-06, & 
      4.67254e-06,4.77380e-06,4.87651e-06,4.98067e-06,5.08630e-06, & 
      5.19339e-06,5.30196e-06,5.41201e-06,5.52356e-06,5.63660e-06, & 
      5.75116e-06,5.86722e-06,5.98479e-06,6.10390e-06,6.22453e-06, & 
      6.34669e-06,6.47042e-06,6.59569e-06,6.72252e-06,6.85090e-06, & 
      6.98085e-06,7.11238e-06,7.24549e-06,7.38019e-06,7.51646e-06, & 
      7.65434e-06,7.79382e-06,7.93490e-06,8.07760e-06,8.22192e-06, & 
      8.36784e-06,8.51540e-06,8.66459e-06,8.81542e-06,8.96786e-06/               
      data (totplnk(idata, 8),idata=151,181)/ &                                             
      9.12197e-06,9.27772e-06,9.43513e-06,9.59419e-06,9.75490e-06, & 
      9.91728e-06,1.00813e-05,1.02471e-05,1.04144e-05,1.05835e-05, & 
      1.07543e-05,1.09267e-05,1.11008e-05,1.12766e-05,1.14541e-05, & 
      1.16333e-05,1.18142e-05,1.19969e-05,1.21812e-05,1.23672e-05, & 
      1.25549e-05,1.27443e-05,1.29355e-05,1.31284e-05,1.33229e-05, & 
      1.35193e-05,1.37173e-05,1.39170e-05,1.41185e-05,1.43217e-05, & 
      1.45267e-05/                                                               
      data (totplnk(idata, 9),idata=1,50)/ &                                                
      2.61522e-08,2.80613e-08,3.00838e-08,3.22250e-08,3.44899e-08, & 
      3.68841e-08,3.94129e-08,4.20820e-08,4.48973e-08,4.78646e-08, & 
      5.09901e-08,5.42799e-08,5.77405e-08,6.13784e-08,6.52001e-08, & 
      6.92126e-08,7.34227e-08,7.78375e-08,8.24643e-08,8.73103e-08, & 
      9.23832e-08,9.76905e-08,1.03240e-07,1.09039e-07,1.15097e-07, & 
      1.21421e-07,1.28020e-07,1.34902e-07,1.42075e-07,1.49548e-07, & 
      1.57331e-07,1.65432e-07,1.73860e-07,1.82624e-07,1.91734e-07, & 
      2.01198e-07,2.11028e-07,2.21231e-07,2.31818e-07,2.42799e-07, & 
      2.54184e-07,2.65983e-07,2.78205e-07,2.90862e-07,3.03963e-07, & 
      3.17519e-07,3.31541e-07,3.46039e-07,3.61024e-07,3.76507e-07/               
      data (totplnk(idata, 9),idata=51,100)/ &                                              
      3.92498e-07,4.09008e-07,4.26050e-07,4.43633e-07,4.61769e-07, & 
      4.80469e-07,4.99744e-07,5.19606e-07,5.40067e-07,5.61136e-07, & 
      5.82828e-07,6.05152e-07,6.28120e-07,6.51745e-07,6.76038e-07, & 
      7.01010e-07,7.26674e-07,7.53041e-07,7.80124e-07,8.07933e-07, & 
      8.36482e-07,8.65781e-07,8.95845e-07,9.26683e-07,9.58308e-07, & 
      9.90732e-07,1.02397e-06,1.05803e-06,1.09292e-06,1.12866e-06, & 
      1.16526e-06,1.20274e-06,1.24109e-06,1.28034e-06,1.32050e-06, & 
      1.36158e-06,1.40359e-06,1.44655e-06,1.49046e-06,1.53534e-06, & 
      1.58120e-06,1.62805e-06,1.67591e-06,1.72478e-06,1.77468e-06, & 
      1.82561e-06,1.87760e-06,1.93066e-06,1.98479e-06,2.04000e-06/               
      data (totplnk(idata, 9),idata=101,150)/ &                                             
      2.09631e-06,2.15373e-06,2.21228e-06,2.27196e-06,2.33278e-06, & 
      2.39475e-06,2.45790e-06,2.52222e-06,2.58773e-06,2.65445e-06, & 
      2.72238e-06,2.79152e-06,2.86191e-06,2.93354e-06,3.00643e-06, & 
      3.08058e-06,3.15601e-06,3.23273e-06,3.31075e-06,3.39009e-06, & 
      3.47074e-06,3.55272e-06,3.63605e-06,3.72072e-06,3.80676e-06, & 
      3.89417e-06,3.98297e-06,4.07315e-06,4.16474e-06,4.25774e-06, & 
      4.35217e-06,4.44802e-06,4.54532e-06,4.64406e-06,4.74428e-06, & 
      4.84595e-06,4.94911e-06,5.05376e-06,5.15990e-06,5.26755e-06, & 
      5.37671e-06,5.48741e-06,5.59963e-06,5.71340e-06,5.82871e-06, & 
      5.94559e-06,6.06403e-06,6.18404e-06,6.30565e-06,6.42885e-06/               
      data (totplnk(idata, 9),idata=151,181)/ &                                             
      6.55364e-06,6.68004e-06,6.80806e-06,6.93771e-06,7.06898e-06, & 
      7.20190e-06,7.33646e-06,7.47267e-06,7.61056e-06,7.75010e-06, & 
      7.89133e-06,8.03423e-06,8.17884e-06,8.32514e-06,8.47314e-06, & 
      8.62284e-06,8.77427e-06,8.92743e-06,9.08231e-06,9.23893e-06, & 
      9.39729e-06,9.55741e-06,9.71927e-06,9.88291e-06,1.00483e-05, & 
      1.02155e-05,1.03844e-05,1.05552e-05,1.07277e-05,1.09020e-05, & 
      1.10781e-05/                                                               
      data (totplnk(idata,10),idata=1,50)/ &                                                
      8.89300e-09,9.63263e-09,1.04235e-08,1.12685e-08,1.21703e-08, & 
      1.31321e-08,1.41570e-08,1.52482e-08,1.64090e-08,1.76428e-08, & 
      1.89533e-08,2.03441e-08,2.18190e-08,2.33820e-08,2.50370e-08, & 
      2.67884e-08,2.86402e-08,3.05969e-08,3.26632e-08,3.48436e-08, & 
      3.71429e-08,3.95660e-08,4.21179e-08,4.48040e-08,4.76294e-08, & 
      5.05996e-08,5.37201e-08,5.69966e-08,6.04349e-08,6.40411e-08, & 
      6.78211e-08,7.17812e-08,7.59276e-08,8.02670e-08,8.48059e-08, & 
      8.95508e-08,9.45090e-08,9.96873e-08,1.05093e-07,1.10733e-07, & 
      1.16614e-07,1.22745e-07,1.29133e-07,1.35786e-07,1.42711e-07, & 
      1.49916e-07,1.57410e-07,1.65202e-07,1.73298e-07,1.81709e-07/               
      data (totplnk(idata,10),idata=51,100)/ &                                              
      1.90441e-07,1.99505e-07,2.08908e-07,2.18660e-07,2.28770e-07, & 
      2.39247e-07,2.50101e-07,2.61340e-07,2.72974e-07,2.85013e-07, & 
      2.97467e-07,3.10345e-07,3.23657e-07,3.37413e-07,3.51623e-07, & 
      3.66298e-07,3.81448e-07,3.97082e-07,4.13212e-07,4.29848e-07, & 
      4.47000e-07,4.64680e-07,4.82898e-07,5.01664e-07,5.20991e-07, & 
      5.40888e-07,5.61369e-07,5.82440e-07,6.04118e-07,6.26410e-07, & 
      6.49329e-07,6.72887e-07,6.97095e-07,7.21964e-07,7.47506e-07, & 
      7.73732e-07,8.00655e-07,8.28287e-07,8.56635e-07,8.85717e-07, & 
      9.15542e-07,9.46122e-07,9.77469e-07,1.00960e-06,1.04251e-06, & 
      1.07623e-06,1.11077e-06,1.14613e-06,1.18233e-06,1.21939e-06/               
      data (totplnk(idata,10),idata=101,150)/ &                                             
      1.25730e-06,1.29610e-06,1.33578e-06,1.37636e-06,1.41785e-06, & 
      1.46027e-06,1.50362e-06,1.54792e-06,1.59319e-06,1.63942e-06, & 
      1.68665e-06,1.73487e-06,1.78410e-06,1.83435e-06,1.88564e-06, & 
      1.93797e-06,1.99136e-06,2.04582e-06,2.10137e-06,2.15801e-06, & 
      2.21576e-06,2.27463e-06,2.33462e-06,2.39577e-06,2.45806e-06, & 
      2.52153e-06,2.58617e-06,2.65201e-06,2.71905e-06,2.78730e-06, & 
      2.85678e-06,2.92749e-06,2.99946e-06,3.07269e-06,3.14720e-06, & 
      3.22299e-06,3.30007e-06,3.37847e-06,3.45818e-06,3.53923e-06, & 
      3.62161e-06,3.70535e-06,3.79046e-06,3.87695e-06,3.96481e-06, & 
      4.05409e-06,4.14477e-06,4.23687e-06,4.33040e-06,4.42538e-06/               
      data (totplnk(idata,10),idata=151,181)/ &                                             
      4.52180e-06,4.61969e-06,4.71905e-06,4.81991e-06,4.92226e-06, & 
      5.02611e-06,5.13148e-06,5.23839e-06,5.34681e-06,5.45681e-06, & 
      5.56835e-06,5.68146e-06,5.79614e-06,5.91242e-06,6.03030e-06, & 
      6.14978e-06,6.27088e-06,6.39360e-06,6.51798e-06,6.64398e-06, & 
      6.77165e-06,6.90099e-06,7.03198e-06,7.16468e-06,7.29906e-06, & 
      7.43514e-06,7.57294e-06,7.71244e-06,7.85369e-06,7.99666e-06, & 
      8.14138e-06/                                                               
      data (totplnk(idata,11),idata=1,50)/ &                                                
      2.53767e-09,2.77242e-09,3.02564e-09,3.29851e-09,3.59228e-09, & 
      3.90825e-09,4.24777e-09,4.61227e-09,5.00322e-09,5.42219e-09, & 
      5.87080e-09,6.35072e-09,6.86370e-09,7.41159e-09,7.99628e-09, & 
      8.61974e-09,9.28404e-09,9.99130e-09,1.07437e-08,1.15436e-08, & 
      1.23933e-08,1.32953e-08,1.42522e-08,1.52665e-08,1.63410e-08, & 
      1.74786e-08,1.86820e-08,1.99542e-08,2.12985e-08,2.27179e-08, & 
      2.42158e-08,2.57954e-08,2.74604e-08,2.92141e-08,3.10604e-08, & 
      3.30029e-08,3.50457e-08,3.71925e-08,3.94476e-08,4.18149e-08, & 
      4.42991e-08,4.69043e-08,4.96352e-08,5.24961e-08,5.54921e-08, & 
      5.86277e-08,6.19081e-08,6.53381e-08,6.89231e-08,7.26681e-08/               
      data (totplnk(idata,11),idata=51,100)/ &                                              
      7.65788e-08,8.06604e-08,8.49187e-08,8.93591e-08,9.39879e-08, & 
      9.88106e-08,1.03834e-07,1.09063e-07,1.14504e-07,1.20165e-07, & 
      1.26051e-07,1.32169e-07,1.38525e-07,1.45128e-07,1.51982e-07, & 
      1.59096e-07,1.66477e-07,1.74132e-07,1.82068e-07,1.90292e-07, & 
      1.98813e-07,2.07638e-07,2.16775e-07,2.26231e-07,2.36015e-07, & 
      2.46135e-07,2.56599e-07,2.67415e-07,2.78592e-07,2.90137e-07, & 
      3.02061e-07,3.14371e-07,3.27077e-07,3.40186e-07,3.53710e-07, & 
      3.67655e-07,3.82031e-07,3.96848e-07,4.12116e-07,4.27842e-07, & 
      4.44039e-07,4.60713e-07,4.77876e-07,4.95537e-07,5.13706e-07, & 
      5.32392e-07,5.51608e-07,5.71360e-07,5.91662e-07,6.12521e-07/               
      data (totplnk(idata,11),idata=101,150)/ &                                             
      6.33950e-07,6.55958e-07,6.78556e-07,7.01753e-07,7.25562e-07, & 
      7.49992e-07,7.75055e-07,8.00760e-07,8.27120e-07,8.54145e-07, & 
      8.81845e-07,9.10233e-07,9.39318e-07,9.69113e-07,9.99627e-07, & 
      1.03087e-06,1.06286e-06,1.09561e-06,1.12912e-06,1.16340e-06, & 
      1.19848e-06,1.23435e-06,1.27104e-06,1.30855e-06,1.34690e-06, & 
      1.38609e-06,1.42614e-06,1.46706e-06,1.50886e-06,1.55155e-06, & 
      1.59515e-06,1.63967e-06,1.68512e-06,1.73150e-06,1.77884e-06, & 
      1.82715e-06,1.87643e-06,1.92670e-06,1.97797e-06,2.03026e-06, & 
      2.08356e-06,2.13791e-06,2.19330e-06,2.24975e-06,2.30728e-06, & 
      2.36589e-06,2.42560e-06,2.48641e-06,2.54835e-06,2.61142e-06/               
      data (totplnk(idata,11),idata=151,181)/ &                                             
      2.67563e-06,2.74100e-06,2.80754e-06,2.87526e-06,2.94417e-06, & 
      3.01429e-06,3.08562e-06,3.15819e-06,3.23199e-06,3.30704e-06, & 
      3.38336e-06,3.46096e-06,3.53984e-06,3.62002e-06,3.70151e-06, & 
      3.78433e-06,3.86848e-06,3.95399e-06,4.04084e-06,4.12907e-06, & 
      4.21868e-06,4.30968e-06,4.40209e-06,4.49592e-06,4.59117e-06, & 
      4.68786e-06,4.78600e-06,4.88561e-06,4.98669e-06,5.08926e-06, & 
      5.19332e-06/                                                               
      data (totplnk(idata,12),idata=1,50)/ &                                                
      2.73921e-10,3.04500e-10,3.38056e-10,3.74835e-10,4.15099e-10, & 
      4.59126e-10,5.07214e-10,5.59679e-10,6.16857e-10,6.79103e-10, & 
      7.46796e-10,8.20335e-10,9.00144e-10,9.86671e-10,1.08039e-09, & 
      1.18180e-09,1.29142e-09,1.40982e-09,1.53757e-09,1.67529e-09, & 
      1.82363e-09,1.98327e-09,2.15492e-09,2.33932e-09,2.53726e-09, & 
      2.74957e-09,2.97710e-09,3.22075e-09,3.48145e-09,3.76020e-09, & 
      4.05801e-09,4.37595e-09,4.71513e-09,5.07672e-09,5.46193e-09, & 
      5.87201e-09,6.30827e-09,6.77205e-09,7.26480e-09,7.78794e-09, & 
      8.34304e-09,8.93163e-09,9.55537e-09,1.02159e-08,1.09151e-08, & 
      1.16547e-08,1.24365e-08,1.32625e-08,1.41348e-08,1.50554e-08/               
      data (totplnk(idata,12),idata=51,100)/ &                                              
      1.60264e-08,1.70500e-08,1.81285e-08,1.92642e-08,2.04596e-08, & 
      2.17171e-08,2.30394e-08,2.44289e-08,2.58885e-08,2.74209e-08, & 
      2.90290e-08,3.07157e-08,3.24841e-08,3.43371e-08,3.62782e-08, & 
      3.83103e-08,4.04371e-08,4.26617e-08,4.49878e-08,4.74190e-08, & 
      4.99589e-08,5.26113e-08,5.53801e-08,5.82692e-08,6.12826e-08, & 
      6.44245e-08,6.76991e-08,7.11105e-08,7.46634e-08,7.83621e-08, & 
      8.22112e-08,8.62154e-08,9.03795e-08,9.47081e-08,9.92066e-08, & 
      1.03879e-07,1.08732e-07,1.13770e-07,1.18998e-07,1.24422e-07, & 
      1.30048e-07,1.35880e-07,1.41924e-07,1.48187e-07,1.54675e-07, & 
      1.61392e-07,1.68346e-07,1.75543e-07,1.82988e-07,1.90688e-07/               
      data (totplnk(idata,12),idata=101,150)/ &                                             
      1.98650e-07,2.06880e-07,2.15385e-07,2.24172e-07,2.33247e-07, & 
      2.42617e-07,2.52289e-07,2.62272e-07,2.72571e-07,2.83193e-07, & 
      2.94147e-07,3.05440e-07,3.17080e-07,3.29074e-07,3.41430e-07, & 
      3.54155e-07,3.67259e-07,3.80747e-07,3.94631e-07,4.08916e-07, & 
      4.23611e-07,4.38725e-07,4.54267e-07,4.70245e-07,4.86666e-07, & 
      5.03541e-07,5.20879e-07,5.38687e-07,5.56975e-07,5.75751e-07, & 
      5.95026e-07,6.14808e-07,6.35107e-07,6.55932e-07,6.77293e-07, & 
      6.99197e-07,7.21656e-07,7.44681e-07,7.68278e-07,7.92460e-07, & 
      8.17235e-07,8.42614e-07,8.68606e-07,8.95223e-07,9.22473e-07, & 
      9.50366e-07,9.78915e-07,1.00813e-06,1.03802e-06,1.06859e-06/               
      data (totplnk(idata,12),idata=151,181)/ &                                             
      1.09986e-06,1.13184e-06,1.16453e-06,1.19796e-06,1.23212e-06, & 
      1.26703e-06,1.30270e-06,1.33915e-06,1.37637e-06,1.41440e-06, & 
      1.45322e-06,1.49286e-06,1.53333e-06,1.57464e-06,1.61679e-06, & 
      1.65981e-06,1.70370e-06,1.74847e-06,1.79414e-06,1.84071e-06, & 
      1.88821e-06,1.93663e-06,1.98599e-06,2.03631e-06,2.08759e-06, & 
      2.13985e-06,2.19310e-06,2.24734e-06,2.30260e-06,2.35888e-06, & 
      2.41619e-06/                                                               
      data (totplnk(idata,13),idata=1,50)/ &                                                
      4.53634e-11,5.11435e-11,5.75754e-11,6.47222e-11,7.26531e-11, & 
      8.14420e-11,9.11690e-11,1.01921e-10,1.13790e-10,1.26877e-10, & 
      1.41288e-10,1.57140e-10,1.74555e-10,1.93665e-10,2.14613e-10, & 
      2.37548e-10,2.62633e-10,2.90039e-10,3.19948e-10,3.52558e-10, & 
      3.88073e-10,4.26716e-10,4.68719e-10,5.14331e-10,5.63815e-10, & 
      6.17448e-10,6.75526e-10,7.38358e-10,8.06277e-10,8.79625e-10, & 
      9.58770e-10,1.04410e-09,1.13602e-09,1.23495e-09,1.34135e-09, & 
      1.45568e-09,1.57845e-09,1.71017e-09,1.85139e-09,2.00268e-09, & 
      2.16464e-09,2.33789e-09,2.52309e-09,2.72093e-09,2.93212e-09, & 
      3.15740e-09,3.39757e-09,3.65341e-09,3.92579e-09,4.21559e-09/               
      data (totplnk(idata,13),idata=51,100)/ &                                              
      4.52372e-09,4.85115e-09,5.19886e-09,5.56788e-09,5.95928e-09, & 
      6.37419e-09,6.81375e-09,7.27917e-09,7.77168e-09,8.29256e-09, & 
      8.84317e-09,9.42487e-09,1.00391e-08,1.06873e-08,1.13710e-08, & 
      1.20919e-08,1.28515e-08,1.36514e-08,1.44935e-08,1.53796e-08, & 
      1.63114e-08,1.72909e-08,1.83201e-08,1.94008e-08,2.05354e-08, & 
      2.17258e-08,2.29742e-08,2.42830e-08,2.56545e-08,2.70910e-08, & 
      2.85950e-08,3.01689e-08,3.18155e-08,3.35373e-08,3.53372e-08, & 
      3.72177e-08,3.91818e-08,4.12325e-08,4.33727e-08,4.56056e-08, & 
      4.79342e-08,5.03617e-08,5.28915e-08,5.55270e-08,5.82715e-08, & 
      6.11286e-08,6.41019e-08,6.71951e-08,7.04119e-08,7.37560e-08/               
      data (totplnk(idata,13),idata=101,150)/ &                                             
      7.72315e-08,8.08424e-08,8.45927e-08,8.84866e-08,9.25281e-08, & 
      9.67218e-08,1.01072e-07,1.05583e-07,1.10260e-07,1.15107e-07, & 
      1.20128e-07,1.25330e-07,1.30716e-07,1.36291e-07,1.42061e-07, & 
      1.48031e-07,1.54206e-07,1.60592e-07,1.67192e-07,1.74015e-07, & 
      1.81064e-07,1.88345e-07,1.95865e-07,2.03628e-07,2.11643e-07, & 
      2.19912e-07,2.28443e-07,2.37244e-07,2.46318e-07,2.55673e-07, & 
      2.65316e-07,2.75252e-07,2.85489e-07,2.96033e-07,3.06891e-07, & 
      3.18070e-07,3.29576e-07,3.41417e-07,3.53600e-07,3.66133e-07, & 
      3.79021e-07,3.92274e-07,4.05897e-07,4.19899e-07,4.34288e-07, & 
      4.49071e-07,4.64255e-07,4.79850e-07,4.95863e-07,5.12300e-07/               
      data (totplnk(idata,13),idata=151,181)/ &                                             
      5.29172e-07,5.46486e-07,5.64250e-07,5.82473e-07,6.01164e-07, & 
      6.20329e-07,6.39979e-07,6.60122e-07,6.80767e-07,7.01922e-07, & 
      7.23596e-07,7.45800e-07,7.68539e-07,7.91826e-07,8.15669e-07, & 
      8.40076e-07,8.65058e-07,8.90623e-07,9.16783e-07,9.43544e-07, & 
      9.70917e-07,9.98912e-07,1.02754e-06,1.05681e-06,1.08673e-06, & 
      1.11731e-06,1.14856e-06,1.18050e-06,1.21312e-06,1.24645e-06, & 
      1.28049e-06/                                                               
      data (totplnk(idata,14),idata=1,50)/ &                                                
      1.40113e-11,1.59358e-11,1.80960e-11,2.05171e-11,2.32266e-11, & 
      2.62546e-11,2.96335e-11,3.33990e-11,3.75896e-11,4.22469e-11, & 
      4.74164e-11,5.31466e-11,5.94905e-11,6.65054e-11,7.42522e-11, & 
      8.27975e-11,9.22122e-11,1.02573e-10,1.13961e-10,1.26466e-10, & 
      1.40181e-10,1.55206e-10,1.71651e-10,1.89630e-10,2.09265e-10, & 
      2.30689e-10,2.54040e-10,2.79467e-10,3.07128e-10,3.37190e-10, & 
      3.69833e-10,4.05243e-10,4.43623e-10,4.85183e-10,5.30149e-10, & 
      5.78755e-10,6.31255e-10,6.87910e-10,7.49002e-10,8.14824e-10, & 
      8.85687e-10,9.61914e-10,1.04385e-09,1.13186e-09,1.22631e-09, & 
      1.32761e-09,1.43617e-09,1.55243e-09,1.67686e-09,1.80992e-09/               
      data (totplnk(idata,14),idata=51,100)/ &                                              
      1.95212e-09,2.10399e-09,2.26607e-09,2.43895e-09,2.62321e-09, & 
      2.81949e-09,3.02844e-09,3.25073e-09,3.48707e-09,3.73820e-09, & 
      4.00490e-09,4.28794e-09,4.58819e-09,4.90647e-09,5.24371e-09, & 
      5.60081e-09,5.97875e-09,6.37854e-09,6.80120e-09,7.24782e-09, & 
      7.71950e-09,8.21740e-09,8.74271e-09,9.29666e-09,9.88054e-09, & 
      1.04956e-08,1.11434e-08,1.18251e-08,1.25422e-08,1.32964e-08, & 
      1.40890e-08,1.49217e-08,1.57961e-08,1.67140e-08,1.76771e-08, & 
      1.86870e-08,1.97458e-08,2.08553e-08,2.20175e-08,2.32342e-08, & 
      2.45077e-08,2.58401e-08,2.72334e-08,2.86900e-08,3.02122e-08, & 
      3.18021e-08,3.34624e-08,3.51954e-08,3.70037e-08,3.88899e-08/               
      data (totplnk(idata,14),idata=101,150)/ &                                             
      4.08568e-08,4.29068e-08,4.50429e-08,4.72678e-08,4.95847e-08, & 
      5.19963e-08,5.45058e-08,5.71161e-08,5.98309e-08,6.26529e-08, & 
      6.55857e-08,6.86327e-08,7.17971e-08,7.50829e-08,7.84933e-08, & 
      8.20323e-08,8.57035e-08,8.95105e-08,9.34579e-08,9.75488e-08, & 
      1.01788e-07,1.06179e-07,1.10727e-07,1.15434e-07,1.20307e-07, & 
      1.25350e-07,1.30566e-07,1.35961e-07,1.41539e-07,1.47304e-07, & 
      1.53263e-07,1.59419e-07,1.65778e-07,1.72345e-07,1.79124e-07, & 
      1.86122e-07,1.93343e-07,2.00792e-07,2.08476e-07,2.16400e-07, & 
      2.24568e-07,2.32988e-07,2.41666e-07,2.50605e-07,2.59813e-07, & 
      2.69297e-07,2.79060e-07,2.89111e-07,2.99455e-07,3.10099e-07/               
      data (totplnk(idata,14),idata=151,181)/ &                                             
      3.21049e-07,3.32311e-07,3.43893e-07,3.55801e-07,3.68041e-07, & 
      3.80621e-07,3.93547e-07,4.06826e-07,4.20465e-07,4.34473e-07, & 
      4.48856e-07,4.63620e-07,4.78774e-07,4.94325e-07,5.10280e-07, & 
      5.26648e-07,5.43436e-07,5.60652e-07,5.78302e-07,5.96397e-07, & 
      6.14943e-07,6.33949e-07,6.53421e-07,6.73370e-07,6.93803e-07, & 
      7.14731e-07,7.36157e-07,7.58095e-07,7.80549e-07,8.03533e-07, & 
      8.27050e-07/                                                               
      data (totplnk(idata,15),idata=1,50)/ &                                                
      3.90483e-12,4.47999e-12,5.13122e-12,5.86739e-12,6.69829e-12, & 
      7.63467e-12,8.68833e-12,9.87221e-12,1.12005e-11,1.26885e-11, & 
      1.43534e-11,1.62134e-11,1.82888e-11,2.06012e-11,2.31745e-11, & 
      2.60343e-11,2.92087e-11,3.27277e-11,3.66242e-11,4.09334e-11, & 
      4.56935e-11,5.09455e-11,5.67338e-11,6.31057e-11,7.01127e-11, & 
      7.78096e-11,8.62554e-11,9.55130e-11,1.05651e-10,1.16740e-10, & 
      1.28858e-10,1.42089e-10,1.56519e-10,1.72243e-10,1.89361e-10, & 
      2.07978e-10,2.28209e-10,2.50173e-10,2.73999e-10,2.99820e-10, & 
      3.27782e-10,3.58034e-10,3.90739e-10,4.26067e-10,4.64196e-10, & 
      5.05317e-10,5.49631e-10,5.97347e-10,6.48689e-10,7.03891e-10/               
      data (totplnk(idata,15),idata=51,100)/ &                                              
      7.63201e-10,8.26876e-10,8.95192e-10,9.68430e-10,1.04690e-09, & 
      1.13091e-09,1.22079e-09,1.31689e-09,1.41957e-09,1.52922e-09, & 
      1.64623e-09,1.77101e-09,1.90401e-09,2.04567e-09,2.19647e-09, & 
      2.35690e-09,2.52749e-09,2.70875e-09,2.90127e-09,3.10560e-09, & 
      3.32238e-09,3.55222e-09,3.79578e-09,4.05375e-09,4.32682e-09, & 
      4.61574e-09,4.92128e-09,5.24420e-09,5.58536e-09,5.94558e-09, & 
      6.32575e-09,6.72678e-09,7.14964e-09,7.59526e-09,8.06470e-09, & 
      8.55897e-09,9.07916e-09,9.62638e-09,1.02018e-08,1.08066e-08, & 
      1.14420e-08,1.21092e-08,1.28097e-08,1.35446e-08,1.43155e-08, & 
      1.51237e-08,1.59708e-08,1.68581e-08,1.77873e-08,1.87599e-08/               
      data (totplnk(idata,15),idata=101,150)/ &                                             
      1.97777e-08,2.08423e-08,2.19555e-08,2.31190e-08,2.43348e-08, & 
      2.56045e-08,2.69302e-08,2.83140e-08,2.97578e-08,3.12636e-08, & 
      3.28337e-08,3.44702e-08,3.61755e-08,3.79516e-08,3.98012e-08, & 
      4.17265e-08,4.37300e-08,4.58143e-08,4.79819e-08,5.02355e-08, & 
      5.25777e-08,5.50114e-08,5.75393e-08,6.01644e-08,6.28896e-08, & 
      6.57177e-08,6.86521e-08,7.16959e-08,7.48520e-08,7.81239e-08, & 
      8.15148e-08,8.50282e-08,8.86675e-08,9.24362e-08,9.63380e-08, & 
      1.00376e-07,1.04555e-07,1.08878e-07,1.13349e-07,1.17972e-07, & 
      1.22751e-07,1.27690e-07,1.32793e-07,1.38064e-07,1.43508e-07, & 
      1.49129e-07,1.54931e-07,1.60920e-07,1.67099e-07,1.73473e-07/               
      data (totplnk(idata,15),idata=151,181)/ &                                             
      1.80046e-07,1.86825e-07,1.93812e-07,2.01014e-07,2.08436e-07, & 
      2.16082e-07,2.23957e-07,2.32067e-07,2.40418e-07,2.49013e-07, & 
      2.57860e-07,2.66963e-07,2.76328e-07,2.85961e-07,2.95868e-07, & 
      3.06053e-07,3.16524e-07,3.27286e-07,3.38345e-07,3.49707e-07, & 
      3.61379e-07,3.73367e-07,3.85676e-07,3.98315e-07,4.11287e-07, & 
      4.24602e-07,4.38265e-07,4.52283e-07,4.66662e-07,4.81410e-07, & 
      4.96535e-07/                                                               
      data (totplnk(idata,16),idata=1,50)/ &                                                
      4.65378e-13,5.41927e-13,6.29913e-13,7.30869e-13,8.46510e-13, & 
      9.78750e-13,1.12972e-12,1.30181e-12,1.49764e-12,1.72016e-12, & 
      1.97260e-12,2.25858e-12,2.58206e-12,2.94744e-12,3.35955e-12, & 
      3.82372e-12,4.34581e-12,4.93225e-12,5.59010e-12,6.32711e-12, & 
      7.15171e-12,8.07317e-12,9.10159e-12,1.02480e-11,1.15244e-11, & 
      1.29438e-11,1.45204e-11,1.62697e-11,1.82084e-11,2.03545e-11, & 
      2.27278e-11,2.53494e-11,2.82424e-11,3.14313e-11,3.49431e-11, & 
      3.88064e-11,4.30522e-11,4.77139e-11,5.28273e-11,5.84308e-11, & 
      6.45658e-11,7.12764e-11,7.86103e-11,8.66176e-11,9.53534e-11, & 
      1.04875e-10,1.15245e-10,1.26528e-10,1.38796e-10,1.52123e-10/               
      data (totplnk(idata,16),idata=51,100)/ &                                              
      1.66590e-10,1.82281e-10,1.99287e-10,2.17704e-10,2.37632e-10, & 
      2.59182e-10,2.82468e-10,3.07610e-10,3.34738e-10,3.63988e-10, & 
      3.95504e-10,4.29438e-10,4.65951e-10,5.05212e-10,5.47402e-10, & 
      5.92707e-10,6.41329e-10,6.93477e-10,7.49371e-10,8.09242e-10, & 
      8.73338e-10,9.41911e-10,1.01524e-09,1.09359e-09,1.17728e-09, & 
      1.26660e-09,1.36190e-09,1.46350e-09,1.57177e-09,1.68709e-09, & 
      1.80984e-09,1.94044e-09,2.07932e-09,2.22693e-09,2.38373e-09, & 
      2.55021e-09,2.72689e-09,2.91429e-09,3.11298e-09,3.32353e-09, & 
      3.54655e-09,3.78265e-09,4.03251e-09,4.29679e-09,4.57620e-09, & 
      4.87148e-09,5.18341e-09,5.51276e-09,5.86037e-09,6.22708e-09/               
      data (totplnk(idata,16),idata=101,150)/ &                                             
      6.61381e-09,7.02145e-09,7.45097e-09,7.90336e-09,8.37967e-09, & 
      8.88092e-09,9.40827e-09,9.96280e-09,1.05457e-08,1.11583e-08, & 
      1.18017e-08,1.24773e-08,1.31865e-08,1.39306e-08,1.47111e-08, & 
      1.55295e-08,1.63872e-08,1.72860e-08,1.82274e-08,1.92132e-08, & 
      2.02450e-08,2.13247e-08,2.24541e-08,2.36352e-08,2.48699e-08, & 
      2.61602e-08,2.75082e-08,2.89161e-08,3.03860e-08,3.19203e-08, & 
      3.35213e-08,3.51913e-08,3.69330e-08,3.87486e-08,4.06411e-08, & 
      4.26129e-08,4.46668e-08,4.68058e-08,4.90325e-08,5.13502e-08, & 
      5.37617e-08,5.62703e-08,5.88791e-08,6.15915e-08,6.44107e-08, & 
      6.73404e-08,7.03841e-08,7.35453e-08,7.68278e-08,8.02355e-08/               
      data (totplnk(idata,16),idata=151,181)/ &                                             
      8.37721e-08,8.74419e-08,9.12486e-08,9.51968e-08,9.92905e-08, & 
      1.03534e-07,1.07932e-07,1.12490e-07,1.17211e-07,1.22100e-07, & 
      1.27163e-07,1.32404e-07,1.37829e-07,1.43443e-07,1.49250e-07, & 
      1.55257e-07,1.61470e-07,1.67893e-07,1.74532e-07,1.81394e-07, & 
      1.88485e-07,1.95810e-07,2.03375e-07,2.11189e-07,2.19256e-07, & 
      2.27583e-07,2.36177e-07,2.45046e-07,2.54196e-07,2.63634e-07, & 
      2.73367e-07/                                                               
                                                                                 
      data (totplk16(idata),idata=1,50)/ &                                                  
      4.46128e-13,5.19008e-13,6.02681e-13,6.98580e-13,8.08302e-13, & 
      9.33629e-13,1.07654e-12,1.23925e-12,1.42419e-12,1.63407e-12, & 
      1.87190e-12,2.14099e-12,2.44498e-12,2.78793e-12,3.17424e-12, & 
      3.60881e-12,4.09698e-12,4.64461e-12,5.25813e-12,5.94456e-12, & 
      6.71156e-12,7.56752e-12,8.52154e-12,9.58357e-12,1.07644e-11, & 
      1.20758e-11,1.35304e-11,1.51420e-11,1.69256e-11,1.88973e-11, & 
      2.10746e-11,2.34762e-11,2.61227e-11,2.90356e-11,3.22388e-11, & 
      3.57574e-11,3.96187e-11,4.38519e-11,4.84883e-11,5.35616e-11, & 
      5.91075e-11,6.51647e-11,7.17743e-11,7.89797e-11,8.68284e-11, & 
      9.53697e-11,1.04658e-10,1.14748e-10,1.25701e-10,1.37582e-10/               
      data (totplk16(idata),idata=51,100)/ &                                                
      1.50457e-10,1.64400e-10,1.79487e-10,1.95799e-10,2.13422e-10, & 
      2.32446e-10,2.52970e-10,2.75094e-10,2.98925e-10,3.24578e-10, & 
      3.52172e-10,3.81833e-10,4.13695e-10,4.47897e-10,4.84588e-10, & 
      5.23922e-10,5.66063e-10,6.11182e-10,6.59459e-10,7.11081e-10, & 
      7.66251e-10,8.25172e-10,8.88065e-10,9.55155e-10,1.02668e-09, & 
      1.10290e-09,1.18406e-09,1.27044e-09,1.36233e-09,1.46002e-09, & 
      1.56382e-09,1.67406e-09,1.79108e-09,1.91522e-09,2.04686e-09, & 
      2.18637e-09,2.33416e-09,2.49063e-09,2.65622e-09,2.83136e-09, & 
      3.01653e-09,3.21221e-09,3.41890e-09,3.63712e-09,3.86740e-09, & 
      4.11030e-09,4.36641e-09,4.63631e-09,4.92064e-09,5.22003e-09/               
      data (totplk16(idata),idata=101,150)/ &                                               
      5.53516e-09,5.86670e-09,6.21538e-09,6.58191e-09,6.96708e-09, & 
      7.37165e-09,7.79645e-09,8.24229e-09,8.71007e-09,9.20066e-09, & 
      9.71498e-09,1.02540e-08,1.08186e-08,1.14100e-08,1.20290e-08, & 
      1.26767e-08,1.33544e-08,1.40630e-08,1.48038e-08,1.55780e-08, & 
      1.63867e-08,1.72313e-08,1.81130e-08,1.90332e-08,1.99932e-08, & 
      2.09945e-08,2.20385e-08,2.31267e-08,2.42605e-08,2.54416e-08, & 
      2.66716e-08,2.79520e-08,2.92846e-08,3.06711e-08,3.21133e-08, & 
      3.36128e-08,3.51717e-08,3.67918e-08,3.84749e-08,4.02232e-08, & 
      4.20386e-08,4.39231e-08,4.58790e-08,4.79083e-08,5.00132e-08, & 
      5.21961e-08,5.44592e-08,5.68049e-08,5.92356e-08,6.17537e-08/               
      data (totplk16(idata),idata=151,181)/ &                                               
      6.43617e-08,6.70622e-08,6.98578e-08,7.27511e-08,7.57449e-08, & 
      7.88419e-08,8.20449e-08,8.53568e-08,8.87805e-08,9.23190e-08, & 
      9.59753e-08,9.97526e-08,1.03654e-07,1.07682e-07,1.11841e-07, & 
      1.16134e-07,1.20564e-07,1.25135e-07,1.29850e-07,1.34712e-07, & 
      1.39726e-07,1.44894e-07,1.50221e-07,1.55711e-07,1.61367e-07, & 
      1.67193e-07,1.73193e-07,1.79371e-07,1.85732e-07,1.92279e-07, & 
      1.99016e-07/                                                               

                                                            
                

contains

!------------------------------------------------------------------
   subroutine rrtmlwrad(rthraten,glw,emiss,                       &
                        qv3d,qc3d,qr3d,                           &
                        qi3d,qs3d,qg3d,p8w,p3d,pi3d,              &
                        dz8w,t3d,t8w,rho3d,cldfra3d,r,g,          &
                        p_qv,p_qc,p_qr,p_qi,p_qs,p_qg,            &
                        p_first_scalar,                           &
                        icloud, warm_rain,                        &
                        ids,ide, jds,jde, kds,kde,                & 
                        ims,ime, jms,jme, kms,kme,                &
                        its,ite, jts,jte, kts,kte                 )
!------------------------------------------------------------------
   implicit none
!------------------------------------------------------------------
   integer, intent(in )      ::        p_qv,p_qc,p_qr,p_qi,p_qs,p_qg
   integer, intent(in )      ::        p_first_scalar
   logical, intent(in )      ::        warm_rain
!
   integer, intent(in )      ::        ids,ide, jds,jde, kds,kde, &
                                       ims,ime, jms,jme, kms,kme, &
                                       its,ite, jts,jte, kts,kte

   integer, intent(in )      ::        icloud
!
   real, dimension( ims:ime, kms:kme, jms:jme )                 , &
         intent(in   ) ::                                   dz8w, &
                                                             t3d, &
                                                             t8w, &
                                                             p8w, &
                                                             p3d, &
                                                            pi3d, &
                                                           rho3d, &
                                                        cldfra3d, &
                                                            qv3d, &
                                                            qc3d, &
                                                            qr3d, &
                                                            qi3d, &
                                                            qs3d, &
                                                            qg3d
!
   real, dimension( ims:ime, kms:kme, jms:jme )                 , &
         intent(inout)  ::                              rthraten
!
   real, dimension( ims:ime, jms:jme )                          , &
         intent(in   )  ::                                 emiss
!
   real, dimension( ims:ime, jms:jme )                          , &
         intent(inout)  ::                                   glw
!
   real, intent(in  )   ::                                   r,g

!  local vars
 
   real, dimension( kts:kte+1 ) ::                          pw1d, &
                                                            tw1d, &
                                                            phyd

   real, dimension( kts:kte ) ::                          tten1d, &
                                                        cldfra1d, &
                                                            dz1d, &
                                                             p1d, &
                                                         phydmid, &
                                                             t1d, &
                                                            qv1d, &
                                                            qc1d, &
                                                            qr1d, &
                                                            qi1d, &
                                                            qs1d, &
                                                            qg1d
!
    real   ::                                   tsfc,glw0,emiss0
!
    integer:: i,j,k,nk

!------------------------------------------------------------------

!-----calculate long wave radiation
!                                                              
   j_loop: do j=jts,jte
   i_loop: do i=its,ite

! reverse vars 
! p1d pw1d are in mb

! need hydrostatic pressure here (monotonic change with height)
! phyd replaces p8w, phydmid replaces p3d
         phyd(kts) = p8w(i,kts,j)
         do k = kts,kte
            phyd(k+1) = phyd(k) - g*rho3d(i,k,j)*dz8w(i,k,j)
            phydmid(k)= 0.5*(phyd(k)+phyd(k+1))
         enddo

         do k=kts,kte+1
            nk=kme-k+kms
!           pw1d(k) = p8w(i,nk,j)/100.
            pw1d(k) = phyd(nk)/100.
            tw1d(k) = t8w(i,nk,j)
         enddo

         do k=kts,kte
            qv1d(k)=0.
            qc1d(k)=0.
            qr1d(k)=0.
            qi1d(k)=0.
            qs1d(k)=0.
            cldfra1d(k)=0.
         enddo

         do k=kts,kte
            nk=kme-1-k+kms
            qv1d(k)=qv3d(i,nk,j)
            qv1d(k)=max(0.,qv1d(k))
         enddo

         do k=kts,kte
            nk=kme-1-k+kms
            tten1d(k)=0.
            t1d(k)=t3d(i,nk,j)
!           p1d(k)=p3d(i,nk,j)/100.
            p1d(k)=phydmid(nk)/100.
            dz1d(k)=dz8w(i,nk,j)
         enddo

         if (icloud .ne. 0) then
            do k=kts,kte
               nk=kme-1-k+kms
               cldfra1d(k)=cldfra3d(i,nk,j)
            enddo

            if (p_qc .ge. p_first_scalar ) then
            do k=kts,kte
               nk=kme-1-k+kms
               qc1d(k)=qc3d(i,nk,j)
               qc1d(k)=max(0.,qc1d(k))
            enddo
            endif

            if (p_qr .ge. p_first_scalar ) then
            do k=kts,kte
               nk=kme-1-k+kms
               qr1d(k)=qr3d(i,nk,j)
               qr1d(k)=max(0.,qr1d(k))
            enddo
            endif

            if (p_qi .lt. p_first_scalar .and. .not. warm_rain) then
            do k=kts,kte
               if (t1d(k) .lt. 273.15) then
               qi1d(k)=qc1d(k)
               qs1d(k)=qr1d(k)
               qc1d(k)=0.
               qr1d(k)=0.
               endif
            enddo
            endif

            if (p_qi .ge. p_first_scalar ) then
            do k=kts,kte
               nk=kme-1-k+kms
               qi1d(k)=qi3d(i,nk,j)
               qi1d(k)=max(0.,qi1d(k))
            enddo
            endif

            if (p_qs .ge. p_first_scalar ) then
            do k=kts,kte
               nk=kme-1-k+kms
               qs1d(k)=qs3d(i,nk,j)
               qs1d(k)=max(0.,qs1d(k))
            enddo
            endif

            if (p_qg .ge. p_first_scalar ) then
            do k=kts,kte
               nk=kme-1-k+kms
               qg1d(k)=qg3d(i,nk,j)
               qg1d(k)=max(0.,qg1d(k))
            enddo
            endif
         endif

         emiss0=emiss(i,j)
         glw0=0. 
         tsfc=tw1d(kme)

         call rrtm(tten1d,glw0,tsfc,cldfra1d,t1d,tw1d,qv1d,qc1d,   &
                   qr1d,qi1d,qs1d,qg1d,p1d,pw1d,dz1d,              &
                   emiss0,r,g,                                     &
                   kts,kte                                         )
 
         glw(i,j)=glw0

         do k=kts,kte
            nk=kme-1-k+kms
            rthraten(i,k,j)=rthraten(i,k,j)+tten1d(nk)/pi3d(i,k,j)
         enddo

      end do i_loop
   end do j_loop                                           

!-------------------------------------------------------------------

   end subroutine rrtmlwrad


!****************************************************************************    
!*                                                                          *    
!*                               rrtm                                       *    
!*                                                                          *    
!*                                                                          *    
!*                                                                          *    
!*                   rapid radiative transfer model                         *    
!*                                                                          *    
!*                                                                          *    
!*            atmospheric and environmental research, inc.                  *    
!*                        840 memorial drive                                *    
!*                        cambridge, ma 02139                               *    
!*                                                                          *    
!*                                                                          *    
!*                           eli j. mlawer                                  *    
!*                         steven j. taubman~                               *    
!*                         shepard a. clough                                *    
!*                                                                          *    
!*                                                                          *    
!*                         ~currently at gfdl                               *    
!*                                                                          *    
!*                                                                          *    
!*                                                                          *    
!*                       email:  mlawer@aer.com                             *    
!*                                                                          *    
!*        the authors wish to acknowledge the contributions of the          *    
!*        following people:  patrick d. brown, michael j. iacono,           *    
!*        ronald e. farren, luke chen, robert bergstrom.                    *    
!*                                                                          *    
!****************************************************************************    
                                                                                 
! *** this version of rrtm has been altered to interface with the                
! *** ncar mm5 mesoscale model for the calculation of longwave radiative         
! *** transfer (based on a code for interface with ccm model by m. j. iacono)    
! *** j. dudhia ; march, 1999                                                    
!---------------------------------------------------------------------
   subroutine rrtm(tten,glw,tsfc,cldfra,t,tw,qv,qc,                  &
                   qr,qi,qs,qg,p,pw,dz,                              &
                   emiss,r,g,                                        &
                   kts,kte                                           )
!---------------------------------------------------------------------
! *** this program is the driver for rrtm, the aer lw radiation model.           
!     this routine:                                                              
!     calls mm5atm to provide atmosphere in column and boundary values           
!     a) calls gasabs to calculate gaseous optical depths                        
!     b) calls setcoef to calculate various quantities needed for                
!        the radiative transfer algorithm                                        
!     c) calls rtrn (for both clear and cloudy columns) to do the                
!        radiative transfer calculation                                          
!     d) passes the necessary flux and cooling rate back to mm5                  
!---------------------------------------------------------------------
      implicit none
!---------------------------------------------------------------------

      integer, intent(in ) ::      kts, kte
!
      real, dimension( kts:kte+1 ), intent(in   ) ::             pw, &
                                                                 tw

      real, dimension( kts:kte ), intent(in   ) ::           cldfra, &
                                                                  t, &
                                                                  p, &
                                                                 dz
!
      real, dimension( kts:kte ), intent(inout) ::                   &
                                                                 qv
      real, dimension( kts:kte ), intent(in   ) ::                   &
                                                                 qc, &
                                                                 qr, &
                                                                 qi, &
                                                                 qs, &
                                                                 qg
!
      real, dimension( kts:kte ), intent(inout)::              tten
!   
      real, intent(in  )   ::                           r, g, emiss
!
      real, intent(inout)  ::                              tsfc,glw

! local var

      integer, dimension( ngpt,kts:kte+1 ) ::                   itr

      real,    dimension( ngpt,kts:kte+1 ) ::                  pfrac, &
                                                               taug

      real,    dimension( 35,kts:kte+1 )       ::               wkl

      real,    dimension( maxxsec,kts:kte+1 )  ::                wx

      real, dimension( kts:kte )  ::                         o3prof

      real, dimension( kts:kte+1 )  ::                        pavel, &
                                                              tavel, &
                                                            cldfrac, &
                                                           taucloud, &   
                                                             coldry, & 
                                                             colh2o, &
                                                             colco2, &
                                                              colo3, &
                                                             coln2o, &
                                                             colch4, &
                                                              colo2, &
                                                            co2mult, &
                                                              fac00, &
                                                              fac01, &
                                                              fac10, &
                                                              fac11, &
                                                             forfac, &
                                                            selffac, &
                                                           selffrac
                                                
!                       
      integer, dimension( kts:kte+1 ) ::                    icldlyr, &
                                                                 jp, &
                                                                 jt, &
                                                                jt1, &
                                                            indself

      real, dimension(   0:kte+1 )  ::                           pz, &
                                                                 tz, &
                                                           totdflux, &
                                                                htr
!     
      integer ::  i,k,ktep1
      integer ::  laytrop,layswtch,laylow
      real    ::  tbound
      real, dimension(nbands) ::  semiss


!---------------------------------------------------------------------------
! rrtm definitions                                                               
!    ngpt                         ! total number of g-point subintervals         
!    mxlay                        ! maximum number of model layers               
!    nbands                       ! number of longwave spectral bands            
!    pi                           ! geometric constant                           
!    fluxfac                      ! radiance to flux conversion factor           
!    heatfac                      ! heating rate conversion factor               
!    ng(nbands)                   ! number of g-points per band for input        
!                                   absorption coefficient data                  
!    nspa(nbands),nspb(nbands)    ! number of reference atmospheres per band     
!    wavenum1(nbands)             ! longwave band lower limit (wavenumbers)      
!    wavenum2(nbands)             ! longwave band upper limit (wavenumbers)      
!    delwave                      ! longwave band width (wavenumbers)            
!    nlayers                      ! number of model layers (mkx+1)               
!    pavel(mxlay)                 ! layer pressures (mb)                         
!    pz(0:mxlay)                  ! level (interface) pressures (mb)             
!    tavel(mxlay)                 ! layer temperatures (k)                       
!    tz(0:mxlay)                  ! level (interface) temperatures(mb)           
!    tbound                       ! surface temperature (k)                      
!    cldfrac(mxlay)               ! layer cloud fraction                         
!    taucloud(mxlay)              ! layer cloud optical depth                    
!    itr(ngpt,mxlay)              ! integer look-up table index                  
!    pfrac(ngpt,mxlay)            ! planck fractions                             
!    icldlyr(mxlay)               ! flag for cloudy layers                       
!    totuflux(0:mxlay)            ! upward longwave flux (w/m2)                  
!    totdflux(0:mxlay)            ! downward longwave flux (w/m2)                
!    fnet(0:mxlay)                ! net longwave flux (w/m2)                     
!    htr(0:mxlay)                 ! longwave heating rate (k/day)                
!    clrnttoa                     ! clear-sky toa outgoing flux (w/m2)           
!    clrntsrf                     ! clear-sky net surface flux (w/m2)            
!    totuclfl(0:mxlay)            ! clear-sky upward longwave flux (w/m2)        
!    totdclfl(0:mxlay)            ! clear-sky downward longwave flux (w/m2)      
!    fnetc(0:mxlay)               ! clear-sky net longwave flux (w/m2)           
!    htrc(0:mxlay)                ! clear-sky longwave heating rate (k/day)      
!                                                                                
! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
!---------------------------------------------------------------------------

     ktep1=kte+1
!
!    cloud emissivities (m^2/g)                                                  
!    these are consistent with lwrad (abcw=0.5*(abup+abdown))                    
!     
!     oneminus = 1. - 1.e-6                                                      
!     pi   = 2.*asin(1.)                                                           
!     fluxfac = pi   * 2.d4                     
!
      call inirad (o3prof,pw,kts,kte)
                                                                              
!  prepare atmospheric profile from ccm for use in rrtm, and define              
!  other rrtm input parameters.  arrays are passed back through the              
!  existing rrtm commons and arrays.                                             
         
         call mm5atm(cldfra,o3prof,t,tw,tsfc,qv,qc,qr,qi,qs,qg,    &
                     p,pw,dz,emiss,r,g,                            &
                     pavel,tavel,pz,tz,cldfrac,taucloud,coldry,    &
                     wkl,wx,tbound,semiss,                         &
                     kts,kte                                       )

!  calculate information needed by the radiative transfer routine                
!  that is specific to this atmosphere, especially some of the                   
!  coefficients and indices needed to compute the optical depths                 
!  by interpolating data from stored reference atmospheres.                      
                                                                                 
         call setcoef(kts,ktep1,                                   &
                      pavel,tavel,coldry,colh2o,colco2,colo3,      &
                      coln2o,colch4,colo2,co2mult,                 &
                      fac00,fac01,fac10,fac11,                     &
                      forfac,selffac,selffrac,                     &
                      jp,jt,jt1,indself,wkl,laytrop,layswtch,laylow)

         call gasabs(kts,ktep1,                                 &
                     coldry,colh2o,colco2,colo3,coln2o,colch4,  &
                     colo2,co2mult,                             &
                     fac00,fac01,fac10,fac11,                   &
                     forfac,selffac,selffrac,                   &
                     jp,jt,jt1,indself,itr,wx,pfrac,taug,       &
                     laytrop,layswtch,laylow                    )

!  check for cloud in column.  use original ccm lw threshold: if total           
!  clear sky fraction < 0.999, then column is cloudy, otherwise consider         
!  it clear.  also, set up flag array, icldlyr, for use in radiative             
!  transfer.  set icldlyr to one for each layer with cloud.  if tclrsf           
!  is not available, icldlyr can be set from cldfrac alone.                      
                                                                                 
        do 1500 k = 1, nlayers                                                   
           if (cldfrac(k).gt.0.) then                                            
              icldlyr(k) = 1                                                     
           else                                                                  
              icldlyr(k) = 0                                                     
           endif                                                                 
 1500   continue                                                                 
                                                                                 
!  call the radiative transfer routine.                                          
                                                                                 
           call rtrn(kts,ktep1,                                  &
                     tavel, pz, tz, cldfrac, taucloud, totdflux, &
                     htr, icldlyr, itr, pfrac, tbound,semiss     )
                                                                                 
!  pass total sky up and down flux profiles to ccm output arrays and             
!  convert from mks to cgs units for ccm.  pass clear sky toa and surface        
!  net fluxes to ccm fields for diagnostics.  pass total sky heating rate        
!  profile to ccm output arrays and convert units to k/sec.  the vertical        
!  array index (bottom to top in rrtm) is reversed for ccm fields.               
                                                                                 
!          flntc(iiplon) = clrnttoa*1.e3                                         
!          flnsc(iiplon) = clrntsrf*1.e3                                         
!           do 2400 k = 0, nlayers-1                                             
!              fulc(k+1) = totuclfl(nlayers-1-k)*1.e3                            
!              fdlc(k+1) = totdclfl(nlayers-1-k)*1.e3                            
!              ful(k+1) = totuflux(nlayers-1-k)*1.e3                             
!              fdl(k+1) = totdflux(nlayers-1-k)*1.e3                             
! 2400      continue                                                             
           do 2450 k = 1, nlayers-1                                              
!              qrlc(k) = htrc(nlayers-1-k)/86400.                                
!              qrl(k) = htr(nlayers-1-k)/86400.                                  
              tten(k)=htr(nlayers-1-k)/86400. 
 2450      continue                                                              
           glw = totdflux(0)

   end subroutine rrtm


!***************************************************************************     
   subroutine cmbgb1(abscoefl, abscoefh, selfref,                       &
                     fracrefa, fracrefb, forref,                        &
                     selfrefc, forrefc, fracrefac, fracrefbc            )
!***************************************************************************     
!                                                                                
!  original version:       michael j. iacono; july, 1998                         
!  revision for ncar ccm:  michael j. iacono; september, 1998                    
!                                                                                
!  the subroutines cmbgb1->cmbgb16 input the absorption coefficient              
!  data for each band, which are defined for 16 g-points and 16 spectral         
!  bands. the data are combined with appropriate weighting following the         
!  g-point mapping arrays specified in rrtminit.  plank fraction data            
!  in arrays fracrefa and fracrefb are combined without weighting.  all          
!  g-point reduced data are put into new arrays for use in rrtm.                 
!                                                                                
!  band 1:  10-250 cm-1 (low - h2o; high - h2o)                                  
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(5,13,mg),abscoefh(5,13:59,mg)
      real selfref(10,mg)              
      real fracrefa(mg), fracrefb(mg), forref(mg)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng1), forrefc(ng1)
      real fracrefac(ng1), fracrefbc(ng1)
                                                                                 
      do 2000 jtjt = 1,5                                                           
         do 2200 jpjp = 1,13                                                       
            iprsm = 0                                                            
            do 2400 igc = 1,ngc(1)                                               
               sumk = 0.                                                         
               do 2600 ipr = 1, ngn(igc)                                         
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefl(jtjt,jpjp,iprsm)*rwgt(iprsm)               
 2600          continue                                                          
               absa1(jtjt+(jpjp-1)*5,igc) = sumk
 2400       continue                                                             
 2200    continue                                                                
         do 3200 jpjp = 13,59                                                      
            iprsm = 0                                                            
            do 3400 igc = 1,ngc(1)                                               
               sumk = 0.                                                         
               do 3600 ipr = 1, ngn(igc)                                         
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefh(jtjt,jpjp,iprsm)*rwgt(iprsm)
 3600          continue                                                          
               absb1(jtjt+(jpjp-13)*5,igc) = sumk                                             
 3400       continue                                                             
 3200    continue                                                                
 2000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(1)                                                  
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(igc)                                            
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 5400 igc = 1,ngc(1)                                                     
         sumk = 0.                                                               
         sumf1 = 0.                                                              
         sumf2 = 0.                                                              
         do 5600 ipr = 1, ngn(igc)                                               
            iprsm = iprsm + 1                                                    
            sumk = sumk + forref(iprsm)*rwgt(iprsm)                              
            sumf1= sumf1+ fracrefa(iprsm)                                        
            sumf2= sumf2+ fracrefb(iprsm)                                        
 5600    continue                                                                
         forrefc(igc) = sumk                                                     
         fracrefac(igc) = sumf1                                                  
         fracrefbc(igc) = sumf2                                                  
 5400 continue                                                                   
                                                                                 
   end subroutine cmbgb1

!***************************************************************************
  subroutine cmbgb2(abscoefl, abscoefh, selfref,                       &
                    fracrefa, fracrefb, forref,                        &
                    selfrefc, forrefc, fracrefac, fracrefbc            )
!***************************************************************************     
!                                                                                
!     band 2:  250-500 cm-1 (low - h2o; high - h2o)                              
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(5,13,mg),abscoefh(5,13:59,mg)
      real selfref(10,mg)            
      real fracrefa(mg,13), fracrefb(mg), forref(mg)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng2), forrefc(ng2)
      real fracrefac(ng2,13), fracrefbc(ng2)
                                                                                 
      do 2000 jtjt = 1,5                                                           
         do 2200 jpjp = 1,13                                                       
            iprsm = 0                                                            
            do 2400 igc = 1,ngc(2)                                               
               sumk = 0.                                                         
               do 2600 ipr = 1, ngn(ngs(1)+igc)                                  
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefl(jtjt,jpjp,iprsm)*rwgt(iprsm+16)
 2600          continue                                                          
               absa2(jtjt+(jpjp-1)*5,igc) = sumk  
 2400       continue                                                             
 2200    continue                                                                
         do 3200 jpjp = 13,59                                                      
            iprsm = 0                                                            
            do 3400 igc = 1,ngc(2)                                               
               sumk = 0.                                                         
               do 3600 ipr = 1, ngn(ngs(1)+igc)                                  
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefh(jtjt,jpjp,iprsm)*rwgt(iprsm+16)
 3600          continue                                                          
               absb2(jtjt+(jpjp-13)*5,igc) = sumk
 3400       continue                                                             
 3200    continue                                                                
 2000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(2)                                                  
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(1)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+16)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      do 5000 jpjp = 1,13                                                          
         iprsm = 0                                                               
         do 5400 igc = 1,ngc(2)                                                  
            sumf = 0.                                                            
            do 5600 ipr = 1, ngn(ngs(1)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefa(iprsm,jpjp)                                  
 5600       continue                                                             
            fracrefac(igc,jpjp) = sumf                                             
 5400    continue                                                                
 5000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 6400 igc = 1,ngc(2)                                                     
         sumk = 0.                                                               
         sumf = 0.                                                               
         do 6600 ipr = 1, ngn(ngs(1)+igc)                                        
            iprsm = iprsm + 1                                                    
            sumk = sumk + forref(iprsm)*rwgt(iprsm+16)                           
            sumf = sumf + fracrefb(iprsm)                                        
 6600    continue                                                                
         forrefc(igc) = sumk                                                     
         fracrefbc(igc) = sumf                                                   
 6400 continue                                                                   
                                                                                 
   end subroutine cmbgb2

!***************************************************************************
   subroutine cmbgb3(abscoefl, abscoefh, selfref,                       &
                     fracrefa, fracrefb, forref, absn2oa, absn2ob,      &
                     selfrefc, forrefc,                                 &
                     absn2oac, absn2obc, fracrefac, fracrefbc           )
!***************************************************************************     
!                                                                                
!     band 3:  500-630 cm-1 (low - h2o,co2; high - h2o,co2)                      
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(10,5,13,mg),abscoefh(5,5,13:59,mg)
      real selfref(10,mg)   
      real fracrefa(mg,10), fracrefb(mg,5)
      real forref(mg), absn2oa(mg), absn2ob(mg)     
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng3), forrefc(ng3),  &
           absn2oac(ng3), absn2obc(ng3) 
      real fracrefac(ng3,10), fracrefbc(ng3,5) 
                                                                                 
      do 2000 jn = 1,10                                                          
         do 2000 jtjt = 1,5                                                        
            do 2200 jpjp = 1,13                                                    
               iprsm = 0                                                         
               do 2400 igc = 1,ngc(3)                                            
                 sumk = 0.                                                       
                  do 2600 ipr = 1, ngn(ngs(2)+igc)                               
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefl(jn,jtjt,jpjp,iprsm)* rwgt(iprsm+32)
 2600             continue                                                       
                  absa3(jn+(jtjt-1)*10+(jpjp-1)*50,igc) = sumk  
 2400          continue                                                          
 2200       continue                                                             
 2000 continue                                                                   
      do 3000 jn = 1,5                                                           
         do 3000 jtjt = 1,5                                                        
            do 3200 jpjp = 13,59                                                   
               iprsm = 0                                                         
               do 3400 igc = 1,ngc(3)                                            
                  sumk = 0.                                                      
                  do 3600 ipr = 1, ngn(ngs(2)+igc)                               
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefh(jn,jtjt,jpjp,iprsm)* rwgt(iprsm+32)
 3600             continue                                                       
                  absb3(jn+(jtjt-1)*5+(jpjp-13)*25,igc) = sumk
 3400          continue                                                          
 3200       continue                                                             
 3000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(3)                                                  
            sumk = 0.                                                            
            sumf = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(2)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)* rwgt(iprsm+32)
               sumf = sumf + fracrefa(iprsm,jtjt)                                  
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
            fracrefac(igc,jtjt) = sumf                                             
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      do 5000 jpjp = 1,5                                                           
         iprsm = 0                                                               
         do 5400 igc = 1,ngc(3)                                                  
            sumf = 0.                                                            
            do 5600 ipr = 1, ngn(ngs(2)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefb(iprsm,jpjp)                                  
 5600       continue                                                             
            fracrefbc(igc,jpjp) = sumf                                             
 5400    continue                                                                
 5000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 6400 igc = 1,ngc(3)                                                     
         sumk1= 0.                                                               
         sumk2= 0.                                                               
         sumk3= 0.                                                               
         do 6600 ipr = 1, ngn(ngs(2)+igc)                                        
            iprsm = iprsm + 1                                                    
            sumk1= sumk1+ forref(iprsm)*rwgt(iprsm+32)                           
            sumk2= sumk2+ absn2oa(iprsm)*rwgt(iprsm+32)                          
            sumk3= sumk3+ absn2ob(iprsm)*rwgt(iprsm+32)                          
 6600    continue                                                                
         forrefc(igc) = sumk1                                                    
         absn2oac(igc) = sumk2                                                   
         absn2obc(igc) = sumk3                                                   
 6400 continue                                                                   
                                                                                 
   end subroutine cmbgb3

!***************************************************************************
   subroutine cmbgb4(abscoefl, abscoefh, selfref,                       &
                     fracrefa, fracrefb,                                &
                     selfrefc, fracrefac, fracrefbc                     )
!***************************************************************************     
!                                                                                
!     band 4:  630-700 cm-1 (low - h2o,co2; high - o3,co2)                       
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(9,5,13,mg),abscoefh(6,5,13:59,mg)
      real selfref(10,mg)            
      real fracrefa(mg,9), fracrefb(mg,6)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng4)
      real fracrefac(ng4,9), fracrefbc(ng4,6)
                                                                                 
      do 2000 jn = 1,9                                                           
         do 2000 jtjt = 1,5                                                        
            do 2200 jpjp = 1,13                                                    
               iprsm = 0                                                         
               do 2400 igc = 1,ngc(4)                                            
                 sumk = 0.                                                       
                  do 2600 ipr = 1, ngn(ngs(3)+igc)                               
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefl(jn,jtjt,jpjp,iprsm)*rwgt(iprsm+48)
 2600             continue                                                       
                  absa4(jn+(jtjt-1)*9+(jpjp-1)*45,igc) = sumk                                       
 2400          continue                                                          
 2200       continue                                                             
 2000 continue                                                                   
      do 3000 jn = 1,6                                                           
         do 3000 jtjt = 1,5                                                        
            do 3200 jpjp = 13,59                                                   
               iprsm = 0                                                         
               do 3400 igc = 1,ngc(4)                                            
                  sumk = 0.                                                      
                  do 3600 ipr = 1, ngn(ngs(3)+igc)                               
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefh(jn,jtjt,jpjp,iprsm)*rwgt(iprsm+48)
 3600             continue                                                       
                  absb4(jn+(jtjt-1)*6+(jpjp-13)*30,igc) = sumk
 3400          continue                                                          
 3200       continue                                                             
 3000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(4)                                                  
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(3)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+48)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      do 5000 jpjp = 1,9                                                           
         iprsm = 0                                                               
         do 5400 igc = 1,ngc(4)                                                  
            sumf = 0.                                                            
            do 5600 ipr = 1, ngn(ngs(3)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefa(iprsm,jpjp)                                  
 5600       continue                                                             
            fracrefac(igc,jpjp) = sumf                                             
 5400    continue                                                                
 5000 continue                                                                   
                                                                                 
      do 6000 jpjp = 1,6                                                           
         iprsm = 0                                                               
         do 6400 igc = 1,ngc(4)                                                  
            sumf = 0.                                                            
            do 6600 ipr = 1, ngn(ngs(3)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefb(iprsm,jpjp)                                  
 6600       continue                                                             
            fracrefbc(igc,jpjp) = sumf                                             
 6400    continue                                                                
 6000 continue                                                                   
                                                                                 
   end subroutine cmbgb4

!***************************************************************************
   subroutine cmbgb5(abscoefl, abscoefh, selfref,                      &
                     fracrefa, fracrefb, ccl4,                         &
                     selfrefc, ccl4c, fracrefac, fracrefbc             )
!***************************************************************************     
!                                                                                
!     band 5:  700-820 cm-1 (low - h2o,co2; high - o3,co2)                       
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(9,5,13,mg),abscoefh(5,5,13:59,mg)
      real selfref(10,mg)            
      real fracrefa(mg,9), fracrefb(mg,5), ccl4(mg)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng5), ccl4c(ng5) 
      real fracrefac(ng5,9), fracrefbc(ng5,5)               
                                                         
      do 2000 jn = 1,9                                                           
         do 2000 jtjt = 1,5                                                        
            do 2200 jpjp = 1,13                                                    
               iprsm = 0                                                         
               do 2400 igc = 1,ngc(5)                                            
                 sumk = 0.                                                       
                  do 2600 ipr = 1, ngn(ngs(4)+igc)                               
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefl(jn,jtjt,jpjp,iprsm)*rwgt(iprsm+64)
 2600             continue                                                       
                  absa5(jn+(jtjt-1)*9+(jpjp-1)*45,igc) = sumk                                       
 2400          continue                                                          
 2200       continue                                                             
 2000 continue                                                                   
      do 3000 jn = 1,5                                                           
         do 3000 jtjt = 1,5                                                        
            do 3200 jpjp = 13,59                                                   
               iprsm = 0                                                         
               do 3400 igc = 1,ngc(5)                                            
                  sumk = 0.                                                      
                  do 3600 ipr = 1, ngn(ngs(4)+igc)                               
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefh(jn,jtjt,jpjp,iprsm)*rwgt(iprsm+64)
 3600             continue                                                       
                  absb5(jn+(jtjt-1)*5+(jpjp-13)*25,igc) = sumk
 3400          continue                                                          
 3200       continue                                                             
 3000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(5)                                                  
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(4)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+64)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      do 5000 jpjp = 1,9                                                           
         iprsm = 0                                                               
         do 5400 igc = 1,ngc(5)                                                  
            sumf = 0.                                                            
            do 5600 ipr = 1, ngn(ngs(4)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefa(iprsm,jpjp)                                  
 5600       continue                                                             
            fracrefac(igc,jpjp) = sumf                                             
 5400    continue                                                                
 5000 continue                                                                   
                                                                                 
      do 6000 jpjp = 1,5                                                           
         iprsm = 0                                                               
         do 6400 igc = 1,ngc(5)                                                  
            sumf = 0.                                                            
            do 6600 ipr = 1, ngn(ngs(4)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefb(iprsm,jpjp)                                  
 6600       continue                                                             
            fracrefbc(igc,jpjp) = sumf                                             
 6400    continue                                                                
 6000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 7400 igc = 1,ngc(5)                                                     
         sumk = 0.                                                               
         do 7600 ipr = 1, ngn(ngs(4)+igc)                                        
            iprsm = iprsm + 1                                                    
            sumk = sumk + ccl4(iprsm)*rwgt(iprsm+64)                             
 7600    continue                                                                
         ccl4c(igc) = sumk                                                       
 7400 continue                                                                   
                                                                                 
   end subroutine cmbgb5

!***************************************************************************
   subroutine cmbgb6(abscoefl, selfref,                                &
                     fracrefa, absco2, cfc11adj, cfc12,                &
                     selfrefc, absco2c, cfc11adjc, cfc12c,             &
                     fracrefac                                         )
!***************************************************************************     
!                                                                                
!     band 6:  820-980 cm-1 (low - h2o; high - nothing)                          
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(5,13,mg)                                                           
      real selfref(10,mg)  
      real fracrefa(mg), absco2(mg), cfc11adj(mg), cfc12(mg)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng6),  &
           absco2c(ng6), cfc11adjc(ng6), cfc12c(ng6) 
      real fracrefac(ng6)
                                                                                 
      do 2000 jtjt = 1,5                                                           
         do 2200 jpjp = 1,13                                                       
            iprsm = 0                                                            
            do 2400 igc = 1,ngc(6)                                               
               sumk = 0.                                                         
               do 2600 ipr = 1, ngn(ngs(5)+igc)                                  
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefl(jtjt,jpjp,iprsm)*rwgt(iprsm+80)
 2600          continue                                                          
               absa6(jtjt+(jpjp-1)*5,igc) = sumk                                             
 2400       continue                                                             
 2200    continue                                                                
 2000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(6)                                                  
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(5)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+80) 
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 7400 igc = 1,ngc(6)                                                     
         sumf = 0.                                                               
         sumk1= 0.                                                               
         sumk2= 0.                                                               
         sumk3= 0.                                                               
         do 7600 ipr = 1, ngn(ngs(5)+igc)                                        
            iprsm = iprsm + 1                                                    
            sumf = sumf + fracrefa(iprsm)                                        
            sumk1= sumk1+ absco2(iprsm)*rwgt(iprsm+80)                           
            sumk2= sumk2+ cfc11adj(iprsm)*rwgt(iprsm+80)                         
            sumk3= sumk3+ cfc12(iprsm)*rwgt(iprsm+80)                            
 7600    continue                                                                
         fracrefac(igc) = sumf                                                   
         absco2c(igc) = sumk1                                                    
         cfc11adjc(igc) = sumk2                                                  
         cfc12c(igc) = sumk3                                                     
 7400 continue                                                                   
                                                                                 
   end subroutine cmbgb6

!***************************************************************************
   subroutine cmbgb7(abscoefl, abscoefh, selfref,                      &
                     fracrefa, fracrefb, absco2,                       &
                     selfrefc, absco2c, fracrefac, fracrefbc           )
!***************************************************************************     
!                                                                                
!     band 7:  980-1080 cm-1 (low - h2o,o3; high - o3)                           
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(9,5,13,mg),abscoefh(5,13:59,mg)
      real selfref(10,mg)          
      real fracrefa(mg,9), fracrefb(mg), absco2(mg)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng7), absco2c(ng7)
      real fracrefac(ng7,9), fracrefbc(ng7)  
                                                                                 
      do 2000 jn = 1,9                                                           
         do 2000 jtjt = 1,5                                                        
            do 2200 jpjp = 1,13                                                    
               iprsm = 0                                                         
               do 2400 igc = 1,ngc(7)                                            
                 sumk = 0.                                                       
                  do 2600 ipr = 1, ngn(ngs(6)+igc)                               
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefl(jn,jtjt,jpjp,iprsm)*rwgt(iprsm+96)
 2600             continue                                                       
                  absa7(jn+(jtjt-1)*9+(jpjp-1)*45,igc) = sumk                                       
 2400          continue                                                          
 2200       continue                                                             
 2000 continue                                                                   
      do 3000 jtjt = 1,5                                                           
         do 3200 jpjp = 13,59                                                      
            iprsm = 0                                                            
            do 3400 igc = 1,ngc(7)                                               
               sumk = 0.                                                         
               do 3600 ipr = 1, ngn(ngs(6)+igc)                                  
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefh(jtjt,jpjp,iprsm)*rwgt(iprsm+96)
 3600          continue                                                          
               absb7(jtjt+(jpjp-13)*5,igc) = sumk 
 3400       continue                                                             
 3200    continue                                                                
 3000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(7)                                                  
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(6)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+96)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      do 5000 jpjp = 1,9                                                           
         iprsm = 0                                                               
         do 5400 igc = 1,ngc(7)                                                  
            sumf = 0.                                                            
            do 5600 ipr = 1, ngn(ngs(6)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefa(iprsm,jpjp)                                  
 5600       continue                                                             
            fracrefac(igc,jpjp) = sumf                                             
 5400    continue                                                                
 5000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 7400 igc = 1,ngc(7)                                                     
         sumf = 0.                                                               
         sumk = 0.                                                               
         do 7600 ipr = 1, ngn(ngs(6)+igc)                                        
            iprsm = iprsm + 1                                                    
            sumf = sumf + fracrefb(iprsm)                                        
            sumk = sumk + absco2(iprsm)*rwgt(iprsm+96)                           
 7600    continue                                                                
         fracrefbc(igc) = sumf                                                   
         absco2c(igc) = sumk                                                     
 7400 continue                                                                   
                                                                                 
   end subroutine cmbgb7

!***************************************************************************
   subroutine cmbgb8(abscoefl, abscoefh, selfref,                     &
                     fracrefa, fracrefb, absco2a, absco2b,            &
                     absn2oa,  absn2ob,  cfc12,   cfc22adj,           &
                     selfrefc, absco2ac, absco2bc,                    &
                     absn2oac, absn2obc, cfc12c, cfc22adjc,           &
                     fracrefac, fracrefbc                             )
!***************************************************************************     
!                                                                                
!     band 8:  1080-1180 cm-1 (low (i.e.>~300mb) - h2o; high - o3)               
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(5,7,mg),abscoefh(5,7:59,mg), selfref(10,mg)
      real fracrefa(mg), fracrefb(mg), absco2a(mg), absco2b(mg)
      real absn2oa(mg), absn2ob(mg), cfc12(mg), cfc22adj(mg) 
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng8),               &
           absco2ac(ng8), absco2bc(ng8),   &
           absn2oac(ng8), absn2obc(ng8),   &
           cfc12c(ng8), cfc22adjc(ng8)
      real fracrefac(ng8), fracrefbc(ng8)
                                                                                 
      do 2000 jtjt = 1,5                                                           
         do 2200 jpjp = 1,7                                                        
            iprsm = 0                                                            
            do 2400 igc = 1,ngc(8)                                               
              sumk = 0.                                                          
               do 2600 ipr = 1, ngn(ngs(7)+igc)                                  
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefl(jtjt,jpjp,iprsm)*rwgt(iprsm+112)
 2600          continue                                                          
               absa8(jtjt+(jpjp-1)*5,igc) = sumk                                             
 2400       continue                                                             
 2200    continue                                                                
 2000 continue                                                                   
      do 3000 jtjt = 1,5                                                           
         do 3200 jpjp = 7,59                                                       
            iprsm = 0                                                            
            do 3400 igc = 1,ngc(8)                                               
               sumk = 0.                                                         
               do 3600 ipr = 1, ngn(ngs(7)+igc)                                  
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefh(jtjt,jpjp,iprsm)*rwgt(iprsm+112)
 3600          continue                                                          
               absb8(jtjt+(jpjp-7)*5,igc) = sumk 
 3400       continue                                                             
 3200    continue                                                                
 3000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(8)                                                  
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(7)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+112) 
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 7400 igc = 1,ngc(8)                                                     
         sumf1= 0.                                                               
         sumf2= 0.                                                               
         sumk1= 0.                                                               
         sumk2= 0.                                                               
         sumk3= 0.                                                               
         sumk4= 0.                                                               
         sumk5= 0.                                                               
         sumk6= 0.                                                               
         do 7600 ipr = 1, ngn(ngs(7)+igc)                                        
            iprsm = iprsm + 1                                                    
            sumf1= sumf1+ fracrefa(iprsm)                                        
            sumf2= sumf2+ fracrefb(iprsm)                                        
            sumk1= sumk1+ absco2a(iprsm)*rwgt(iprsm+112)                         
            sumk2= sumk2+ absco2b(iprsm)*rwgt(iprsm+112)                         
            sumk3= sumk3+ absn2oa(iprsm)*rwgt(iprsm+112)                         
            sumk4= sumk4+ absn2ob(iprsm)*rwgt(iprsm+112)                         
            sumk5= sumk5+ cfc12(iprsm)*rwgt(iprsm+112)                           
            sumk6= sumk6+ cfc22adj(iprsm)*rwgt(iprsm+112)                        
 7600    continue                                                                
         fracrefac(igc) = sumf1                                                  
         fracrefbc(igc) = sumf2                                                  
         absco2ac(igc) = sumk1                                                   
         absco2bc(igc) = sumk2                                                   
         absn2oac(igc) = sumk3                                                   
         absn2obc(igc) = sumk4                                                   
         cfc12c(igc) = sumk5                                                     
         cfc22adjc(igc) = sumk6                                                  
 7400 continue                                                                   
                                                                                 
   end subroutine cmbgb8

!***************************************************************************
   subroutine cmbgb9(abscoefl, abscoefh, selfref,                      &
                     fracrefa, fracrefb, absn2o,                       &
                     selfrefc, absn2oc, fracrefac, fracrefbc           )
!***************************************************************************     
!                                                                                
!     band 9:  1180-1390 cm-1 (low - h2o,ch4; high - ch4)                        
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(11,5,13,mg), abscoefh(5,13:59,mg)
      real selfref(10,mg)   
      real fracrefa(mg,9), fracrefb(mg), absn2o(3*mg)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng9), absn2oc(3*ng9)
      real fracrefac(ng9,9), fracrefbc(ng9)
                                                                                 
      do 2000 jn = 1,11                                                          
         do 2000 jtjt = 1,5                                                        
            do 2200 jpjp = 1,13                                                    
               iprsm = 0                                                         
               do 2400 igc = 1,ngc(9)                                            
                  sumk = 0.                                                      
                  do 2600 ipr = 1, ngn(ngs(8)+igc)                               
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefl(jn,jtjt,jpjp,iprsm)*rwgt(iprsm+128)
 2600             continue                                                       
                  absa9(jn+(jtjt-1)*11+(jpjp-1)*55,igc) = sumk                                       
 2400          continue                                                          
 2200       continue                                                             
 2000 continue                                                                   
                                                                                 
      do 3000 jtjt = 1,5                                                           
         do 3200 jpjp = 13,59                                                      
            iprsm = 0                                                            
            do 3400 igc = 1,ngc(9)                                               
               sumk = 0.                                                         
               do 3600 ipr = 1, ngn(ngs(8)+igc)                                  
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefh(jtjt,jpjp,iprsm)*rwgt(iprsm+128)
 3600          continue                                                          
               absb9(jtjt+(jpjp-13)*5,igc) = sumk
 3400       continue                                                             
 3200    continue                                                                
 3000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(9)                                                  
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(8)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+128)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      do 5000 jn = 1,3                                                           
         iprsm = 0                                                               
         do 5400 igc = 1,ngc(9)                                                  
            sumk = 0.                                                            
            do 5600 ipr = 1, ngn(ngs(8)+igc)                                     
               iprsm = iprsm + 1                                                 
               jnd = (jn-1)*16                                                   
               sumk = sumk + absn2o(jnd+iprsm)*rwgt(iprsm+128)                   
 5600       continue                                                             
            jndc = (jn-1)*ngc(9)                                                 
            absn2oc(jndc+igc) = sumk                                             
 5400    continue                                                                
 5000 continue                                                                   
                                                                                 
      do 6000 jpjp = 1,9                                                           
         iprsm = 0                                                               
         do 6400 igc = 1,ngc(9)                                                  
            sumf = 0.                                                            
            do 6600 ipr = 1, ngn(ngs(8)+igc)                                     
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefa(iprsm,jpjp)                                  
 6600       continue                                                             
            fracrefac(igc,jpjp) = sumf                                             
 6400    continue                                                                
 6000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 7400 igc = 1,ngc(9)                                                     
         sumf = 0.                                                               
         do 7600 ipr = 1, ngn(ngs(8)+igc)                                        
            iprsm = iprsm + 1                                                    
            sumf = sumf + fracrefb(iprsm)                                        
 7600    continue                                                                
         fracrefbc(igc) = sumf                                                   
 7400 continue                                                                   
                                                                                 
   end subroutine cmbgb9

!***************************************************************************
   subroutine cmbgb10(abscoefl, abscoefh,                               &
                      fracrefa, fracrefb,                               &
                      fracrefac, fracrefbc                              )
!***************************************************************************     
!                                                                                
!     band 10:  1390-1480 cm-1 (low - h2o; high - h2o)                           
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(5,13,mg),abscoefh(5,13:59,mg)            
      real fracrefa(mg), fracrefb(mg)
!     real rwgt(mg*nbands) 
! output                                                                         
      real fracrefac(ng10), fracrefbc(ng10)
                                                                                 
      do 2000 jtjt = 1,5                                                           
         do 2200 jpjp = 1,13                                                       
            iprsm = 0                                                            
            do 2400 igc = 1,ngc(10)                                              
               sumk = 0.                                                         
               do 2600 ipr = 1, ngn(ngs(9)+igc)                                  
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefl(jtjt,jpjp,iprsm)*rwgt(iprsm+144)
 2600          continue                                                          
               absa10(jtjt+(jpjp-1)*5,igc) = sumk                                             
 2400       continue                                                             
 2200    continue                                                                
 2000 continue                                                                   
      do 3000 jtjt = 1,5                                                           
         do 3200 jpjp = 13,59                                                      
            iprsm = 0                                                            
            do 3400 igc = 1,ngc(10)                                              
               sumk = 0.                                                         
               do 3600 ipr = 1, ngn(ngs(9)+igc)                                  
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefh(jtjt,jpjp,iprsm)*rwgt(iprsm+144)
 3600          continue                                                          
               absb10(jtjt+(jpjp-13)*5,igc) = sumk
 3400       continue                                                             
 3200    continue                                                                
 3000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 7400 igc = 1,ngc(10)                                                    
         sumf1= 0.                                                               
         sumf2= 0.                                                               
         do 7600 ipr = 1, ngn(ngs(9)+igc)                                        
            iprsm = iprsm + 1                                                    
            sumf1= sumf1+ fracrefa(iprsm)                                        
            sumf2= sumf2+ fracrefb(iprsm)                                        
 7600    continue                                                                
         fracrefac(igc) = sumf1                                                  
         fracrefbc(igc) = sumf2                                                  
 7400 continue                                                                   
                                                                                 
   end subroutine cmbgb10

!***************************************************************************
   subroutine cmbgb11(abscoefl, abscoefh, selfref,                   &
                      fracrefa, fracrefb,                            &
                      selfrefc,                                      &
                      fracrefac, fracrefbc                           )
!***************************************************************************     
!                                                                                
!     band 11:  1480-1800 cm-1 (low - h2o; high - h2o)                           
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(5,13,mg),abscoefh(5,13:59,mg)
      real selfref(10,mg)      
      real fracrefa(mg), fracrefb(mg)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng11)
      real fracrefac(ng11), fracrefbc(ng11)
                                                                                 
      do 2000 jtjt = 1,5                                                           
         do 2200 jpjp = 1,13                                                       
            iprsm = 0                                                            
            do 2400 igc = 1,ngc(11)                                              
               sumk = 0.                                                         
               do 2600 ipr = 1, ngn(ngs(10)+igc)                                 
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefl(jtjt,jpjp,iprsm)*rwgt(iprsm+160)
 2600          continue                                                          
               absa11(jtjt+(jpjp-1)*5,igc) = sumk                                             
 2400       continue                                                             
 2200    continue                                                                
 2000 continue                                                                   
      do 3000 jtjt = 1,5                                                           
         do 3200 jpjp = 13,59                                                      
            iprsm = 0                                                            
            do 3400 igc = 1,ngc(11)                                              
               sumk = 0.                                                         
               do 3600 ipr = 1, ngn(ngs(10)+igc)                                 
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefh(jtjt,jpjp,iprsm)*rwgt(iprsm+160) 
 3600          continue                                                          
               absb11(jtjt+(jpjp-13)*5,igc) = sumk
 3400       continue                                                             
 3200    continue                                                                
 3000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(11)                                                 
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(10)+igc)                                    
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+160) 
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 7400 igc = 1,ngc(11)                                                    
         sumf1= 0.                                                               
         sumf2= 0.                                                               
         do 7600 ipr = 1, ngn(ngs(10)+igc)                                       
            iprsm = iprsm + 1                                                    
            sumf1= sumf1+ fracrefa(iprsm)                                        
            sumf2= sumf2+ fracrefb(iprsm)                                        
 7600    continue                                                                
         fracrefac(igc) = sumf1                                                  
         fracrefbc(igc) = sumf2                                                  
 7400 continue                                                                   
                                                                                 
   end subroutine cmbgb11


!***************************************************************************
   subroutine cmbgb12(abscoefl, selfref,                          &
                      fracrefa,                                   &
                      selfrefc, fracrefac                         )
!***************************************************************************     
!                                                                                
!     band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)                   
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(9,5,13,mg)  
      real selfref(10,mg)              
      real fracrefa(mg,9)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng12) 
      real fracrefac(ng12,9)
                                                                                 
      do 2000 jn = 1,9                                                           
         do 2000 jtjt = 1,5                                                        
            do 2200 jpjp = 1,13                                                    
               iprsm = 0                                                         
               do 2400 igc = 1,ngc(12)                                           
                  sumk = 0.                                                      
                  do 2600 ipr = 1, ngn(ngs(11)+igc)                              
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefl(jn,jtjt,jpjp,iprsm)*rwgt(iprsm+176)
 2600             continue                                                       
                  absa12(jn+(jtjt-1)*9+(jpjp-1)*45,igc) = sumk                                       
 2400          continue                                                          
 2200       continue                                                             
 2000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(12)                                                 
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(11)+igc)                                    
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+176)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      do 7000 jpjp = 1,9                                                           
         iprsm = 0                                                               
         do 7400 igc = 1,ngc(12)                                                 
            sumf = 0.                                                            
            do 7600 ipr = 1, ngn(ngs(11)+igc)                                    
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefa(iprsm,jpjp)                                  
 7600       continue                                                             
            fracrefac(igc,jpjp) = sumf                                             
 7400    continue                                                                
 7000 continue                                                                   
                                                                                 
   end subroutine cmbgb12

!***************************************************************************
   subroutine cmbgb13(abscoefl, selfref, fracrefa,               &
                      selfrefc, fracrefac                        )
!***************************************************************************     
!                                                                                
!     band 13:  2080-2250 cm-1 (low - h2o,n2o; high - nothing)                   
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(9,5,13,mg) 
      real selfref(10,mg)   
      real fracrefa(mg,9)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng13) 
      real fracrefac(ng13,9)
                                                                                 
      do 2000 jn = 1,9                                                           
         do 2000 jtjt = 1,5                                                        
            do 2200 jpjp = 1,13                                                    
               iprsm = 0                                                         
               do 2400 igc = 1,ngc(13)                                           
                  sumk = 0.                                                      
                  do 2600 ipr = 1, ngn(ngs(12)+igc)                              
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefl(jn,jtjt,jpjp,iprsm)*rwgt(iprsm+192)
 2600             continue                                                       
                  absa13(jn+(jtjt-1)*9+(jpjp-1)*45,igc) = sumk 
 2400          continue                                                          
 2200       continue                                                             
 2000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(13)                                                 
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(12)+igc)                                    
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+192)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      do 7000 jpjp = 1,9                                                           
         iprsm = 0                                                               
         do 7400 igc = 1,ngc(13)                                                 
            sumf = 0.                                                            
            do 7600 ipr = 1, ngn(ngs(12)+igc)                                    
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefa(iprsm,jpjp)                                  
 7600       continue                                                             
            fracrefac(igc,jpjp) = sumf                                             
 7400    continue                                                                
 7000 continue                                                                   
                                                                                 
   end subroutine cmbgb13

!***************************************************************************
   subroutine cmbgb14(abscoefl, abscoefh, selfref,                     &
                      fracrefa, fracrefb,                              &
                      selfrefc, fracrefac, fracrefbc                   )
!***************************************************************************     
!                                                                                
!     band 14:  2250-2380 cm-1 (low - co2; high - co2)                           
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(5,13,mg),abscoefh(5,13:59,mg)
      real selfref(10,mg)  
      real fracrefa(mg), fracrefb(mg)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng14)                              
      real fracrefac(ng14), fracrefbc(ng14) 
                                                                                 
      do 2000 jtjt = 1,5                                                           
         do 2200 jpjp = 1,13                                                       
            iprsm = 0                                                            
            do 2400 igc = 1,ngc(14)                                              
               sumk = 0.                                                         
               do 2600 ipr = 1, ngn(ngs(13)+igc)                                 
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefl(jtjt,jpjp,iprsm)*rwgt(iprsm+208)
 2600          continue                                                          
               absa14(jtjt+(jpjp-1)*5,igc) = sumk
 2400       continue                                                             
 2200    continue                                                                
 2000 continue                                                                   
                                                                                 
      do 3000 jtjt = 1,5                                                           
         do 3200 jpjp = 13,59                                                      
            iprsm = 0                                                            
            do 3400 igc = 1,ngc(14)                                              
               sumk = 0.                                                         
               do 3600 ipr = 1, ngn(ngs(13)+igc)                                 
                  iprsm = iprsm + 1                                              
                  sumk = sumk + abscoefh(jtjt,jpjp,iprsm)*rwgt(iprsm+208)
 3600          continue                                                          
               absb14(jtjt+(jpjp-13)*5,igc) = sumk
 3400       continue                                                             
 3200    continue                                                                
 3000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(14)                                                 
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(13)+igc)                                    
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+208)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      iprsm = 0                                                                  
      do 7400 igc = 1,ngc(14)                                                    
         sumf1= 0.                                                               
         sumf2= 0.                                                               
         do 7600 ipr = 1, ngn(ngs(13)+igc)                                       
            iprsm = iprsm + 1                                                    
            sumf1= sumf1+ fracrefa(iprsm)                                        
            sumf2= sumf2+ fracrefb(iprsm)                                        
 7600    continue                                                                
         fracrefac(igc) = sumf1                                                  
         fracrefbc(igc) = sumf2                                                  
 7400 continue                                                                   
                                                                                 
            
   end subroutine cmbgb14

!***************************************************************************
   subroutine cmbgb15(abscoefl, selfref, fracrefa,                &
                      selfrefc, fracrefac                         )
!***************************************************************************
!                                                                                
!     band 15:  2380-2600 cm-1 (low - n2o,co2; high - nothing)                   
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(9,5,13,mg)                                                         
      real selfref(10,mg)  
      real fracrefa(mg,9)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng15)
      real fracrefac(ng15,9) 
                                                                                 
      do 2000 jn = 1,9                                                           
         do 2000 jtjt = 1,5                                                        
            do 2200 jpjp = 1,13                                                    
               iprsm = 0                                                         
               do 2400 igc = 1,ngc(15)                                           
                  sumk = 0.                                                      
                  do 2600 ipr = 1, ngn(ngs(14)+igc)                              
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefl(jn,jtjt,jpjp,iprsm)*rwgt(iprsm+224)
 2600             continue                                                       
                  absa15(jn+(jtjt-1)*9+(jpjp-1)*45,igc) = sumk 
 2400          continue                                                          
 2200       continue                                                             
 2000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(15)                                                 
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(14)+igc)                                    
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+224)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      do 7000 jpjp = 1,9                                                           
         iprsm = 0                                                               
         do 7400 igc = 1,ngc(15)                                                 
            sumf = 0.                                                            
            do 7600 ipr = 1, ngn(ngs(14)+igc)                                    
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefa(iprsm,jpjp)                                  
 7600       continue                                                             
            fracrefac(igc,jpjp) = sumf                                             
 7400    continue                                                                
 7000 continue                                                                   
                                                                                 
   end subroutine cmbgb15

!***************************************************************************
   subroutine cmbgb16(abscoefl, selfref, fracrefa,               &
                      selfrefc, fracrefac                        )
!***************************************************************************     
!                                                                                
!     band 16:  2600-3000 cm-1 (low - h2o,ch4; high - nothing)                   
!***************************************************************************     
                                                                                 
! input                                                                          
      real abscoefl(9,5,13,mg)                                                         
      real selfref(10,mg)     
      real fracrefa(mg,9)
!     real rwgt(mg*nbands) 
! output                                                                         
      real selfrefc(10,ng16)
      real fracrefac(ng16,9)
                                                                                 
      do 2000 jn = 1,9                                                           
         do 2000 jtjt = 1,5                                                        
            do 2200 jpjp = 1,13                                                    
               iprsm = 0                                                         
               do 2400 igc = 1,ngc(16)                                           
                  sumk = 0.                                                      
                  do 2600 ipr = 1, ngn(ngs(15)+igc)                              
                     iprsm = iprsm + 1                                           
                     sumk = sumk + abscoefl(jn,jtjt,jpjp,iprsm)*rwgt(iprsm+240)
 2600             continue                                                       
                  absa16(jn+(jtjt-1)*9+(jpjp-1)*45,igc) = sumk
 2400          continue                                                          
 2200       continue                                                             
 2000 continue                                                                   
                                                                                 
      do 4000 jtjt = 1,10                                                          
         iprsm = 0                                                               
         do 4400 igc = 1,ngc(16)                                                 
            sumk = 0.                                                            
            do 4600 ipr = 1, ngn(ngs(15)+igc)                                    
               iprsm = iprsm + 1                                                 
               sumk = sumk + selfref(jtjt,iprsm)*rwgt(iprsm+240)
 4600       continue                                                             
            selfrefc(jtjt,igc) = sumk                                              
 4400    continue                                                                
 4000 continue                                                                   
                                                                                 
      do 7000 jpjp = 1,9                                                           
         iprsm = 0                                                               
         do 7400 igc = 1,ngc(16)                                                 
            sumf = 0.                                                            
            do 7600 ipr = 1, ngn(ngs(15)+igc)                                    
               iprsm = iprsm + 1                                                 
               sumf = sumf + fracrefa(iprsm,jpjp)                                  
 7600       continue                                                             
            fracrefac(igc,jpjp) = sumf                                             
 7400    continue                                                                
 7000 continue                                                                   
                                                                                 
   end subroutine cmbgb16
 
!-------------------------------------------------------------------------
   subroutine inirad (o3prof,pw, kts, kte)
!-------------------------------------------------------------------------
      implicit none
!-------------------------------------------------------------------------
   integer, intent(in   )                        ::    kts,kte

   real, dimension( kts:kte ),intent(inout)      ::    o3prof

   real, dimension( kts:kte+1 ),intent(in   )    ::        pw

! local var
  
   real, dimension( kts:kte+1 ) :: pavel, tavel 
   real, dimension(   0:kte+1 ) :: pz, tz

   integer :: k


!                                                                                
!  compute ozone mixing ratio distribution                                       
!                                                                                
   do k=kts,kte
      o3prof(k)=0.                                                       
   enddo
                                                                                 
   call o3data(o3prof, pw, kts, kte)
!                                                                                
   end subroutine inirad
                                                                                 
!-------------------------------------------------------------------------
   subroutine o3data (o3prof, pw, kts, kte)
!-------------------------------------------------------------------------
   implicit none
!-------------------------------------------------------------------------
!
   integer, intent(in   )   ::       kts, kte
!
   real, dimension( kts:kte ),intent(inout)      ::    o3prof

   real, dimension( kts:kte+1 ),intent(in   )    ::        pw

! local var
   integer :: k, jj, nk

   real    ::  prlevh(kts:kte+1),ppwrkh(32),                       &
               o3wrk(31),ppwrk(31),o3sum(31),ppsum(31),          &
               o3win(31),ppwin(31),o3ann(31),ppann(31)                                                       

   real    ::  pb1, pb2, pt1, pt2

   data o3sum  /5.297e-8,5.852e-8,6.579e-8,7.505e-8,             &                    
        8.577e-8,9.895e-8,1.175e-7,1.399e-7,1.677e-7,2.003e-7,   &                 
        2.571e-7,3.325e-7,4.438e-7,6.255e-7,8.168e-7,1.036e-6,   &                 
        1.366e-6,1.855e-6,2.514e-6,3.240e-6,4.033e-6,4.854e-6,   &                 
        5.517e-6,6.089e-6,6.689e-6,1.106e-5,1.462e-5,1.321e-5,   &                 
        9.856e-6,5.960e-6,5.960e-6/                                              

   data ppsum  /955.890,850.532,754.599,667.742,589.841,         &  
        519.421,455.480,398.085,347.171,301.735,261.310,225.360, &               
        193.419,165.490,141.032,120.125,102.689, 87.829, 75.123, &            
         64.306, 55.086, 47.209, 40.535, 34.795, 29.865, 19.122, &               
          9.277,  4.660,  2.421,  1.294,  0.647/                                 
!                                                                                
   data o3win  /4.629e-8,4.686e-8,5.017e-8,5.613e-8,             &
        6.871e-8,8.751e-8,1.138e-7,1.516e-7,2.161e-7,3.264e-7,   &               
        4.968e-7,7.338e-7,1.017e-6,1.308e-6,1.625e-6,2.011e-6,   &               
        2.516e-6,3.130e-6,3.840e-6,4.703e-6,5.486e-6,6.289e-6,   &               
        6.993e-6,7.494e-6,8.197e-6,9.632e-6,1.113e-5,1.146e-5,   &               
        9.389e-6,6.135e-6,6.135e-6/                                              

   data ppwin  /955.747,841.783,740.199,649.538,568.404,         &
        495.815,431.069,373.464,322.354,277.190,237.635,203.433, &               
        174.070,148.949,127.408,108.915, 93.114, 79.551, 67.940, &               
         58.072, 49.593, 42.318, 36.138, 30.907, 26.362, 16.423, &               
          7.583,  3.620,  1.807,  0.938,  0.469/                                 
!                                                                                

   do k=1,31                                                              
     ppann(k)=ppsum(k)                                                        
   enddo
!
   o3ann(1)=0.5*(o3sum(1)+o3win(1))                                           
!                                                                                
   do k=2,31                                                              
      o3ann(k)=o3win(k-1)+(o3win(k)-o3win(k-1))/(ppwin(k)-ppwin(k-1))* & 
               (ppsum(k)-ppwin(k-1))                                           
   enddo
!
   do k=2,31                                                              
      o3ann(k)=0.5*(o3ann(k)+o3sum(k))                                         
   enddo
!
   do k=1,31                                                                
      o3wrk(k)=o3ann(k)                                                        
      ppwrk(k)=ppann(k)                                                        
   enddo
!                                                                                
!  calculate half pressure levels for model and data levels                     
!                                                                                

! pw is total p at w level
! pw is in mb

   do k=kts,kte+1
      nk=kte+1-k+1
      prlevh(k)=pw(nk)
   enddo
!                                                                                
   ppwrkh(1)=1100.                                                        
   do k=2,31                                                           
      ppwrkh(k)=(ppwrk(k)+ppwrk(k-1))/2.                                   
   enddo
   ppwrkh(32)=0.                                                          
   do k=kts,kte
      do 25 jj=1,31                                                        
         if((-(prlevh(k)-ppwrkh(jj))).ge.0.)then                            
           pb1=0.                                                           
         else                                                               
           pb1=prlevh(k)-ppwrkh(jj)                                         
         endif                                                              
         if((-(prlevh(k)-ppwrkh(jj+1))).ge.0.)then                          
           pb2=0.                                                           
         else                                                               
           pb2=prlevh(k)-ppwrkh(jj+1)                                       
         endif                                                              
         if((-(prlevh(k+1)-ppwrkh(jj))).ge.0.)then                          
           pt1=0.                                                           
         else                                                               
           pt1=prlevh(k+1)-ppwrkh(jj)                                       
         endif                                                              
         if((-(prlevh(k+1)-ppwrkh(jj+1))).ge.0.)then                        
           pt2=0.                                                           
         else                                                               
           pt2=prlevh(k+1)-ppwrkh(jj+1)                                     
         endif                                                              
         o3prof(k)=o3prof(k)+(pb2-pb1-pt2+pt1)*o3wrk(jj)                
  25  continue                                                             
      o3prof(k)=o3prof(k)/(prlevh(k)-prlevh(k+1))                      

   enddo
!                                                                                
   end subroutine o3data

!---------------------------------------------------------------------------
   subroutine mm5atm(cldfra,o3prof,t,tw,tsfc,qv,qc,qr,qi,qs,qg,    &
                     p,pw,delz,emiss,r,g,                          &
                     pavel,tavel,pz,tz,cldfrac,taucloud,coldry,    &
                     wkl,wx,tbound,semiss,                         &
                     kts,kte                                       )
!---------------------------------------------------------------------------
!  rrtm longwave radiative transfer model                                        
!  atmospheric and environmental research, inc., cambridge, ma                   
!                                                                                
!  revision for ncar mm5:  j. dudhia (converted from ccm code)                   
!                                                                                
!  input atmospheric profile from ncar mm5, and prepare it for use in rrtm.      
!  set other rrtm input parameters.  values are passed back through existing     
!  rrtm arrays and commons.                                                      
!---------------------------------------------------------------------------
! rrtm definitions                                                               
!    mxlay = kte+1                ! maximum number of model layers               
!    maxxsec                      ! maximum number of cross sections             
!    nlayers                      ! number of model layers (kte+1)               
!    pavel(mxlay)                 ! layer pressures (mb)                         
!    pz(0:mxlay)                  ! level (interface) pressures (mb)             
!    tavel(mxlay)                 ! layer temperatures (k)                       
!    tz(0:mxlay)                  ! level (interface) temperatures(mb)           
!    tbound                       ! surface temperature (k)                      
!    coldry(mxlay)                ! dry air column (molecules/cm2)               
!    wkl(35,mxlay)                ! molecular amounts (molecules/cm2)            
!    wbrodl(mxlay)                ! inactive in this version                     
!    wx(maxxsec)                  ! cross-section amounts (molecules/cm2)        
!    cldfrac(mxlay)               ! layer cloud fraction                         
!    taucloud(mxlay)              ! layer cloud optical depth                    
!    amd                          ! atomic weight of dry air                     
!    amw                          ! atomic weight of water                       
!    amo                          ! atomic weight of ozone                       
!    amch4                        ! atomic weight of methane                     
!    amn2o                        ! atomic weight of nitrous oxide               
!    amc11                        ! atomic weight of cfc-11                      
!    amc12                        ! atomic weight of cfc-12                      
!    nxmol                        ! number of cross-section molecules            
!    ixindx                       ! cross-section molecule index (see below)     
!    ixsect                       ! on/off flag for cross-sections (inactive)    
!    ixmax                        ! maximum number of cross-sections (inactive)  
!                                                                                
!-----------------------------------------------------------------------------
! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
!----------------------------------------------------------------------------
!     activate cross section molecules:                                             
!     nxmol     - number of cross-sections input by user                         
!     ixindx(i) - index of cross-section molecule corresponding to ith           
!                 cross-section specified by user                                
!                 = 0 -- not allowed in rrtm                                     
!                 = 1 -- ccl4                                                    
!                 = 2 -- cfc11                                                   
!                 = 3 -- cfc12                                                   
!                 = 4 -- cfc22                                                   
!     data nxmol  /2/                                                            
!     data ixindx /0,2,3,0,31*0/                                                 
!                                                                                 
!    cloud emissivities (m^2/g)                                                  
!    these are consistent with lwrad (abcw=0.5*(abup+abdown))                    
!----------------------------------------------------------------------------

                                                                                 
      integer, intent(in ) ::  kts, kte
!
      real, dimension( 35,kts:kte+1 ),                    &
            intent(inout)        ::                  wkl

      real, dimension( maxxsec,kts:kte+1 ),               &
            intent(inout)        ::                   wx

      real, intent(inout)        ::               tbound
      real, dimension(nbands), intent(inout) ::   semiss

      real, dimension( kts:kte+1 ), intent(in   ) ::      &
                                                      tw, &
                                                      pw
      real, dimension( kts:kte ), intent(in   ) ::        &
                                                  cldfra, &
                                                  o3prof, &
                                                    delz, &
                                                       t, &
                                                       p

      real, dimension( kts:kte ), intent(inout) ::        &
                                                      qv

      real, dimension( kts:kte ), intent(in   ) ::        &
                                                      qc, &
                                                      qr, &
                                                      qi, &
                                                      qs, &
                                                      qg

      real, dimension( kts:kte+1 ), intent(inout) ::      &
                                                   pavel, &
                                                   tavel, &
                                                 cldfrac, &    
                                                taucloud, &
                                                  coldry 

      real, dimension(   0:kte+1 ), intent(inout) ::      &
                                                      pz, &
                                                      tz

      real, intent(in   ) ::   r,g,emiss,tsfc

      real    :: gravit
 
!
! local

      real, dimension( kts:kte ) ::                 cldfrc, &
                                                      pint, &
                                                      tint, &
                                                        o3, &
                                                       n2o, &
                                                       ch4, &
                                                      clwp, &
                                                      ciwp, &
                                                      plwp, &
                                                      piwp
                           
      real :: amd       ! effective molecular weight of dry air (g/mol)  
      real :: amw       ! molecular weight of water vapor (g/mol)        
      real :: amo       ! molecular weight of ozone (g/mol)              
      real :: amch4     ! molecular weight of methane (g/mol)            
      real :: amn2o     ! molecular weight of nitrous oxide (g/mol)      
      real :: amc11     ! molecular weight of cfc11 (g/mol) - cfcl3      
      real :: amc12     ! molecular weight of cfc12 (g/mol) - cf2cl2     
      real :: avgdro    ! avogadro's number (molecules/mole)             
                                                                                 
! atomic weights for conversion from mass to volume mixing ratios                

      data amd   /  28.9644   /                                                  
      data amw   /  18.0154   /                                                  
      data amo   /  47.9998   /                                                  
      data amch4 /  16.0430   /                                                  
      data amn2o /  44.0128   /                                                  
      data amc11 / 137.3684   /                                                  
      data amc12 / 120.9138   /                                                  
      data avgdro/ 6.022e23   /                                                  
                                                                                 
!     set molecular weight ratios                                                    

      real :: amdw,  &  ! molecular weight of dry air / water vapor      
              amdc,  &  ! molecular weight of dry air / methane          
              amdn,  &  ! molecular weight of dry air / nitrous oxide    
              amdc1, &  ! molecular weight of dry air / cfc11            
              amdc2     ! molecular weight of dry air / cfc12            

      data amdw /  1.607758 /                                                    
      data amdc /  1.805423 /                                                    
      data amdn /  0.658090 /                                                    
      data amdc1/  0.210852 /                                                    
      data amdc2/  0.239546 /                                                    

!     put in co2 volume mixing ratio here (330 ppmv)                                

      real :: co2vmr
      data co2vmr / 330.e-6 /                                                    
                                                                                 
      real :: abcw,abice,abrn,absn

      data abcw /0.144/                                                          
      data abice /0.0735/                                                        
      data abrn /0.330e-3/                                                       
      data absn /2.34e-3/                                                        

      gravit = g*100.

!                                                                                
!  mid-layer values                                                              
      do k=kts,kte
          ro=p(k)/(r*t(k))*100.                                                  
          dz=delz(k)
          qv(k)=amax1(qv(k),1.e-12) 
  
          cldfrc(k)=cldfra(k)                                                   
                                                                                 
!  paths in g/m^2                                                                

! qi=0 if no ice phase
! qs=0 if no ice phase

            clwp(k)=ro*qc(k)*dz*1000.                                            
            ciwp(k)=ro*qi(k)*dz*1000.                                            
            plwp(k)=(ro*qr(k))**0.75*dz*1000.                                    
            piwp(k)=(ro*qs(k))**0.75*dz*1000.                                   
                                                                                 
          o3(k)=o3prof(k)                                                      
          n2o(k)=0.                                                              
          ch4(k)=0.                                                              
                                                                                 
      enddo                                                                      
                                                                                 
!  initialize all molecular amounts to zero here, then pass mm5 amounts          
!  into rrtm arrays wkl and wx below.                                            
                                                                                 
      do 1000 ilay = kts,kte+1
         do 1100 isp = 1,35                                                      
 1100       wkl(isp,ilay) = 0.0                                                  
         do 1200 isp = 1,maxxsec                                                 
 1200       wx(isp,ilay) = 0.0                                                   
 1000 continue                                                                   
                                                                                 
!  set parameters needed for rrtm execution:                                     

      ixsect = 1                                                                 
      ixmax = 4                                                                  
                                                                                 
!  set surface temperature.  the longwave upward surface flux is                 
!  computed in the land surface model based on the surface                       
!  temperature and the emissivity of the surface type for each                   
!  grid point.  the bottom interface temperature, tint(kte+1), is                 
!  ground temperature consistent with this lw upward flux, and                   
!  tbound is set to this temperature here.                                       
                                                                                 
!     tbound = tint(kte+1)                                                        
      tbound = tw(kte+1)                                                        
!     tbound = tsfc
                                                                                 
!  install mm5 profiles into rrtm arrays for pressure, temperature,              
!  and molecular amounts.  pressures are converted from cb                       
!  (ccm) to mb (rrtm).  h2o and trace gas amounts are converted from             
!  mass mixing ratio to volume mixing ratio.  co2 vmr is constant at all         
!  levels.  the dry air column coldry (in molec/cm2) is calculated               
!  from the level pressures pz (in mb) based on the hydrostatic equation         
!  and includes a correction to account for h2o in the layer.  the               
!  molecular weight of moist air (amm) is calculated for each layer.             
                                                                                 
!  rrtm is executed for an additional layer (l=kte+1), which extends              
!  from the model top (ptop) to 0 mb, to calculate the downward                  
!  flux at the model top interface.  h2o, co2, and o3 vmrs for this              
!  extra layer are set to the values in the model's top layer, though            
!  the o3 value is reduced by a fraction (0.6) based on the us std atm.          
!  for gcms with a model top near 0 mb, this extra layer is not needed, and      
!  nlayers should be set to the number of model layers (kte in this case).       
!  note: rrtm levels count from bottom to top, while mm5 levels count            
!  from the top down and must be reversed here.                                  
                                                                                 
!     nmol = 6                                                                   
!     pz(0) = pint(kte+1)                                                         
!     tz(0) = tint(kte+1)                                                         

      pz(0) = pw(kte+1)                                                         
      tz(0) = tw(kte+1)                                                         
      do 2000 l = 1, nlayers-1                                                   
         pavel(l) = p(kte+1-l)                                                   
         tavel(l) = t(kte+1-l)                                                   
!        pz(l) = pint(kte+1-l)                                                    
!        tz(l) = tint(kte+1-l)                                                    
         pz(l) = pw(kte+1-l)                                                    
         tz(l) = tw(kte+1-l)                                                    
         wkl(1,l) = qv(kte+1-l)*amdw                                             
         wkl(2,l) = co2vmr                                                       
         wkl(3,l) = o3(kte+1-l)                                                  
         wkl(4,l) = n2o(kte+1-l)*amdn                                            
         wkl(6,l) = ch4(kte+1-l)*amdc                                            
         amm = (1-wkl(1,l))*amd + wkl(1,l)*amw                                   
         coldry(l) = (pz(l-1)-pz(l))*1.e3*avgdro/    & 
                               (gravit*amm*(1+wkl(1,l)))                         
 2000    continue                                                                
                                                                                 
!  set cross section molecule amounts from ccm; convert to vmr                   
      do 2100 l=1, nlayers-1                                                     
!        wx(2,l) = c11mmr(kte+1-l)*amdc1                                         
!        wx(3,l) = c12mmr(kte+1-l)*amdc2                                         
         wx(2,l) = 0.                                                            
         wx(3,l) = 0.                                                            
 2100 continue                                                                   
                                                                                 
!  *****                                                                         
!  set up values for extra layer at top of the atmosphere.                       
!  the top layer temperature for all gridpoints is set to the top layer-1        
!  temperature plus a constant (0 k) that represents an isothermal layer         
!  above ptop.  top layer interface temperatures are                             
!  linearly interpolated from the layer temperatures.                            
!  note: the top layer temperature and ozone amount are based on a 0-3mb         
!  top layer and must be modified if the layering is changed.                    
!  this section should be commented if the extra layer is not needed.            
                                                                                 
      pavel(nlayers) = 0.5*pz(nlayers-1)                                         
      tavel(nlayers) = tavel(nlayers-1) + 0.0                                    
      pz(nlayers) = 0.00                                                         
      tz(nlayers-1) = 0.5*(tavel(nlayers)+tavel(nlayers-1))                      
      tz(nlayers) = tz(nlayers-1)+0.0                                            
      wkl(1,nlayers) = wkl(1,nlayers-1)                                          
      wkl(2,nlayers) = co2vmr                                                    
      wkl(3,nlayers) = 0.6*wkl(3,nlayers-1)                                      
      wkl(4,nlayers) = wkl(4,nlayers-1)                                          
      wkl(6,nlayers) = wkl(6,nlayers-1)                                          
      amm = (1-wkl(1,nlayers-1))*amd + wkl(1,nlayers-1)*amw                      
!     coldry(nlayers) = (pz(nlayers-1))*1.e3*avgdro/       & 
      coldry(nlayers) = ((pz(nlayers-1)-pz(nlayers)))*1.e3*avgdro/       & 
                               (gravit*amm*(1+wkl(1,nlayers-1)))                 
      wx(2,nlayers) = wx(2,nlayers-1)                                            
      wx(3,nlayers) = wx(3,nlayers-1)                                            
!  *****                                                                         
                                                                                 
!  here, all molecules in wkl and wx are in volume mixing ratio; convert to      
!  molec/cm2 based on coldry for use in rrtm                                     
                                                                                 
      do 5000 l = 1, nlayers                                                     
         do 4200 imol = 1, nmol                                                  
            wkl(imol,l) = coldry(l) * wkl(imol,l)                                
 4200    continue                                                                
         do 4400 ix = 1,maxxsec                                                  
            if (ixindx(ix) .ne. 0) then                                          
               wx(ixindx(ix),l) = coldry(l) * wx(ix,l) * 1.e-20                  
            endif                                                                
 4400    continue                                                                
 5000 continue                                                                   
                                                                                 
!  set spectral surface emissivity for each longwave band.  the default value    
!  is set here to emiss(i,j) based on land-use (taken to be constant across band 
!  comment: if land-surface uses skin temperature, emissivity must match that    
!   used in its calculation (e.g. 1.0)                                           
      do 5500 n=1,nbands                                                         
         semiss(n) = emiss
 5500 continue                                                                   
                                                                                 
!  transfer cloud fraction to rrtm array; compute cloud optical depth, taucloud, 
!  as the product of clwp and cloud mass absorption coefficient in mm5, which is 
!  a  combination of liquid and ice absorption coefficients.                     
!  note: rrtm levels count from bottom to top, while ccm levels count from the   
!  top down and must be reversed here.  values for the extra rrtm level (above   
!  the model top) are set to zero.                                               
                                                                                 
      do 7000 l = 1, nlayers-1                                                   
         taucloud(l) = abcw*clwp(kte+1-l)+abice*ciwp(kte+1-l) & 
                      +abrn*plwp(kte+1-l)+absn*piwp(kte+1-l)                       
         if(taucloud(l).gt.0.01)cldfrc(kte+1-l)=1.                                
         cldfrac(l) = cldfrc(kte+1-l)                                             
 7000 continue                                                                   
      cldfrac(nlayers) = 0.0                                                     
      taucloud(nlayers) = 0.0                                                    

   end subroutine mm5atm

!---------------------------------------------------------------------------
      subroutine setcoef(kts,ktep1,                                        &
                         pavel,tavel,coldry,colh2o,colco2,colo3,           &
                         coln2o,colch4,colo2,co2mult,                      &
                         fac00,fac01,fac10,fac11,                          &
                         forfac,selffac,selffrac,                          &
                         jp,jt,jt1,indself,wkl,laytrop,layswtch,laylow     )
!---------------------------------------------------------------------------
      implicit none
!---------------------------------------------------------------------------
!  rrtm longwave radiative transfer model                                        
!  atmospheric and environmental research, inc., cambridge, ma                   
!                                                                                
!  original version:       e. j. mlawer, et al.                                  
!  revision for ncar ccm:  michael j. iacono; september, 1998                    
!                                                                                
!  for a given atmosphere, calculate the indices and fractions related to the    
!  pressure and temperature interpolations.  also calculate the values of the    
!  integrated planck functions for each band at the level and layer              
!  temperatures.                                                                 
!---------------------------------------------------------------------------

      integer, intent(in   ) ::          kts, ktep1

      real, dimension( 35,kts:ktep1),                    &
            intent(in   )        ::                  wkl

      integer, intent(inout) ::  laytrop,layswtch,laylow

      real, dimension( kts:ktep1 ), intent(in   ) ::      &
                                                   pavel, &
                                                   tavel, &
                                                  coldry

      real, dimension( kts:ktep1 ), intent(inout) ::      &
                                                  colh2o, &
                                                  colco2, &
                                                   colo3, &
                                                  coln2o, &
                                                  colch4, &
                                                   colo2, &
                                                 co2mult, &
                                                   fac00, &
                                                   fac01, &
                                                   fac10, &
                                                   fac11, &
                                                  forfac, &
                                                 selffac, &
                                                selffrac

      integer, dimension( kts:ktep1 ), intent(inout) ::   &
                                                      jp, &
                                                      jt, &
                                                     jt1, &
                                                 indself
! local 
     
      integer ::   lay, jp1 
      real    ::   stpfac, plog, fp, ft, ft1, waters, water, &
                   calefac, factor, co2reg, compfp, scalefac 

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      stpfac = 296./1013.                                                        
      
      laytrop = 0                                                                
      layswtch = 0                                                               
      laylow = 0                                                                 
      do 7000 lay = 1, nlayers                                                   
!        find the two reference pressures on either side of the                  
!        layer pressure.  store them in jp and jp1.  store in fp the             
!        fraction of the difference (in ln(pressure)) between these              
!        two values that the layer pressure lies.                                
         plog = log(pavel(lay))                                                  
         jp(lay) = int(36. - 5*(plog+0.04))                                      
         if (jp(lay) .lt. 1) then                                                
            jp(lay) = 1                                                          
         elseif (jp(lay) .gt. 58) then                                           
            jp(lay) = 58                                                         
         endif                                                                   
         jp1 = jp(lay) + 1                                                       
         fp = 5. * (preflog(jp(lay)) - plog)                                     
                                                                                 
!        determine, for each reference pressure (jp and jp1), which              
!        reference temperature (these are different for each                     
!        reference pressure) is nearest the layer temperature but does           
!        not exceed it.  store these indices in jt and jt1, resp.                
!        store in ft (resp. ft1) the fraction of the way between jt              
!        (jt1) and the next highest reference temperature that the               
!        layer temperature falls.                                                
         jt(lay) = int(3. + (tavel(lay)-tref(jp(lay)))/15.)                      
         if (jt(lay) .lt. 1) then                                                
            jt(lay) = 1                                                          
         elseif (jt(lay) .gt. 4) then                                            
            jt(lay) = 4                                                          
         endif                                                                   
         ft = ((tavel(lay)-tref(jp(lay)))/15.) - float(jt(lay)-3)                
         jt1(lay) = int(3. + (tavel(lay)-tref(jp1))/15.)                         
         if (jt1(lay) .lt. 1) then                                               
            jt1(lay) = 1                                                         
         elseif (jt1(lay) .gt. 4) then                                           
            jt1(lay) = 4                                                         
         endif                                                                   
         ft1 = ((tavel(lay)-tref(jp1))/15.) - float(jt1(lay)-3)                  
                                                                                 
         water = wkl(1,lay)/coldry(lay)                                          
         scalefac = pavel(lay) * stpfac / tavel(lay)                             
                                                                                 
!        if the pressure is less than ~100mb, perform a different                
!        set of species interpolations.                                          
         if (plog .le. 4.56) go to 5300                                          
         laytrop =  laytrop + 1                                                  
!        for one band, the "switch" occurs at ~300 mb.                           
! jd: changed from (plog .ge. 5.76) to avoid out-of-range                        
         if (plog .gt. 5.76) layswtch = layswtch + 1                             
         if (plog .ge. 6.62) laylow = laylow + 1                                 
!                                                                                
         forfac(lay) = scalefac / (1.+water)                                     
!        set up factors needed to separately include the water vapor             
!        self-continuum in the calculation of absorption coefficient.            
         selffac(lay) = water * forfac(lay)                                      
         factor = (tavel(lay)-188.0)/7.2                                         
         indself(lay) = min(9, max(1, int(factor)-7))                            
         selffrac(lay) = factor - float(indself(lay) + 7)                        
                                                                                 
!        calculate needed column amounts.                                        
         colh2o(lay) = 1.e-20 * wkl(1,lay)                                       
         colco2(lay) = 1.e-20 * wkl(2,lay)                                       
         colo3(lay) = 1.e-20 * wkl(3,lay)                                        
         coln2o(lay) = 1.e-20 * wkl(4,lay)                                       
         colch4(lay) = 1.e-20 * wkl(6,lay)                                       
         colo2(lay) = 1.e-20 * wkl(7,lay)                                        
         if (colco2(lay) .eq. 0.) colco2(lay) = 1.e-32 * coldry(lay)             
         if (coln2o(lay) .eq. 0.) coln2o(lay) = 1.e-32 * coldry(lay)             
         if (colch4(lay) .eq. 0.) colch4(lay) = 1.e-32 * coldry(lay)             
!        using e = 1334.2 cm-1.                                                  
         co2reg = 3.55e-24 * coldry(lay)                                         
         co2mult(lay)= (colco2(lay) - co2reg) *    & 
              272.63*exp(-1919.4/tavel(lay))/(8.7604e-4*tavel(lay))              
         go to 5400                                                              
                                                                                 
!        above laytrop.                                                          
 5300    continue                                                                
                                                                                 
         forfac(lay) = scalefac / (1.+water)                                     
!        calculate needed column amounts.                                        
         colh2o(lay) = 1.e-20 * wkl(1,lay)                                       
         colco2(lay) = 1.e-20 * wkl(2,lay)                                       
         colo3(lay) = 1.e-20 * wkl(3,lay)                                        
         coln2o(lay) = 1.e-20 * wkl(4,lay)                                       
         colch4(lay) = 1.e-20 * wkl(6,lay)                                       
         colo2(lay) = 1.e-20 * wkl(7,lay)                                        
         if (colco2(lay) .eq. 0.) colco2(lay) = 1.e-32 * coldry(lay)             
         if (coln2o(lay) .eq. 0.) coln2o(lay) = 1.e-32 * coldry(lay)             
         if (colch4(lay) .eq. 0.) colch4(lay) = 1.e-32 * coldry(lay)             
         co2reg = 3.55e-24 * coldry(lay)                                         
         co2mult(lay)= (colco2(lay) - co2reg) *   & 
              272.63*exp(-1919.4/tavel(lay))/(8.7604e-4*tavel(lay))              
 5400    continue                                                                
                                                                                 
!        we have now isolated the layer ln pressure and temperature,             
!        between two reference pressures and two reference temperatures          
!        (for each reference pressure).  we multiply the pressure                
!        fraction fp with the appropriate temperature fractions to get           
!        the factors that will be needed for the interpolation that yields       
!        the optical depths (performed in routines taugbn for band n).           
                                                                                 
         compfp = 1. - fp                                                        
         fac10(lay) = compfp * ft                                                
         fac00(lay) = compfp * (1. - ft)                                         
         fac11(lay) = fp * ft1                                                   
         fac01(lay) = fp * (1. - ft1)                                            
                                                                                 
 7000 continue                                                                   
                                                                                 
!        set laylow for profiles with surface pressure less than 750mb.          
         if (laylow.eq.0) laylow=1                                               
!        sometimes round-off gives wrong layswtch therefore check here (jd)
         if (jp(layswtch+1).le.6) then
           layswtch=layswtch+1
         endif

   end subroutine setcoef

!-------------------------------------------------------------------------------
!*                                                                             * 
!*                  optical depths developed for the                           * 
!*                                                                             * 
!*                rapid radiative transfer model (rrtm)                        * 
!*                                                                             * 
!*                                                                             * 
!*            atmospheric and environmental research, inc.                     * 
!*                        840 memorial drive                                   * 
!*                        cambridge, ma 02139                                  * 
!*                                                                             * 
!*                                                                             * 
!*                           eli j. mlawer                                     * 
!*                         steven j. taubman                                   * 
!*                         shepard a. clough                                   * 
!*                                                                             * 
!*                                                                             * 
!*                                                                             * 
!*                                                                             * 
!*                       email:  mlawer@aer.com                                * 
!*                                                                             * 
!*        the authors wish to acknowledge the contributions of the             * 
!*        following people:  patrick d. brown, michael j. iacono,              * 
!*        ronald e. farren, luke chen, robert bergstrom.                       * 
!*                                                                             * 
!-------------------------------------------------------------------------------
!*                                                                             * 
!*  revision for ncar ccm:  michael j. iacono; september, 1998                 * 
!*                                                                             * 
!*     taumol                                                                  * 
!*                                                                             * 
!*     this file contains the subroutines taugbn (where n goes from            * 
!*     1 to 16).  taugbn calculates the optical depths and planck fractions    * 
!*     per g-value and layer for band n.                                       * 
!*                                                                             * 
!*  output:  optical depths (unitless)                                         * 
!*           fractions needed to compute planck functions at every layer       * 
!*               and g-value                                                   * 
!*                                                                             * 
!*     common /taugcom/  taug(mxlay,mg)                                        * 
!*     common /plankg/   fracs(mxlay,mg)                                       * 
!*                                                                             * 
!*  input                                                                      * 
!*                                                                             * 
!*     common /features/ ng(nbands),nspa(nbands),nspb(nbands)                  * 
!*     common /precise/  oneminus                                              * 
!*     common /profile/  nlayers,pavel(mxlay),tavel(mxlay),                    * 
!*    &                  pz(0:mxlay),tz(0:mxlay)                               * 
!*     common /profdata/ laytrop,layswtch,laylow,                              * 
!*    &                  colh2o(mxlay),colco2(mxlay),                          * 
!*    &                  colo3(mxlay),coln2o(mxlay),colch4(mxlay),             * 
!*    &                  colo2(mxlay),co2mult(mxlay)                           * 
!*     common /intfac/   fac00(mxlay),fac01(mxlay),                            * 
!*    &                  fac10(mxlay),fac11(mxlay)                             * 
!*     common /intind/   jp(mxlay),jt(mxlay),jt1(mxlay)                        * 
!*     common /self/     selffac(mxlay), selffrac(mxlay), indself(mxlay)       * 
!*                                                                             * 
!*     description:                                                            * 
!*     ng(iband) - number of g-values in band iband                            * 
!*     nspa(iband) - for the lower atmosphere, the number of reference         * 
!*                   atmospheres that are stored for band iband per            * 
!*                   pressure level and temperature.  each of these            * 
!*                   atmospheres has different relative amounts of the         * 
!*                   key species for the band (i.e. different binary           * 
!*                   species parameters).                                      * 
!*     nspb(iband) - same for upper atmosphere                                 * 
!*     oneminus - since problems are caused in some cases by interpolation     * 
!*                parameters equal to or greater than 1, for these cases       * 
!*                these parameters are set to this value, slightly < 1.        * 
!*     pavel - layer pressures (mb)                                            * 
!*     tavel - layer temperatures (degrees k)                                  * 
!*     pz - level pressures (mb)                                               * 
!*     tz - level temperatures (degrees k)                                     * 
!*     laytrop - layer at which switch is made from one combination of         * 
!*               key species to another                                        * 
!*     colh2o, colco2, colo3, coln2o, colch4 - column amounts of water         * 
!*               vapor,carbon dioxide, ozone, nitrous ozide, methane,          * 
!*               respectively (molecules/cm**2)                                * 
!*     co2mult - for bands in which carbon dioxide is implemented as a         * 
!*               trace species, this is the factor used to multiply the        * 
!*               band's average co2 absorption coefficient to get the added    * 
!*               contribution to the optical depth relative to 355 ppm.        * 
!*     facij(lay) - for layer lay, these are factors that are needed to        * 
!*                  compute the interpolation factors that multiply the        * 
!*                  appropriate reference k-values.  a value of 0 (1) for      * 
!*                  i,j indicates that the corresponding factor multiplies     * 
!*                  reference k-value for the lower (higher) of the two        * 
!*                  appropriate temperatures, and altitudes, respectively.     * 
!*     jp - the index of the lower (in altitude) of the two appropriate        * 
!*          reference pressure levels needed for interpolation                 * 
!*     jt, jt1 - the indices of the lower of the two appropriate reference     * 
!*               temperatures needed for interpolation (for pressure           * 
!*               levels jp and jp+1, respectively)                             * 
!*     selffac - scale factor needed to water vapor self-continuum, equals     * 
!*               (water vapor density)/(atmospheric density at 296k and        * 
!*               1013 mb)                                                      * 
!*     selffrac - factor needed for temperature interpolation of reference     * 
!*                water vapor self-continuum data                              * 
!*     indself - index of the lower of the two appropriate reference           * 
!*               temperatures needed for the self-continuum interpolation      * 
!*                                                                             * 
!*  data input                                                                 * 
!*     common /kn/ ka(nspa(n),5,13,mg), kb(nspb(n),5,13:59,mg), selfref(10,mg) * 
!*        (note:  n is the band number)                                        * 
!*                                                                             * 
!*     description:                                                            * 
!*     ka - k-values for low reference atmospheres (no water vapor             * 
!*          self-continuum) (units: cm**2/molecule)                            * 
!*     kb - k-values for high reference atmospheres (all sources)              * 
!*          (units: cm**2/molecule)                                            * 
!*     selfref - k-values for water vapor self-continuum for reference         * 
!*               atmospheres (used below laytrop)                              * 
!*               (units: cm**2/molecule)                                       * 
!*                                                                             * 
!*     dimension absa(65*nspa(n),mg), absb(235*nspb(n),mg)                     * 
!*     equivalence (ka,absa),(kb,absb)                                         * 
!*                                                                             * 
!******************************************************************************* 
                                                                                 
!---------------------------------------------------------------------------    
      subroutine taugb1(kts,ktep1,colh2o,fac00,fac01,fac10,fac11,          &
                        forfac,selffac,selffrac,jp,jt,jt1,indself,         &
                        pfrac,taug,laytrop                                 )
!---------------------------------------------------------------------------    
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                    forfac, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

!     written by eli j. mlawer, atmospheric & environmental research.            
!     revised by michael j. iacono, atmospheric & environmental research.        
                                                                                 
!     band 1:  10-250 cm-1 (low - h2o; high - h2o)                               
                                                                                 
! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
!     compute the optical depth by interpolating in ln(pressure) and             
!     temperature.  below laytrop, the water vapor self-continuum                
!     is interpolated (in temperature) separately.                               
      do 2500 lay = 1, laytrop                                                   
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(1) + 1                          
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(1) + 1                             
         inds = indself(lay)                                                     
         do 2000 ig = 1, ng1                                                     
            taug(ig,lay) = colh2o(lay) *                       & 
                (fac00(lay) * absa1(ind0,ig) +                  &                 
                 fac10(lay) * absa1(ind0+1,ig) +                &                 
                 fac01(lay) * absa1(ind1,ig) +                  &                 
                 fac11(lay) * absa1(ind1+1,ig) +                &                 
                 selffac(lay) * (selfrefc1(inds,ig) +            &                 
                 selffrac(lay) *                               &                 
                 (selfrefc1(inds+1,ig) - selfrefc1(inds,ig))) +    &                 
                 forfac(lay) * forrefc1(ig))                                       
            pfrac(ig,lay) = fracrefac1(ig)                                         
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(1) + 1                         
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(1) + 1                        
         do 3000 ig = 1, ng1                                                     
            taug(ig,lay) = colh2o(lay) *                      &
                (fac00(lay) * absb1(ind0,ig) +                 &                  
                 fac10(lay) * absb1(ind0+1,ig) +               &                  
                 fac01(lay) * absb1(ind1,ig) +                 &                  
                 fac11(lay) * absb1(ind1+1,ig) +               &                  
                 forfac(lay) * forrefc1(ig))                                       
            pfrac(ig,lay) = fracrefbc1(ig)                                         
 3000    continue                                                                
 3500 continue                                                                   
     
      end subroutine taugb1                        
                                                                                 
!----------------------------------------------------------------------------    
      subroutine taugb2(kts,ktep1,coldry,colh2o,fac00,fac01,fac10,fac11,    &
                        forfac,selffac,selffrac,jp,jt,jt1,indself,          &
                        pfrac,taug,laytrop                                  )
!----------------------------------------------------------------------------    
                                                                                 
!     band 2:  250-500 cm-1 (low - h2o; high - h2o)                              
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, parameter :: ngs1=8                                       

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    coldry, &   
                                                    colh2o, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                    forfac, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      dimension fc00(kts:ktep1),fc01(kts:ktep1),fc10(kts:ktep1),fc11(kts:ktep1)                  
      dimension refparam(13)                                                     
                                                                                 
!     these are the mixing ratios for h2o for a mls atmosphere at the            
!     13 rrtm reference pressure levels:  1.8759999e-02, 1.2223309e-02,          
!     5.8908667e-03, 2.7675382e-03, 1.4065107e-03, 7.5969833e-04,                
!     3.8875898e-04, 1.6542293e-04, 3.7189537e-05, 7.4764857e-06,                
!     4.3081886e-06, 3.3319423e-06, 3.2039343e-06/                               
                                                                                 
!     the following are parameters related to the reference water vapor          
!     mixing ratios by refparam(i) = refh2o(i) / (.002+refh2o(i)).               
!     these parameters are used for the planck function interpolation.           
      data refparam/  &                                                          
        0.903661, 0.859386, 0.746542, 0.580496, 0.412889, 0.275283, & 
        0.162745, 7.63929e-02, 1.82553e-02, 3.72432e-03,            &            
        2.14946e-03, 1.66320e-03, 1.59940e-03/                                   
                                                                                 
!     compute the optical depth by interpolating in ln(pressure) and             
!     temperature.  below laytrop, the water vapor self-continuum is             
!     interpolated (in temperature) separately.                                  
      do 2500 lay = 1, laytrop                                                   
         water = 1.e20 * colh2o(lay) / coldry(lay)                               
         h2oparam = water/(water +.002)                                          
         do 1800 ifrac = 2, 12                                                   
            if (h2oparam .ge. refparam(ifrac)) go to 1900                        
 1800    continue                                                                
 1900    continue                                                                
         fracint = (h2oparam-refparam(ifrac))/    & 
              (refparam(ifrac-1)-refparam(ifrac))                                
                                                                                 
         fp = fac11(lay) + fac01(lay)                                            
         ifp = 2.e2*fp+0.5                                                       
         if (ifp.le.0) ifp = 0                                                   
         fc00(lay) = fac00(lay) * corr2(ifp)                                     
         fc10(lay) = fac10(lay) * corr2(ifp)                                     
         fc01(lay) = fac01(lay) * corr1(ifp)                                     
         fc11(lay) = fac11(lay) * corr1(ifp)                                     
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(2) + 1                          
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(2) + 1                             
         inds = indself(lay)                                                     
         do 2000 ig = 1, ng2                                                     
            taug(ngs1+ig,lay) = colh2o(lay) *                   &                
                (fc00(lay) * absa2(ind0,ig) +                    &                
                 fc10(lay) * absa2(ind0+1,ig) +                  &                
                 fc01(lay) * absa2(ind1,ig) +                    &                
                 fc11(lay) * absa2(ind1+1,ig) +                  &                
                 selffac(lay) * (selfrefc2(inds,ig) +             &                
                 selffrac(lay) *                                &                
                 (selfrefc2(inds+1,ig) - selfrefc2(inds,ig))) +     &                
                 forfac(lay) * forrefc2(ig))                                       
            pfrac(ngs1+ig,lay) = fracrefac2(ig,ifrac) + fracint * &
                 (fracrefac2(ig,ifrac-1)-fracrefac2(ig,ifrac))                       
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         fp = fac11(lay) + fac01(lay)                                            
         ifp = 2.e2*fp+0.5                                                       
         if (ifp.le.0) ifp = 0                                                   
         fc00(lay) = fac00(lay) * corr2(ifp)                                     
         fc10(lay) = fac10(lay) * corr2(ifp)                                     
         fc01(lay) = fac01(lay) * corr1(ifp)                                     
         fc11(lay) = fac11(lay) * corr1(ifp)                                     
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(2) + 1                         
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(2) + 1                        
         do 3000 ig = 1, ng2                                                     
            taug(ngs1+ig,lay) = colh2o(lay) *                  & 
                (fc00(lay) * absb2(ind0,ig) +                   &                  
                 fc10(lay) * absb2(ind0+1,ig) +                 &                  
                 fc01(lay) * absb2(ind1,ig) +                   &                  
                 fc11(lay) * absb2(ind1+1,ig) +                 &                  
                 forfac(lay) * forrefc2(ig))                                       
            pfrac(ngs1+ig,lay) = fracrefbc2(ig)                                    
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb2
                                                                                 
!-----------------------------------------------------------------------------    
      subroutine taugb3(kts,ktep1,colh2o,colco2,coln2o,fac00,fac01,fac10,    &
                        fac11,forfac,selffac,selffrac,jp,jt,jt1,indself,     &
                        pfrac,taug,laytrop                                   )
!-----------------------------------------------------------------------------    
                                                                                 
!     band 3:  500-630 cm-1 (low - h2o,co2; high - h2o,co2)                      
                                                                                 
      integer, parameter :: ngs2=22                                      
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                    colco2, &
                                                    coln2o, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                    forfac, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      dimension h2oref(59),co2ref(59), etaref(10)                                
      real n2omult,n2oref(59)                                              
                                                                                 
      data etaref/  &                                                             
           0.,0.125,0.25,0.375,0.5,0.625,0.75,0.875,0.9875,1.0/                  
      data h2oref/  &                                                             
           1.87599e-02,1.22233e-02,5.89086e-03,2.76753e-03,1.40651e-03, &
           7.59698e-04,3.88758e-04,1.65422e-04,3.71895e-05,7.47648e-06, &        
           4.30818e-06,3.33194e-06,3.20393e-06,3.16186e-06,3.25235e-06, &        
           3.42258e-06,3.62884e-06,3.91482e-06,4.14875e-06,4.30810e-06, &        
           4.44204e-06,4.57783e-06,4.70865e-06,4.79432e-06,4.86971e-06, &        
           4.92603e-06,4.96688e-06,4.99628e-06,5.05266e-06,5.12658e-06, &        
           5.25028e-06,5.35708e-06,5.45085e-06,5.48304e-06,5.50000e-06, &        
           5.50000e-06,5.45359e-06,5.40468e-06,5.35576e-06,5.25327e-06, &        
           5.14362e-06,5.03396e-06,4.87662e-06,4.69787e-06,4.51911e-06, &        
           4.33600e-06,4.14416e-06,3.95232e-06,3.76048e-06,3.57217e-06, &        
           3.38549e-06,3.19881e-06,3.01212e-06,2.82621e-06,2.64068e-06, &        
           2.45515e-06,2.26962e-06,2.08659e-06,1.93029e-06/                      
      data n2oref/  & 
           3.20000e-07,3.20000e-07,3.20000e-07,3.20000e-07,3.20000e-07, &
           3.19652e-07,3.15324e-07,3.03830e-07,2.94221e-07,2.84953e-07, &        
           2.76714e-07,2.64709e-07,2.42847e-07,2.09547e-07,1.71945e-07, &        
           1.37491e-07,1.13319e-07,1.00354e-07,9.12812e-08,8.54633e-08, &        
           8.03631e-08,7.33718e-08,6.59754e-08,5.60386e-08,4.70901e-08, &        
           3.99774e-08,3.29786e-08,2.60642e-08,2.10663e-08,1.65918e-08, &        
           1.30167e-08,1.00900e-08,7.62490e-09,6.11592e-09,4.66725e-09, &        
           3.28574e-09,2.84838e-09,2.46198e-09,2.07557e-09,1.85507e-09, &        
           1.65675e-09,1.45843e-09,1.31948e-09,1.20716e-09,1.09485e-09, &        
           9.97803e-10,9.31260e-10,8.64721e-10,7.98181e-10,7.51380e-10, &        
           7.13670e-10,6.75960e-10,6.38250e-10,6.09811e-10,5.85998e-10, &        
           5.62185e-10,5.38371e-10,5.15183e-10,4.98660e-10/                      
      data co2ref/ &                                                             
           53*3.55e-04, 3.5470873e-04, 3.5427220e-04, 3.5383567e-04,    &
           3.5339911e-04, 3.5282588e-04, 3.5079606e-04/                          
                        
      strrat = 1.19268                                                           
                                                                                 
!     compute the optical depth by interpolating in ln(pressure),                
!     temperature, and appropriate species.  below laytrop, the water            
!     vapor self-continuum is interpolated (in temperature) separately.          

      do 2500 lay = 1, laytrop                                                   
         speccomb = colh2o(lay) + strrat*colco2(lay)                             
         specparm = colh2o(lay)/speccomb                                         
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 8.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         if (js .eq. 8) then                                                     
            if (fs .ge. 0.9) then                                                
               js = 9                                                            
               fs = 10. * (fs - 0.9)                                             
            else                                                                 
               fs = fs/0.9                                                       
            endif                                                                
         endif                                                                   
         ns = js + int(fs + 0.5)                                                 
         fp = fac01(lay) + fac11(lay)                                            
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(3) + js                         
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(3) + js                            
         inds = indself(lay)                                                     
         colref1 = n2oref(jp(lay))                                               
         colref2 = n2oref(jp(lay)+1)                                             
         if (ns .eq. 10) then                                                    
            wcomb1 = h2oref(jp(lay))                                             
            wcomb2 = h2oref(jp(lay)+1)                                           
         else                                                                    
            wcomb1 = strrat * co2ref(jp(lay))/(1.-etaref(ns))                    
            wcomb2 = strrat * co2ref(jp(lay)+1)/(1.-etaref(ns))                  
         endif                                                                   
         ratio = (colref1/wcomb1)+fp*((colref2/wcomb2)-(colref1/wcomb1))         
         currn2o = speccomb * ratio                                              
         n2omult = coln2o(lay) - currn2o                                         
!!dir$ vector                                                                     
         do 2000 ig = 1, ng3                                                     
            taug(ngs2+ig,lay) = speccomb *                     & 
                (fac000 * absa3(ind0,ig) +                      &                 
                 fac100 * absa3(ind0+1,ig) +                    &                 
                 fac010 * absa3(ind0+10,ig) +                   &                 
                 fac110 * absa3(ind0+11,ig) +                   &                 
                 fac001 * absa3(ind1,ig) +                      &                 
                 fac101 * absa3(ind1+1,ig) +                    &                 
                 fac011 * absa3(ind1+10,ig) +                   &                 
                 fac111 * absa3(ind1+11,ig)) +                  &                 
                 colh2o(lay) *                                 &                 
                 (selffac(lay) * (selfrefc3(inds,ig) +           &                 
                 selffrac(lay) *                               &                 
                 (selfrefc3(inds+1,ig) - selfrefc3(inds,ig))) +    &                 
                 forfac(lay) * forrefc3(ig))                     &                 
                 + n2omult * absn2oac3(ig)                                         
            pfrac(ngs2+ig,lay) = fracrefac3(ig,js) + fs *        & 
                 (fracrefac3(ig,js+1) - fracrefac3(ig,js))                           
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
!!dir$ novector                                                                   
      do 3500 lay = laytrop+1, nlayers                                           
         speccomb = colh2o(lay) + strrat*colco2(lay)                             
         specparm = colh2o(lay)/speccomb                                         
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 4.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         ns = js + int(fs + 0.5)                                                 
         fp = fac01(lay) + fac11(lay)                                            
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(3) + js                        
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(3) + js                       
         colref1 = n2oref(jp(lay))                                               
         colref2 = n2oref(jp(lay)+1)                                             
         if (ns .eq. 5) then                                                     
            wcomb1 = h2oref(jp(lay))                                             
            wcomb2 = h2oref(jp(lay)+1)                                           
         else                                                                    
            wcomb1 = strrat * co2ref(jp(lay))/(1.-etaref(ns))                    
            wcomb2 = strrat * co2ref(jp(lay)+1)/(1.-etaref(ns))                  
         endif                                                                   
         ratio = (colref1/wcomb1)+fp*((colref2/wcomb2)-(colref1/wcomb1))         
         currn2o = speccomb * ratio                                              
         n2omult = coln2o(lay) - currn2o                                         
!!dir$ vector                                                                     
         do 3000 ig = 1, ng3                                                     
            taug(ngs2+ig,lay) = speccomb *                 &
                (fac000 * absb3(ind0,ig) +                  &                     
                 fac100 * absb3(ind0+1,ig) +                &                     
                 fac010 * absb3(ind0+5,ig) +                &                     
                 fac110 * absb3(ind0+6,ig) +                &                     
                 fac001 * absb3(ind1,ig) +                  &                     
                 fac101 * absb3(ind1+1,ig) +                &                     
                 fac011 * absb3(ind1+5,ig) +                &                     
                 fac111 * absb3(ind1+6,ig)) +               &                     
                 colh2o(lay) * forfac(lay) * forrefc3(ig)    &                     
                 + n2omult * absn2obc3(ig)                                         
            pfrac(ngs2+ig,lay) = fracrefbc3(ig,js) + fs *    & 
                 (fracrefbc3(ig,js+1) - fracrefbc3(ig,js))                           
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb3
                                                                                 
!----------------------------------------------------------------------------    
      subroutine taugb4(kts,ktep1,colh2o,colco2,colo3,fac00,fac01,fac10,    &
                        fac11,selffac,selffrac,jp,jt,jt1,indself,           &
                        pfrac,taug,laytrop                                  )
!----------------------------------------------------------------------------    
                                                                                 
!     band 4:  630-700 cm-1 (low - h2o,co2; high - o3,co2)                       
                                                                                 
      integer, parameter :: ngs3=38                                      
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                    colco2, &
                                                     colo3, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      strrat1 = 850.577                                                          
      strrat2 = 35.7416                                                          
                                                                                 
!     compute the optical depth by interpolating in ln(pressure),                
!     temperature, and appropriate species.  below laytrop, the water            
!     vapor self-continuum is interpolated (in temperature) separately.          
!!dir$ novector                                                                   
      do 2500 lay = 1, laytrop                                                   
         speccomb = colh2o(lay) + strrat1*colco2(lay)                            
         specparm = colh2o(lay)/speccomb                                         
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 8.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(4) + js                         
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(4) + js                            
         inds = indself(lay)                                                     
!!dir$ vector                                                                     
         do 2000 ig = 1, ng4                                                     
            taug(ngs3+ig,lay) = speccomb *                    &
                (fac000 * absa4(ind0,ig) +                     &                  
                 fac100 * absa4(ind0+1,ig) +                   &                  
                 fac010 * absa4(ind0+9,ig) +                   &                  
                 fac110 * absa4(ind0+10,ig) +                  &                  
                 fac001 * absa4(ind1,ig) +                     &                  
                 fac101 * absa4(ind1+1,ig) +                   &                  
                 fac011 * absa4(ind1+9,ig) +                   &                  
                 fac111 * absa4(ind1+10,ig)) +                 &                  
                 colh2o(lay) *                                &                  
                 selffac(lay) * (selfrefc4(inds,ig) +           &                  
                 selffrac(lay) *                              &                  
                 (selfrefc4(inds+1,ig) - selfrefc4(inds,ig)))                        
            pfrac(ngs3+ig,lay) = fracrefac4(ig,js) + fs *       &                  
                 (fracrefac4(ig,js+1) - fracrefac4(ig,js))                           
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
!!dir$ novector                                                                   
      do 3500 lay = laytrop+1, nlayers                                           
         speccomb = colo3(lay) + strrat2*colco2(lay)                             
         specparm = colo3(lay)/speccomb                                          
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 4.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         if (js .gt. 1) then                                                     
            js = js + 1                                                          
         elseif (fs .ge. 0.0024) then                                            
            js = 2                                                               
            fs = (fs - 0.0024)/0.9976                                            
         else                                                                    
            js = 1                                                               
            fs = fs/0.0024                                                       
         endif                                                                   
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(4) + js                        
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(4) + js                       
!!dir$ vector                                                                     
         do 3000 ig = 1, ng4                                                     
            taug(ngs3+ig,lay) = speccomb *              &                        
                (fac000 * absb4(ind0,ig) +               &                        
                 fac100 * absb4(ind0+1,ig) +             &                        
                 fac010 * absb4(ind0+6,ig) +             &                        
                 fac110 * absb4(ind0+7,ig) +             &                        
                 fac001 * absb4(ind1,ig) +               &                        
                 fac101 * absb4(ind1+1,ig) +             &                        
                 fac011 * absb4(ind1+6,ig) +             &                        
                 fac111 * absb4(ind1+7,ig))                                       
            pfrac(ngs3+ig,lay) = fracrefbc4(ig,js) + fs * &
                 (fracrefbc4(ig,js+1) - fracrefbc4(ig,js))                           
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb4
                                                                                 
!----------------------------------------------------------------------------   
      subroutine taugb5(kts,ktep1,colh2o,colco2,colo3,fac00,fac01,fac10,    &
                        fac11,selffac,selffrac,jp,jt,jt1,indself,wx,        &
                        pfrac,taug,laytrop                                  )
!----------------------------------------------------------------------------   
                                                                                 
!     band 5:  700-820 cm-1 (low - h2o,co2; high - o3,co2)                       
                                                                                 
      integer, parameter :: ngs4=52                                      
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( maxxsec,kts:ktep1 ),                 &
            intent(in   )        ::                     wx

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                    colco2, &
                                                     colo3, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      strrat1 = 90.4894                                                          
      strrat2 = 0.900502                                                         
                                                                                 
!     compute the optical depth by interpolating in ln(pressure),                
!     temperature, and appropriate species.  below laytrop, the water            
!     vapor self-continuum is interpolated (in temperature) separately.          
!!dir$ novector                                                                   
      do 2500 lay = 1, laytrop                                                   
         speccomb = colh2o(lay) + strrat1*colco2(lay)                            
         specparm = colh2o(lay)/speccomb                                         
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 8.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(5) + js                         
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(5) + js                            
         inds = indself(lay)                                                     
!!dir$ vector                                                                     
         do 2000 ig = 1, ng5                                                     
            taug(ngs4+ig,lay) = speccomb *                    &
                (fac000 * absa5(ind0,ig) +                     &                  
                 fac100 * absa5(ind0+1,ig) +                   &                  
                 fac010 * absa5(ind0+9,ig) +                   &                  
                 fac110 * absa5(ind0+10,ig) +                  &                  
                 fac001 * absa5(ind1,ig) +                     &                  
                 fac101 * absa5(ind1+1,ig) +                   &                  
                 fac011 * absa5(ind1+9,ig) +                   &                  
                 fac111 * absa5(ind1+10,ig)) +                 &                  
                 colh2o(lay) *                                &                  
                 selffac(lay) * (selfrefc5(inds,ig) +           &                  
                 selffrac(lay) *                              &                  
                 (selfrefc5(inds+1,ig) - selfrefc5(inds,ig)))     &                  
                 + wx(1,lay) * ccl4c5(ig)                                          
            pfrac(ngs4+ig,lay) = fracrefac5(ig,js) + fs *       &                  
                 (fracrefac5(ig,js+1) - fracrefac5(ig,js))                           
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
!!dir$ novector                                                                   
      do 3500 lay = laytrop+1, nlayers                                           
         speccomb = colo3(lay) + strrat2*colco2(lay)                             
         specparm = colo3(lay)/speccomb                                          
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 4.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(5) + js                        
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(5) + js                       
!!dir$ vector                                                                     
         do 3000 ig = 1, ng5                                                     
            taug(ngs4+ig,lay) = speccomb *          &
                (fac000 * absb5(ind0,ig) +           &                            
                 fac100 * absb5(ind0+1,ig) +         &                            
                 fac010 * absb5(ind0+5,ig) +         &                            
                 fac110 * absb5(ind0+6,ig) +         &                            
                 fac001 * absb5(ind1,ig) +           &                            
                 fac101 * absb5(ind1+1,ig) +         &                            
                 fac011 * absb5(ind1+5,ig) +         &                            
                 fac111 * absb5(ind1+6,ig))          &                            
                 + wx(1,lay) * ccl4c5(ig)                                          
            pfrac(ngs4+ig,lay) = fracrefbc5(ig,js) + fs *  &                       
                 (fracrefbc5(ig,js+1) - fracrefbc5(ig,js))                           
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb5
                                                                                 
!-----------------------------------------------------------------------------    
      subroutine taugb6(kts,ktep1,colh2o,co2mult,fac00,fac01,fac10,fac11,    &
                        selffac,selffrac,jp,jt,jt1,indself,wx,pfrac,taug,    &
                        laytrop                                              )
!-----------------------------------------------------------------------------    
                                                                                 
!     band 6:  820-980 cm-1 (low - h2o; high - nothing)                          
                                                                                 
      integer, parameter :: ngs5=68                                       
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( maxxsec,kts:ktep1 ),                 &
            intent(in   )        ::                     wx

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                   co2mult, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
!     compute the optical depth by interpolating in ln(pressure) and             
!     temperature. the water vapor self-continuum is interpolated                
!     (in temperature) separately.                                               
      do 2500 lay = 1, laytrop                                                   
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(6) + 1                          
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(6) + 1                             
         inds = indself(lay)                                                     
         do 2000 ig = 1, ng6                                                     
            taug(ngs5+ig,lay) = colh2o(lay) *              & 
                (fac00(lay) * absa6(ind0,ig) +              &                     
                 fac10(lay) * absa6(ind0+1,ig) +            &                     
                 fac01(lay) * absa6(ind1,ig) +              &                     
                 fac11(lay) * absa6(ind1+1,ig) +            &                     
                 selffac(lay) * (selfrefc6(inds,ig) +        &                     
                 selffrac(lay)*                            &                     
                 (selfrefc6(inds+1,ig)-selfrefc6(inds,ig))))   &                     
                 + wx(2,lay) * cfc11adjc6(ig)                &                     
                 + wx(3,lay) * cfc12c6(ig)                   &                     
                 + co2mult(lay) * absco2c6(ig)                                     
            pfrac(ngs5+ig,lay) = fracrefac6(ig)                                    
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
!     nothing important goes on above laytrop in this band.                      
      do 3500 lay = laytrop+1, nlayers                                           
         do 3000 ig = 1, ng6                                                     
            taug(ngs5+ig,lay) = 0.0                        & 
                 + wx(2,lay) * cfc11adjc6(ig)                &                     
                 + wx(3,lay) * cfc12c6(ig)                                         
            pfrac(ngs5+ig,lay) = fracrefac6(ig)                                    
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb6
                                                                                 
!-----------------------------------------------------------------------------    
      subroutine taugb7(kts,ktep1,colh2o,colo3,co2mult,fac00,fac01,fac10,    &   
                        fac11,selffac,selffrac,jp,jt,jt1,indself,            &
                        pfrac,taug,laytrop                                   )
!-----------------------------------------------------------------------------    
                                                                                 
!     band 7:  980-1080 cm-1 (low - h2o,o3; high - o3)                           
                                                                                 
      integer, parameter :: ngs6=76                                      
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                     colo3, &
                                                   co2mult, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      strrat1 = 8.21104e4                                                        
                                                                                 
!     compute the optical depth by interpolating in ln(pressure),                
!     temperature, and appropriate species.  below laytrop, the water            
!     vapor self-continuum is interpolated (in temperature) separately.          
!!dir$ novector                                                                   
      do 2500 lay = 1, laytrop                                                   
         speccomb = colh2o(lay) + strrat1*colo3(lay)                             
         specparm = colh2o(lay)/speccomb                                         
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 8.*specparm                                                  
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(7) + js                         
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(7) + js                            
         inds = indself(lay)                                                     
!!dir$ vector                                                                     
         do 2000 ig = 1, ng7                                                     
            taug(ngs6+ig,lay) = speccomb *                   & 
                (fac000 * absa7(ind0,ig) +                   &                    
                 fac100 * absa7(ind0+1,ig) +                 &                    
                 fac010 * absa7(ind0+9,ig) +                 &                    
                 fac110 * absa7(ind0+10,ig) +                &                    
                 fac001 * absa7(ind1,ig) +                   &                    
                 fac101 * absa7(ind1+1,ig) +                 &                    
                 fac011 * absa7(ind1+9,ig) +                 &                    
                 fac111 * absa7(ind1+10,ig)) +               &                    
                 colh2o(lay) *                               &                    
                 selffac(lay) * (selfrefc7(inds,ig) +        &                    
                 selffrac(lay) *                             &                    
                 (selfrefc7(inds+1,ig) - selfrefc7(inds,ig)))&
                 + co2mult(lay) * absco2c7(ig)                                     
         pfrac(ngs6+ig,lay) = fracrefac7(ig,js) + fs *        &                    
                 (fracrefac7(ig,js+1) - fracrefac7(ig,js))                           
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(7) + 1                         
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(7) + 1                        
         do 3000 ig = 1, ng7                                                     
            taug(ngs6+ig,lay) = colo3(lay) *                & 
                (fac00(lay) * absb7(ind0,ig) +               &                    
                 fac10(lay) * absb7(ind0+1,ig) +             &                    
                 fac01(lay) * absb7(ind1,ig) +               &                    
                 fac11(lay) * absb7(ind1+1,ig))              &                    
                 + co2mult(lay) * absco2c7(ig)                                     
            pfrac(ngs6+ig,lay) = fracrefbc7(ig)                                    
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb7
                                                                                 
!----------------------------------------------------------------------------    
      subroutine taugb8(kts,ktep1,colh2o,colo3,coln2o,co2mult,              &
                        fac00,fac01,fac10,fac11,selffac,selffrac,           &
                        jp,jt,jt1,indself,wx,pfrac,taug,layswtch            )
!----------------------------------------------------------------------------    
                                                                                 
!     band 8:  1080-1180 cm-1 (low (i.e.>~300mb) - h2o; high - o3)               
                                                                                 
      integer, parameter :: ngs7=88                                       
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      :: layswtch

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( maxxsec,kts:ktep1 ),                 &
            intent(in   )        ::                     wx

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                     colo3, &
                                                    coln2o, &
                                                   co2mult, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      dimension h2oref(59),o3ref(59)                                             
      real n2omult,n2oref(59)                                              
                                                                                 
      data h2oref/ &                                                             
           1.87599e-02,1.22233e-02,5.89086e-03,2.76753e-03,1.40651e-03, &        
           7.59698e-04,3.88758e-04,1.65422e-04,3.71895e-05,7.47648e-06, &        
           4.30818e-06,3.33194e-06,3.20393e-06,3.16186e-06,3.25235e-06, &        
           3.42258e-06,3.62884e-06,3.91482e-06,4.14875e-06,4.30810e-06, &        
           4.44204e-06,4.57783e-06,4.70865e-06,4.79432e-06,4.86971e-06, &        
           4.92603e-06,4.96688e-06,4.99628e-06,5.05266e-06,5.12658e-06, &        
           5.25028e-06,5.35708e-06,5.45085e-06,5.48304e-06,5.50000e-06, &        
           5.50000e-06,5.45359e-06,5.40468e-06,5.35576e-06,5.25327e-06, &        
           5.14362e-06,5.03396e-06,4.87662e-06,4.69787e-06,4.51911e-06, &        
           4.33600e-06,4.14416e-06,3.95232e-06,3.76048e-06,3.57217e-06, &        
           3.38549e-06,3.19881e-06,3.01212e-06,2.82621e-06,2.64068e-06, &        
           2.45515e-06,2.26962e-06,2.08659e-06,1.93029e-06/                      
      data n2oref/ &                                                             
           3.20000e-07,3.20000e-07,3.20000e-07,3.20000e-07,3.20000e-07, &        
           3.19652e-07,3.15324e-07,3.03830e-07,2.94221e-07,2.84953e-07, &        
           2.76714e-07,2.64709e-07,2.42847e-07,2.09547e-07,1.71945e-07, &        
           1.37491e-07,1.13319e-07,1.00354e-07,9.12812e-08,8.54633e-08, &        
           8.03631e-08,7.33718e-08,6.59754e-08,5.60386e-08,4.70901e-08, &        
           3.99774e-08,3.29786e-08,2.60642e-08,2.10663e-08,1.65918e-08, &        
           1.30167e-08,1.00900e-08,7.62490e-09,6.11592e-09,4.66725e-09, &        
           3.28574e-09,2.84838e-09,2.46198e-09,2.07557e-09,1.85507e-09, &        
           1.65675e-09,1.45843e-09,1.31948e-09,1.20716e-09,1.09485e-09, &        
           9.97803e-10,9.31260e-10,8.64721e-10,7.98181e-10,7.51380e-10, &        
           7.13670e-10,6.75960e-10,6.38250e-10,6.09811e-10,5.85998e-10, &        
           5.62185e-10,5.38371e-10,5.15183e-10,4.98660e-10/                      
      data o3ref/  &                                                             
           3.01700e-08,3.47254e-08,4.24769e-08,5.27592e-08,6.69439e-08, &        
           8.71295e-08,1.13911e-07,1.56771e-07,2.17878e-07,3.24430e-07, &        
           4.65942e-07,5.68057e-07,6.96065e-07,1.11863e-06,1.76175e-06, &        
           2.32689e-06,2.95769e-06,3.65930e-06,4.59503e-06,5.31891e-06, &        
           5.96179e-06,6.51133e-06,7.06350e-06,7.69169e-06,8.25771e-06, &        
           8.70824e-06,8.83245e-06,8.71486e-06,8.09434e-06,7.33071e-06, &        
           6.31014e-06,5.36717e-06,4.48289e-06,3.83913e-06,3.28270e-06, &        
           2.82351e-06,2.49061e-06,2.16453e-06,1.83845e-06,1.66182e-06, &        
           1.50517e-06,1.34852e-06,1.19718e-06,1.04822e-06,8.99264e-07, &        
           7.63432e-07,6.53806e-07,5.44186e-07,4.34564e-07,3.64210e-07, &        
           3.11938e-07,2.59667e-07,2.07395e-07,1.91456e-07,1.93639e-07, &        
           1.95821e-07,1.98004e-07,2.06442e-07,2.81546e-07/                      
                                                                                 
!     compute the optical depth by interpolating in ln(pressure) and             
!     temperature.                                                               
      do 2500 lay = 1, layswtch                                                  
         fp = fac01(lay) + fac11(lay)                                            
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(8) + 1                          
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(8) + 1                             
         inds = indself(lay)                                                     
         colref1 = n2oref(jp(lay))                                               
         colref2 = n2oref(jp(lay)+1)                                             
         wcomb1 = h2oref(jp(lay))                                                
         wcomb2 = h2oref(jp(lay)+1)                                              
         ratio = (colref1/wcomb1)+fp*((colref2/wcomb2)-(colref1/wcomb1))         
         currn2o = colh2o(lay) * ratio                                           
         n2omult = coln2o(lay) - currn2o                                         
         do 2000 ig = 1, ng8                                                     
            taug(ngs7+ig,lay) = colh2o(lay) *                 &
                (fac00(lay) * absa8(ind0,ig) +                &                   
                 fac10(lay) * absa8(ind0+1,ig) +              &                   
                 fac01(lay) * absa8(ind1,ig) +                &                   
                 fac11(lay) * absa8(ind1+1,ig) +              &                   
                 selffac(lay) * (selfrefc8(inds,ig) +         &                   
                 selffrac(lay) *                              &                   
                 (selfrefc8(inds+1,ig) - selfrefc8(inds,ig))))&                   
                 + wx(3,lay) * cfc12c8(ig)                    &                   
                 + wx(4,lay) * cfc22adjc8(ig)                 &                   
                 + co2mult(lay) * absco2ac8(ig)               &                   
                 + n2omult * absn2oac8(ig)        
            pfrac(ngs7+ig,lay) = fracrefac8(ig)                                    
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = layswtch+1, nlayers                                          
         fp = fac01(lay) + fac11(lay)                                            
         ind0 = ((jp(lay)-7)*5+(jt(lay)-1))*nspb(8) + 1                          
         ind1 = ((jp(lay)-6)*5+(jt1(lay)-1))*nspb(8) + 1                         
         colref1 = n2oref(jp(lay))                                               
         colref2 = n2oref(jp(lay)+1)                                             
         wcomb1 = o3ref(jp(lay))                                                 
         wcomb2 = o3ref(jp(lay)+1)                                               
         ratio = (colref1/wcomb1)+fp*((colref2/wcomb2)-(colref1/wcomb1))         
         currn2o = colo3(lay) * ratio                                            
         n2omult = coln2o(lay) - currn2o                                         
         do 3000 ig = 1, ng8                                                     
            taug(ngs7+ig,lay) = colo3(lay) *        &
                (fac00(lay) * absb8(ind0,ig) +       &                            
                 fac10(lay) * absb8(ind0+1,ig) +     &                            
                 fac01(lay) * absb8(ind1,ig) +       &                            
                 fac11(lay) * absb8(ind1+1,ig))      &                            
                 + wx(3,lay) * cfc12c8(ig)            &                            
                 + wx(4,lay) * cfc22adjc8(ig)         &                            
                 + co2mult(lay) * absco2bc8(ig)       &                            
                 + n2omult * absn2obc8(ig)                                         
            pfrac(ngs7+ig,lay) = fracrefbc8(ig)                                    
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb8
                                                                                 
!-----------------------------------------------------------------------------    
      subroutine taugb9(kts,ktep1,colh2o,coln2o,colch4,fac00,fac01,fac10,    &
                        fac11,selffac,selffrac,jp,jt,jt1,indself,            &
                        pfrac,taug,laytrop,layswtch,laylow                   )
!-----------------------------------------------------------------------------    
                                                                                 
!     band 9:  1180-1390 cm-1 (low - h2o,ch4; high - ch4)                        
                                                                                 
      integer, parameter :: ngs8=96                                      
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )   ::  laytrop,layswtch,laylow

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                    coln2o, &
                                                    colch4, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      dimension h2oref(13),ch4ref(13),etaref(11)                                 
      real n2omult,n2oref(13)                                              
                                                                                 
      data n2oref/  &                                                            
           3.20000e-07,3.20000e-07,3.20000e-07,3.20000e-07,3.20000e-07,  &
           3.19652e-07,3.15324e-07,3.03830e-07,2.94221e-07,2.84953e-07,  &       
           2.76714e-07,2.64709e-07,2.42847e-07/                                  
      data h2oref/  &                                                            
           1.8759999e-02, 1.2223309e-02, 5.8908667e-03, 2.7675382e-03,   &       
           1.4065107e-03, 7.5969833e-04, 3.8875898e-04, 1.6542293e-04,   &       
           3.7189537e-05, 7.4764857e-06, 4.3081886e-06, 3.3319423e-06,   &       
           3.2039343e-06/                                                        
      data ch4ref/  &                                                            
           1.7000001e-06, 1.7000001e-06, 1.6998713e-06, 1.6904165e-06,   &       
           1.6671424e-06, 1.6350652e-06, 1.6097551e-06, 1.5590465e-06,   &       
           1.5119849e-06, 1.4741138e-06, 1.4384609e-06, 1.4002215e-06,   &       
           1.3573376e-06/                                                        
      data etaref/  &                                                            
           0.,0.125,0.25,0.375,0.5,0.625,0.75,0.875,0.96,0.99,1.0/               
                                                                                 
      strrat = 21.6282                                                           
      ioff = 0                                                                   
                                                                                 
!     compute the optical depth by interpolating in ln(pressure),                
!     temperature, and appropriate species.  below laytrop, the water            
!     vapor self-continuum is interpolated (in temperature) separately.          
      do 2500 lay = 1, laytrop                                                   
         speccomb = colh2o(lay) + strrat*colch4(lay)                             
         specparm = colh2o(lay)/speccomb                                         
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 8.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         jfrac = js                                                              
         fs = amod(specmult,1.0)                                                 
         ffrac = fs                                                              
         if (js .eq. 8) then                                                     
            if (fs .le. 0.68) then                                               
               fs = fs/0.68                                                      
            elseif (fs .le. 0.92) then                                           
               js = js + 1                                                       
               fs = (fs-0.68)/0.24                                               
            else                                                                 
               js = js + 2                                                       
               fs = (fs-0.92)/0.08                                               
            endif                                                                
         elseif (js .eq.9) then                                                  
            js = 10                                                              
            fs = 1.                                                              
            jfrac = 8                                                            
            ffrac = 1.                                                           
         endif                                                                   
         fp = fac01(lay) + fac11(lay)                                            
         ns = js + int(fs + 0.5)                                                 
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(9) + js                         
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(9) + js                            
         inds = indself(lay)                                                     
         if (lay .eq. laylow) ioff = ng9                                         
         if (lay .eq. layswtch) ioff = 2*ng9                                     
         colref1 = n2oref(jp(lay))                                               
         colref2 = n2oref(jp(lay)+1)                                             
         if (ns .eq. 11) then                                                    
            wcomb1 = h2oref(jp(lay))                                             
            wcomb2 = h2oref(jp(lay)+1)                                           
         else                                                                    
            wcomb1 = strrat * ch4ref(jp(lay))/(1.-etaref(ns))                    
            wcomb2 = strrat * ch4ref(jp(lay)+1)/(1.-etaref(ns))                  
         endif                                                                   
         ratio = (colref1/wcomb1)+fp*((colref2/wcomb2)-(colref1/wcomb1))         
         currn2o = speccomb * ratio                                              
         n2omult = coln2o(lay) - currn2o                                         
         do 2000 ig = 1, ng9                                                     
            taug(ngs8+ig,lay) = speccomb *                      &
                (fac000 * absa9(ind0,ig) +                      &                 
                 fac100 * absa9(ind0+1,ig) +                    &                 
                 fac010 * absa9(ind0+11,ig) +                   &                 
                 fac110 * absa9(ind0+12,ig) +                   &                 
                 fac001 * absa9(ind1,ig) +                      &                 
                 fac101 * absa9(ind1+1,ig) +                    &                 
                 fac011 * absa9(ind1+11,ig) +                   &                 
                 fac111 * absa9(ind1+12,ig)) +                  &                 
                 colh2o(lay) *                                  &                 
                 selffac(lay) * (selfrefc9(inds,ig) +           &                 
                 selffrac(lay) *                                &                 
                 (selfrefc9(inds+1,ig) - selfrefc9(inds,ig)))   & 
                 + n2omult * absn2oc9(ig+ioff)                                     
            pfrac(ngs8+ig,lay) = fracrefac9(ig,jfrac) + ffrac *  &                 
                 (fracrefac9(ig,jfrac+1) - fracrefac9(ig,jfrac))                     
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(9) + 1                         
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(9) + 1                        
         do 3000 ig = 1, ng9                                                     
            taug(ngs8+ig,lay) = colch4(lay) *                  &                 
                (fac00(lay) * absb9(ind0,ig) +                  &                 
                 fac10(lay) * absb9(ind0+1,ig) +                &                 
                 fac01(lay) * absb9(ind1,ig) +                  &                 
                 fac11(lay) * absb9(ind1+1,ig))                                   
            pfrac(ngs8+ig,lay) = fracrefbc9(ig)                                    
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb9
                                                                                 
!--------------------------------------------------------------------------------    
      subroutine taugb10(kts,ktep1,colh2o,fac00,fac01,fac10,fac11,jp,jt,jt1,    &
                         pfrac,taug,laytrop                                     )
!--------------------------------------------------------------------------------    
                                                                                 
!     band 10:  1390-1480 cm-1 (low - h2o; high - h2o)                           
                                                                                 
      integer, parameter :: ngs9=108                                     
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
!     compute the optical depth by interpolating in ln(pressure) and             
!     temperature.                                                               
      do 2500 lay = 1, laytrop                                                   
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(10) + 1                         
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(10) + 1                            
         do 2000 ig = 1, ng10                                                    
            taug(ngs9+ig,lay) = colh2o(lay) *          &
                (fac00(lay) * absa10(ind0,ig) +        &                           
                 fac10(lay) * absa10(ind0+1,ig) +      &                           
                 fac01(lay) * absa10(ind1,ig) +        &                           
                 fac11(lay) * absa10(ind1+1,ig))                                   
            pfrac(ngs9+ig,lay) = fracrefac10(ig)                                    
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(10) + 1                        
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(10) + 1                       
         do 3000 ig = 1, ng10                                                    
            taug(ngs9+ig,lay) = colh2o(lay) *        &
                (fac00(lay) * absb10(ind0,ig) +        &                           
                 fac10(lay) * absb10(ind0+1,ig) +      &                           
                 fac01(lay) * absb10(ind1,ig) +        &                           
                 fac11(lay) * absb10(ind1+1,ig))                                   
            pfrac(ngs9+ig,lay) = fracrefbc10(ig)                                    
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb10
                                                                                 
!--------------------------------------------------------------------------    
      subroutine taugb11(kts,ktep1,colh2o,fac00,fac01,fac10,fac11,        &
                         selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,   &
                         laytrop                                          )
!--------------------------------------------------------------------------    
                                                                                 
!     band 11:  1480-1800 cm-1 (low - h2o; high - h2o)                           
                                                                                 
      integer, parameter :: ngs10=114                                    
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 

!     compute the optical depth by interpolating in ln(pressure) and             
!     temperature.  below laytrop, the water vapor self-continuum                
!     is interpolated (in temperature) separately.                               
      do 2500 lay = 1, laytrop                                                   
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(11) + 1                         
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(11) + 1                            
         inds = indself(lay)                                                     
         do 2000 ig = 1, ng11                                                    
            taug(ngs10+ig,lay) = colh2o(lay) *                 &                   
                (fac00(lay) * absa11(ind0,ig) +                &                   
                 fac10(lay) * absa11(ind0+1,ig) +              &                   
                 fac01(lay) * absa11(ind1,ig) +                &                   
                 fac11(lay) * absa11(ind1+1,ig) +              &                   
                 selffac(lay) * (selfrefc11(inds,ig) +         & 
                 selffrac(lay) *                               &                   
                 (selfrefc11(inds+1,ig) - selfrefc11(inds,ig))))                       
            pfrac(ngs10+ig,lay) = fracrefac11(ig)                                   
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(11) + 1                        
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(11) + 1                       
         do 3000 ig = 1, ng11                                                    
            taug(ngs10+ig,lay) = colh2o(lay) *               &                   
                (fac00(lay) * absb11(ind0,ig) +                &                   
                 fac10(lay) * absb11(ind0+1,ig) +              &                   
                 fac01(lay) * absb11(ind1,ig) +                &                   
                 fac11(lay) * absb11(ind1+1,ig))                                   
            pfrac(ngs10+ig,lay) = fracrefbc11(ig)                                   
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb11
                                                                                 
!-----------------------------------------------------------------------------    
      subroutine taugb12(kts,ktep1,colh2o,colco2,fac00,fac01,fac10,fac11,    &
                         selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,      &
                         laytrop                                             )
!-----------------------------------------------------------------------------   
                                                                                 
!     band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)                   
                                                                                 
      integer, parameter :: ngs11=122                                    
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                    colco2, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      strrat1 = 0.009736757                                                      
                                                                                 
!     compute the optical depth by interpolating in ln(pressure),                
!     temperature, and appropriate species.  below laytrop, the water            
!     vapor self-continuum is interpolated (in temperature) separately.          
!!dir$ novector                                                                   
      do 2500 lay = 1, laytrop                                                   
         speccomb = colh2o(lay) + strrat1*colco2(lay)                            
         specparm = colh2o(lay)/speccomb                                         
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 8.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(12) + js                        
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(12) + js                           
         inds = indself(lay)                                                     
!!dir$ vector                                                                     
         do 2000 ig = 1, ng12                                                    
            taug(ngs11+ig,lay) = speccomb *             & 
                (fac000 * absa12(ind0,ig) +             &                          
                 fac100 * absa12(ind0+1,ig) +           &                          
                 fac010 * absa12(ind0+9,ig) +           &                          
                 fac110 * absa12(ind0+10,ig) +          &                          
                 fac001 * absa12(ind1,ig) +             &                          
                 fac101 * absa12(ind1+1,ig) +           &                          
                 fac011 * absa12(ind1+9,ig) +           &                          
                 fac111 * absa12(ind1+10,ig)) +         &                          
                 colh2o(lay) *                          &                          
                 selffac(lay) * (selfrefc12(inds,ig) +  &                          
                 selffrac(lay) *                        &                          
                 (selfrefc12(inds+1,ig) - selfrefc12(inds,ig)))                        
            pfrac(ngs11+ig,lay) = fracrefac12(ig,js) + fs *  & 
                 (fracrefac12(ig,js+1) - fracrefac12(ig,js))                           
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         do 3000 ig = 1, ng12                                                    
            taug(ngs11+ig,lay) = 0.0                                             
            pfrac(ngs11+ig,lay) = 0.0                                            
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb12
                                                                                 
!-----------------------------------------------------------------------------    
      subroutine taugb13(kts,ktep1,colh2o,coln2o,fac00,fac01,fac10,fac11,    &
                         selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,      &
                         laytrop                                             )
!-----------------------------------------------------------------------------    
                                                                                 
!     band 13:  2080-2250 cm-1 (low - h2o,n2o; high - nothing)                   
                                                                                 
      integer, parameter :: ngs12=130                                    
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                    coln2o, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      strrat1 = 16658.87                                                         
                                                                                 
!     compute the optical depth by interpolating in ln(pressure),                
!     temperature, and appropriate species.  below laytrop, the water            
!     vapor self-continuum is interpolated (in temperature) separately.          
      do 2500 lay = 1, laytrop                                                   
         speccomb = colh2o(lay) + strrat1*coln2o(lay)                            
         specparm = colh2o(lay)/speccomb                                         
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 8.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(13) + js                        
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(13) + js                           
         inds = indself(lay)                                                     
         do 2000 ig = 1, ng13                                                    
            taug(ngs12+ig,lay) = speccomb *                &                       
                (fac000 * absa13(ind0,ig) +                &                       
                 fac100 * absa13(ind0+1,ig) +              &                       
                 fac010 * absa13(ind0+9,ig) +              &                       
                 fac110 * absa13(ind0+10,ig) +             &                       
                 fac001 * absa13(ind1,ig) +                &                       
                 fac101 * absa13(ind1+1,ig) +              &                       
                 fac011 * absa13(ind1+9,ig) +              &                       
                 fac111 * absa13(ind1+10,ig)) +            &                       
                 colh2o(lay) *                           &                       
                 selffac(lay) * (selfrefc13(inds,ig) +      &                       
                 selffrac(lay) *                         &                       
                 (selfrefc13(inds+1,ig) - selfrefc13(inds,ig)))                        
            pfrac(ngs12+ig,lay) = fracrefac13(ig,js) + fs * &                       
                 (fracrefac13(ig,js+1) - fracrefac13(ig,js))                           
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         do 3000 ig = 1, ng13                                                    
            taug(ngs12+ig,lay) = 0.0                                             
            pfrac(ngs12+ig,lay) = 0.0                                            
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 

      end subroutine taugb13
                                                                                 
!----------------------------------------------------------------------------    
      subroutine taugb14(kts,ktep1,colco2,fac00,fac01,fac10,fac11,          &
                         selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,     &
                         laytrop                                            )
!----------------------------------------------------------------------------    
                                                                                 
!     band 14:  2250-2380 cm-1 (low - co2; high - co2)                           
                                                                                 
      integer, parameter :: ngs13=134                                    
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colco2, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
!     compute the optical depth by interpolating in ln(pressure) and             
!     temperature.  below laytrop, the water vapor self-continuum                
!     is interpolated (in temperature) separately.                               
      do 2500 lay = 1, laytrop                                                   
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(14) + 1                         
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(14) + 1                            
         inds = indself(lay)                                                     
         do 2000 ig = 1, ng14                                                    
            taug(ngs13+ig,lay) = colco2(lay) *           &
                (fac00(lay) * absa14(ind0,ig) +          &                         
                 fac10(lay) * absa14(ind0+1,ig) +        &                         
                 fac01(lay) * absa14(ind1,ig) +          &                         
                 fac11(lay) * absa14(ind1+1,ig) +        &                         
                 selffac(lay) * (selfrefc14(inds,ig) +   &                         
                 selffrac(lay) *                         &                         
                 (selfrefc14(inds+1,ig) - selfrefc14(inds,ig))))                       
            pfrac(ngs13+ig,lay) = fracrefac14(ig)                                   
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(14) + 1                        
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(14) + 1                       
         do 3000 ig = 1, ng14                                                    
            taug(ngs13+ig,lay) = colco2(lay) *       &                           
                (fac00(lay) * absb14(ind0,ig) +        &                           
                 fac10(lay) * absb14(ind0+1,ig) +      &                           
                 fac01(lay) * absb14(ind1,ig) +        &                           
                 fac11(lay) * absb14(ind1+1,ig))                                   
            pfrac(ngs13+ig,lay) = fracrefbc14(ig)                                   
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb14
                                                                                 
!------------------------------------------------------------------------------    
      subroutine taugb15(kts,ktep1,colh2o,colco2,coln2o,fac00,fac01,fac10,    &
                         fac11,selffac,selffrac,jp,jt,jt1,indself,            &
                         pfrac,taug,laytrop                                   )
!------------------------------------------------------------------------------    
                                                                                 
!     band 15:  2380-2600 cm-1 (low - n2o,co2; high - nothing)                   
                                                                                 
      integer, parameter :: ngs14=136                                    
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                    colco2, &
                                                    coln2o, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      strrat1 = 0.2883201                                                        
                                                                                 
!     compute the optical depth by interpolating in ln(pressure),                
!     temperature, and appropriate species.  below laytrop, the water            
!     vapor self-continuum is interpolated (in temperature) separately.          
      do 2500 lay = 1, laytrop                                                   
         speccomb = coln2o(lay) + strrat1*colco2(lay)                            
         specparm = coln2o(lay)/speccomb                                         
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 8.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(15) + js                        
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(15) + js                           
         inds = indself(lay)                                                     
         do 2000 ig = 1, ng15                                                    
            taug(ngs14+ig,lay) = speccomb *                     &                  
                (fac000 * absa15(ind0,ig) +                     &                  
                 fac100 * absa15(ind0+1,ig) +                   &                  
                 fac010 * absa15(ind0+9,ig) +                   &                  
                 fac110 * absa15(ind0+10,ig) +                  &                  
                 fac001 * absa15(ind1,ig) +                     &                  
                 fac101 * absa15(ind1+1,ig) +                   &                  
                 fac011 * absa15(ind1+9,ig) +                   &                  
                 fac111 * absa15(ind1+10,ig)) +                 &                  
                 colh2o(lay) *                                &                  
                 selffac(lay) * (selfrefc15(inds,ig) +           &                  
                 selffrac(lay) *                              &                  
                 (selfrefc15(inds+1,ig) - selfrefc15(inds,ig)))                        
            pfrac(ngs14+ig,lay) = fracrefac15(ig,js) + fs *      &                  
                 (fracrefac15(ig,js+1) - fracrefac15(ig,js))                           
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         do 3000 ig = 1, ng15                                                    
            taug(ngs14+ig,lay) = 0.0                                             
            pfrac(ngs14+ig,lay) = 0.0                                            
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb15
                                                                                 
!-----------------------------------------------------------------------------    
      subroutine taugb16(kts,ktep1,colh2o,colch4,fac00,fac01,fac10,fac11,    &
                         selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,      &
                         laytrop                                             )
!-----------------------------------------------------------------------------    
                                                                                 
!     band 16:  2600-3000 cm-1 (low - h2o,ch4; high - nothing)                   
                                                                                 
      integer, parameter :: ngs15=138                                    
                                                                                 
      integer, intent(in )                      :: kts,ktep1

      integer, intent(in )                      ::  laytrop

      real, dimension( ngpt,kts:ktep1 ),                    &
            intent(inout)        ::                  pfrac, &
                                                      taug

      real, dimension( kts:ktep1 ), intent(in   ) ::        &
                                                    colh2o, &
                                                    colch4, &
                                                     fac00, &
                                                     fac01, &
                                                     fac10, &
                                                     fac11, &
                                                   selffac, &
                                                  selffrac 
 
      integer, dimension( kts:ktep1 ), intent(in   ) ::     &
                                                        jp, &
                                                        jt, &
                                                       jt1, &
                                                   indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
      strrat1 = 830.411                                                          
                                                                                 
!     compute the optical depth by interpolating in ln(pressure),                
!     temperature, and appropriate species.  below laytrop, the water            
!     vapor self-continuum is interpolated (in temperature) separately.          
      do 2500 lay = 1, laytrop                                                   
         speccomb = colh2o(lay) + strrat1*colch4(lay)                            
         specparm = colh2o(lay)/speccomb                                         
         if (specparm .ge. oneminus) specparm = oneminus                         
         specmult = 8.*(specparm)                                                
         js = 1 + int(specmult)                                                  
         fs = amod(specmult,1.0)                                                 
         fac000 = (1. - fs) * fac00(lay)                                         
         fac010 = (1. - fs) * fac10(lay)                                         
         fac100 = fs * fac00(lay)                                                
         fac110 = fs * fac10(lay)                                                
         fac001 = (1. - fs) * fac01(lay)                                         
         fac011 = (1. - fs) * fac11(lay)                                         
         fac101 = fs * fac01(lay)                                                
         fac111 = fs * fac11(lay)                                                
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(16) + js                        
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(16) + js                           
         inds = indself(lay)                                                     
         do 2000 ig = 1, ng16                                                    
            taug(ngs15+ig,lay) = speccomb *                 &
                (fac000 * absa16(ind0,ig) +                 &                      
                 fac100 * absa16(ind0+1,ig) +               &                      
                 fac010 * absa16(ind0+9,ig) +               &                      
                 fac110 * absa16(ind0+10,ig) +              &                      
                 fac001 * absa16(ind1,ig) +                 &                      
                 fac101 * absa16(ind1+1,ig) +               &                      
                 fac011 * absa16(ind1+9,ig) +               &                      
                 fac111 * absa16(ind1+10,ig)) +             &                      
                 colh2o(lay) *                            &                      
                 selffac(lay) * (selfrefc16(inds,ig) +       &                      
                 selffrac(lay) *                          &                      
                 (selfrefc16(inds+1,ig) - selfrefc16(inds,ig)))                        
            pfrac(ngs15+ig,lay) = fracrefac16(ig,js) + fs *  &                      
                 (fracrefac16(ig,js+1) - fracrefac16(ig,js))                           
 2000    continue                                                                
 2500 continue                                                                   
                                                                                 
      do 3500 lay = laytrop+1, nlayers                                           
         do 3000 ig = 1, ng16                                                    
            taug(ngs15+ig,lay) = 0.0                                             
            pfrac(ngs15+ig,lay) = 0.0                                            
 3000    continue                                                                
 3500 continue                                                                   
                                                                                 
      end subroutine taugb16
                                                                                 

!-------------------------------------------------------------------------
      subroutine rtrn(kts,ktep1,                                         &
                      tavel, pz, tz, cldfrac, taucloud, totdflux,        &
                      htr, icldlyr, itr, pfrac, tbound,semiss            )
!-------------------------------------------------------------------------
!  rrtm longwave radiative transfer model                                        
!  atmospheric and environmental research, inc., cambridge, ma                   
!                                                                                
!  original version:       e. j. mlawer, et al.                                  
!  revision for ncar ccm:  michael j. iacono; september, 1998                    
!                                                                                
!  this program calculates the upward fluxes, downward fluxes, and               
!  heating rates for an arbitrary clear or cloudy atmosphere.  the input         
!  to this program is the atmospheric profile, all planck function               
!  information, and the cloud fraction by layer.  the diffusivity angle          
!  (secang=1.66) is used for the angle integration for consistency with          
!  the ncar ccm; the gaussian weight appropriate to this angle (wtnum=0.5)       
!  is applied here.  note that use of the emissivity angle for the flux          
!  integration can cause errors of 1 to 4 w/m2 within cloudy layers.             
!-------------------------------------------------------------------------
                                                                                 
      integer, intent(in )    ::      kts,ktep1
 
      integer, dimension( ngpt,kts:ktep1 ),               &
               intent(in   )  ::                     itr

      real, dimension( ngpt,kts:ktep1 ),                  &
            intent(in   )     ::                   pfrac

      real, dimension( kts:ktep1 ), intent(in   ) ::      &
                                                   tavel
      real, dimension( kts:ktep1 ), intent(in   ) ::      &
                                                 cldfrac, &
                                                taucloud

      real, dimension(   0:ktep1 ),intent(inout)::        &
                                                totdflux

      real, dimension(   0:ktep1 ), intent(inout) ::        &
                                                     htr  

      real, dimension(   0:ktep1 ), intent(in   ) ::      &
                                                      pz, &
                                                      tz
      integer, dimension( kts:ktep1 ), intent(in   ) ::   &
                                                 icldlyr

      real, intent(in   )        ::               tbound
      real, dimension(nbands), intent(in   ) ::   semiss

! local var

      real, dimension(   0:ktep1 )              ::        &
                                                totuclfl, &
                                                totdclfl, &
                                                totuflux

      real, dimension(   0:ktep1 )              ::        &
                                                    fnet, &
                                                   fnetc, &
                                                    htrc

      integer :: kk
     
      real    :: clrnttoa,clrntsrf 

! parameters                                                                     

!     integer, parameter :: mxlay=101                                                      
      real, parameter :: secang=1.66                                                    
      real, parameter :: wtnum=0.5                                                      
                                                                                 
! rrtm definitions                                                               
! input                                                                          
!    mxlay                        ! maximum number of model layers               
!    ngpt                         ! total number of g-point subintervals         
!    nbands                       ! number of longwave spectral bands            
!    secang                       ! diffusivity angle                            
!    wtnum                        ! weight for radiance to flux conversion       
!    nlayers                      ! number of model layers (plev+1)              
!    pavel(mxlay)                 ! layer pressures (mb)                         
!    pz(0:mxlay)                  ! level (interface) pressures (mb)             
!    tavel(mxlay)                 ! layer temperatures (k)                       
!    tz(0:mxlay)                  ! level (interface) temperatures(mb)           
!    tbound                       ! surface temperature (k)                      
!    cldfrac(mxlay)               ! layer cloud fraction                         
!    taucloud(mxlay)              ! layer cloud optical depth                    
!    itr(ngpt,mxlay)              ! integer look-up table index                  
!    pfrac(ngpt,mxlay)               ! planck fractions                             
!    icldlyr(mxlay)               ! flag for cloudy layers                       
!    icld                         ! flag for cloudy in column                    
!    semiss(nbands)               ! surface emissivities for each band           
!    bpade                        ! pade constant                                
!    tau                          ! clear sky optical depth look-up table        
!    tf                           ! tau transition function look-up table        
!    trans                        ! clear sky transmittance look-up table        
! local                                                                          
!    abss(ngpt*mxlay)             ! gaseous absorptivity                         
!    abscld(mxlay)                ! cloud absorptivity                           
!    atot(ngpt*mxlay)             ! combined gaseous and cloud absorptivity      
!    odclr(ngpt,mxlay)            ! clear sky (gaseous) optical depth            
!    odcld(mxlay)                 ! cloud optical depth                          
!    efclfrac(mxlay)              ! effective cloud fraction                     
!    radlu(ngpt)                  ! upward radiance                              
!    urad                         ! spectrally summed upward radiance            
!    radclru(ngpt)                ! clear sky upward radiance                    
!    clrurad                      ! spectrally summed clear sky upward radiance  
!    radld(ngpt)                  ! downward radiance                            
!    drad                         ! spectrally summed downward radiance          
!    radclrd(ngpt)                ! clear sky downward radiance                  
!    clrdrad                      ! spectrally summed clear sky downward radianc 
! output                                                                         
!    totuflux(0:mxlay)            ! upward longwave flux (w/m2)                  
!    totdflux(0:mxlay)            ! downward longwave flux (w/m2)                
!    fnet(0:mxlay)                ! net longwave flux (w/m2)                     
!    htr(0:mxlay)                 ! longwave heating rate (k/day)                
!    clrnttoa                     ! clear sky toa outgoing flux (w/m2)           
!    clrntsfc                     ! clear sky net surface flux (w/m2)            
!    totuclfl(0:mxlay)            ! clear sky upward longwave flux (w/m2)        
!    totdclfl(0:mxlay)            ! clear sky downward longwave flux (w/m2)      
!    fnetc(0:mxlay)               ! clear sky net longwave flux (w/m2)           
!    htrc(0:mxlay)                ! clear sky longwave heating rate (k/day)      
!                                                                                
                                                                                 
! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               

      dimension bbu(ngpt*(ktep1-kts+1)),bbutot(ngpt*(ktep1-kts)),bglev(ngpt)                   
      dimension plankbnd(nbands),plnkemit(nbands)                                
      dimension plvl(nbands,0:ktep1),play(nbands,kts:ktep1)                          
      dimension indlay(kts:ktep1),indlev(0:ktep1)                                    
      dimension tlayfrac(kts:ktep1),tlevfrac(0:ktep1)                                
      dimension abss(ngpt*(ktep1-kts+1)),abscld(kts:ktep1-1),atot(ngpt*(ktep1-kts)) 
      dimension odclr(ngpt,kts:ktep1-1),odcld(kts:ktep1-1),efclfrac(kts:ktep1-1)
      dimension radlu(ngpt),radld(ngpt)                                          
      dimension radclru(ngpt),radclrd(ngpt)                                      
      dimension semis(ngpt),raduemit(ngpt)                                       
                                                                                 
      indbound = tbound - 159.                                                   
      tbndfrac = tbound - int(tbound)                                            
                                                                                 
      do 200 lay = 0, nlayers                                                    
         totuflux(lay) = 0.0                                                     
         totdflux(lay) = 0.0                                                     
         totuclfl(lay) = 0.0                                                     
         totdclfl(lay) = 0.0                                                     
         indlev(lay) = tz(lay) - 159.                                            
         tlevfrac(lay) = tz(lay) - int(tz(lay))                                  
 200  continue                                                                   
                                                                                 
      do 220 lev = 1, nlayers                                                    
                                                                                 
         if (icldlyr(lev).eq.1) then                                             
            indlay(lev) = tavel(lev) - 159.                                      
            tlayfrac(lev) = tavel(lev) - int(tavel(lev))                         
!  cloudy sky optical depth and absorptivity.                                    
            odcld(lev) = secang * taucloud(lev)                                  
            transcld = exp(-odcld(lev))                                          
            abscld(lev) = 1. - transcld                                          
            efclfrac(lev) = abscld(lev) * cldfrac(lev)                           
!  get clear sky optical depth from tau lookup table                             
            do 250 ipr = 1, ngpt                                                 
               ind = itr(ipr,lev)                                                
               odclr(ipr,lev) = tau(ind)                                         
 250        continue                                                             
         else                                                                    
            indlay(lev) = tavel(lev) - 159.                                      
            tlayfrac(lev) = tavel(lev) - int(tavel(lev))                         
         endif                                                                   
                                                                                 
 220  continue                                                                   
                                                                                 
!      sumpl   = 0.0                                                             
!      sumplem = 0.0                                                             
! *** loop over frequency bands.                                                 
      do 600 iband = 1, nbands                                                   
         dbdtlev = totplnk(indbound+1,iband)-totplnk(indbound,iband)             
         plankbnd(iband) = delwave(iband) * (totplnk(indbound,iband) +  &
              tbndfrac * dbdtlev)                                                
         dbdtlev = totplnk(indlev(0)+1,iband) -                         &        
              totplnk(indlev(0),iband)                                           
         plvl(iband,0) = delwave(iband) * (totplnk(indlev(0),iband) +   &        
              tlevfrac(0)*dbdtlev)                                               
                                                                                 
         plnkemit(iband) = semiss(iband) * plankbnd(iband)                       
!         sumplem  = sumplem + plnkemit(iband)                                   
!         sumpl    = sumpl   + plankbnd(iband)                                   
                                                                                 
         do 300 lev = 1, nlayers                                                 
!     calculate the integrated planck functions at the level and                 
!     layer temperatures.                                                        
            dbdtlev = totplnk(indlev(lev)+1,iband) -          &
                 totplnk(indlev(lev),iband)                                      
            dbdtlay = totplnk(indlay(lev)+1,iband) -          &                  
                 totplnk(indlay(lev),iband)                                      
            play(iband,lev) = delwave(iband) *                &                  
                 (totplnk(indlay(lev),iband) + tlayfrac(lev) * dbdtlay)          
            plvl(iband,lev) = delwave(iband) *                &                  
                 (totplnk(indlev(lev),iband) + tlevfrac(lev) * dbdtlev)          
 300     continue                                                                
 600  continue                                                                   
                                                                                 
!      semislw = sumplem / sumpl                                                 
                                                                                 
! *** initialize for radiative transfer.                                         
      do 500 ipr = 1, ngpt                                                       
         radclrd(ipr) = 0.                                                       
         radld(ipr) = 0.                                                         
         semis(ipr) = semiss(ngb(ipr))                                           
         raduemit(ipr) = pfrac(ipr,1) * plnkemit(ngb(ipr))                          
         bglev(ipr) = pfrac(ipr,nlayers) * plvl(ngb(ipr),nlayers)                   
 500  continue                                                                   
                                                                                 
                                                                                 
! *** downward radiative transfer                                                
! *** drad holds summed radiance for total sky stream                            
! *** clrdrad holds summed radiance for clear sky stream                         
                                                                                 
      iclddn = 0                                                                 
      do 3000 lev = nlayers, 1, -1                                               
         drad = 0.0                                                              
         clrdrad = 0.0                                                           
                                                                                 
         if (icldlyr(lev).eq.1) then                                             
                                                                                 
! *** cloudy layer                                                               
         iclddn = 1                                                              
         ient = ngpt * (lev-1)                                                   
         do 2000 ipr = 1, ngpt                                                   
            index = ient + ipr                                                   
!     get lookup table index                                                     
            ind = itr(ipr,lev)                                                   
!     add clear sky and cloud optical depths                                     
            odsm = odclr(ipr,lev) + odcld(lev)                                   
            factot = odsm / (bpade + odsm)                                       
            bglay = pfrac(ipr,lev) * play(ngb(ipr),lev)                             
            delbgup = bglev(ipr) - bglay                                         
!     get tf from lookup table                                                   
            tauf = tf(ind)                                                       
            bbu(index) = bglay + tauf * delbgup                                  
            bbutot(index) = bglay + factot * delbgup                             
            bglev(ipr) = pfrac(ipr,lev) * plvl(ngb(ipr),lev-1)                      
            delbgdn = bglev(ipr) - bglay                                         
            bbd = bglay + tauf * delbgdn                                         
            bbdlevd = bglay + factot * delbgdn                                   
!     get clear sky transmittance from lookup table                              
            abss(index) = 1. - trans(ind)                                        
            atot(index) = abss(index) + abscld(lev) -      &
                abss(index) * abscld(lev)                                        
            gassrc = bbd * abss(index)                                           
!     total sky radiance                                                         
            radld(ipr) = radld(ipr) - radld(ipr) * (abss(index) +  &             
               efclfrac(lev) * (1.-abss(index))) + gassrc +        &             
               cldfrac(lev) * (bbdlevd * atot(index) - gassrc)                   
            drad = drad + radld(ipr)                                             
!     clear sky radiance                                                         
            radclrd(ipr) = radclrd(ipr) + (bbd - radclrd(ipr))     & 
                         * abss(index)                                           
            clrdrad = clrdrad + radclrd(ipr)                                     
 2000    continue                                                                
                                                                                 
         else                                                                    
                                                                                 
! *** clear layer                                                                
         ient = ngpt * (lev-1)                                                   
         do 2100 ipr = 1, ngpt                                                   
            index = ient + ipr                                                   
            ind = itr(ipr,lev)                                                   
            bglay = pfrac(ipr,lev) * play(ngb(ipr),lev)                             
            delbgup = bglev(ipr) - bglay                                         
!     get tf from lookup table                                                   
            tauf = tf(ind)                                                       
            bbu(index) = bglay + tauf * delbgup                                  
            bglev(ipr) = pfrac(ipr,lev) * plvl(ngb(ipr),lev-1)                      
            delbgdn = bglev(ipr) - bglay                                         
            bbd = bglay + tauf * delbgdn                                         
!     get clear sky transmittance from lookup table                              
            abss(index) = 1. - trans(ind)                                        
!     total sky radiance                                                         
            radld(ipr) = radld(ipr) + (bbd - radld(ipr)) *     & 
                         abss(index)                                             
            drad = drad + radld(ipr)                                             
 2100    continue                                                                
!     set clear sky stream to total sky stream as long as layers                 
!     remain clear.  streams diverge when a cloud is reached.                    
            if (iclddn.eq.1) then                                                
         do 2200 ipr = 1, ngpt                                                   
               radclrd(ipr) = radclrd(ipr) + (bbd - radclrd(ipr)) *   & 
                              abss(index)                                        
               clrdrad = clrdrad + radclrd(ipr)                                  
 2200    continue                                                                
            else                                                                 
         do 2300 ipr = 1, ngpt                                                   
               radclrd(ipr) = radld(ipr)                                         
               clrdrad = drad                                                    
 2300    continue                                                                
            endif                                                                
                                                                                 
! 2100    continue                                                               
                                                                                 
         endif                                                                   
                                                                                 
         totdflux(lev-1) = drad * wtnum                                          
         totdclfl(lev-1) = clrdrad * wtnum                                       
                                                                                 
 3000 continue                                                                   
                                                                                 
                                                                                 
! spectral emissivity & reflectance                                              
! include the contribution of spectrally varying longwave emissivity and         
! reflection from the surface to the upward radiative transfer.                  
! note: spectral and lambertian reflection are identical for the one angle       
! flux integration used here.                                                    
                                                                                 
      urad = 0.0                                                                 
      clrurad = 0.0                                                              
      do 3500 ipr = 1, ngpt                                                      
!     total sky radiance                                                         
         radlu(ipr) = raduemit(ipr) + (1. - semis(ipr)) * radld(ipr)             
         urad = urad + radlu(ipr)                                                
!     clear sky radiance                                                         
         radclru(ipr) = raduemit(ipr) + (1. - semis(ipr))  & 
                        * radclrd(ipr)                                           
         clrurad = clrurad + radclru(ipr)                                        
 3500 continue                                                                   
      totuflux(0) = urad * wtnum                                                 
      totuclfl(0) = clrurad * wtnum                                              
                                                                                 
                                                                                 
! *** upward radiative transfer                                                  
! *** urad holds the summed radiance for total sky stream                        
! *** clrurad holds the summed radiance for clear sky stream                     
                                                                                 
      do 5000 lev = 1, nlayers                                                   
         urad = 0.0                                                              
         clrurad = 0.0                                                           
                                                                                 
! check flag for cloud in current layer                                          
                                                                                 
         if (icldlyr(lev).eq.1) then                                             
                                                                                 
! *** cloudy layers                                                              
         ient = ngpt * (lev-1)                                                   
         do 4000 ipr = 1, ngpt                                                   
            index = ient + ipr                                                   
            gassrc = bbu(index) * abss(index)                                    
!     total sky radiance                                                         
            radlu(ipr) = radlu(ipr) - radlu(ipr) * (abss(index) +    &           
               efclfrac(lev) * (1.-abss(index))) + gassrc +          &
               cldfrac(lev) * (bbutot(index) * atot(index) - gassrc)             
            urad = urad + radlu(ipr)                                             
!     clear sky radiance                                                         
            radclru(ipr) = radclru(ipr) + (bbu(index) - radclru(ipr)) * &        
                           abss(index)                                           
            clrurad = clrurad + radclru(ipr)                                     
 4000    continue                                                                
                                                                                 
         else                                                                    
                                                                                 
! *** clear layer                                                                
         ient = ngpt * (lev-1)                                                   
         do 4100 ipr = 1, ngpt                                                   
            index = ient + ipr                                                   
!     total sky radiance                                                         
            radlu(ipr) = radlu(ipr) + (bbu(index)-radlu(ipr)) *  & 
                         abss(index)                                             
            urad = urad + radlu(ipr)                                             
!     clear sky radiance                                                         
!     upward clear and total sky streams must remain separate because surface    
!     reflectance is different for each.                                         
            radclru(ipr) = radclru(ipr) + (bbu(index) - radclru(ipr))   &         
                           * abss(index)                                         
            clrurad = clrurad + radclru(ipr)                                     
 4100    continue                                                                
                                                                                 
         endif                                                                   
                                                                                 
         totuflux(lev) = urad * wtnum                                            
         totuclfl(lev) = clrurad * wtnum                                         
                                                                                 
 5000 continue                                                                   
                                                                                 
                                                                                 
! *** convert radiances to fluxes and heating rates for total sky.  calculates   
!     clear sky surface and toa values.  to compute clear sky profiles, uncommen 
!     relevant lines below.                                                      
      totuflux(0) = totuflux(0) * fluxfac                                        
      totdflux(0) = totdflux(0) * fluxfac                                        
      fnet(0) = totuflux(0) - totdflux(0)                                        
      totuclfl(0) = totuclfl(0) * fluxfac                                        
      totdclfl(0) = totdclfl(0) * fluxfac                                        
      fnetc(0) = totuclfl(0) - totdclfl(0)                                       
      clrnttoa = totuclfl(nlayers)                                               
      clrntsrf = totuflux(0) - totdclfl(0)                                       
                                                                                 
      do 7000 lev = 1, nlayers                                                   
         totuflux(lev) = totuflux(lev) * fluxfac                                 
         totdflux(lev) = totdflux(lev) * fluxfac                                 
         fnet(lev) = totuflux(lev) - totdflux(lev)                               
         totuclfl(lev) = totuclfl(lev) * fluxfac                                 
         totdclfl(lev) = totdclfl(lev) * fluxfac                                 
         fnetc(lev) = totuclfl(lev) - totdclfl(lev)                              
         l = lev - 1                                                             
!     calculate heating rates.                                                   
         htr(l) = heatfac * (fnet(l) - fnet(lev)) / (pz(l) - pz(lev))            
         htrc(l) = heatfac * (fnetc(l) - fnetc(lev)) / (pz(l) - pz(lev))         
 7000 continue                                                                   
      htr(nlayers) = 0.0                                                         
      htrc(nlayers) = 0.0                                                        
                                                                                 

      end  subroutine rtrn

!---------------------------------------------------------------------------
      subroutine gasabs(kts,ktep1,                                         &
                        coldry,colh2o,colco2,colo3,coln2o,colch4,          &
                        colo2,co2mult,                                     &
                        fac00,fac01,fac10,fac11,                           &
                        forfac,selffac,selffrac,                           &
                        jp,jt,jt1,indself,itr,wx,pfrac,taug,               &
                        laytrop,layswtch,laylow                            )
!---------------------------------------------------------------------------
!  rrtm longwave radiative transfer model                                        
!  atmospheric and environmental research, inc., cambridge, ma                   
!                                                                                
!  original version:       e. j. mlawer, et al.                                  
!  revision for ncar ccm:  michael j. iacono; september, 1998                    
!                                                                                
!  this routine calculates the gaseous optical depths for all 16 longwave        
!  spectral bands.  the optical depths are used to define the pade               
!  approximation to the function of tau transition from tranparancy to           
!  opacity.  this function, which varies from 0 to 1, is converted to an         
!  integer that will serve as an index for the lookup tables of tau              
!  transition function and transmittance used in the radiative transfer.         
!  these lookup tables are created on initialization in routine rrtminit.        
!---------------------------------------------------------------------------
!                                                                                
! definitions                                                                    
!    ngpt                         ! total number of g-point subintervals         
!    mxlay                        ! maximum number of model layers               
!    secang                       ! diffusivity angle for flux computation       
!    tau(ngpt,mxlay)              ! gaseous optical depths                       
!    nlayers                      ! number of model layers used in rrtm          
!    pavel(mxlay)                 ! model layer pressures (mb)                   
!    pz(0:mxlay)                  ! model level (interface) pressures (mb)       
!    tavel(mxlay)                 ! model layer temperatures (k)                 
!    tz(0:mxlay)                  ! model level (interface) temperatures (k)     
!    tbound                       ! surface temperature (k)                      
!    bpade                        ! pade approximation constant (=1./0.278)      
!    itr(ngpt,mxlay)              ! integer lookup table index                   
!                                                                                
! parameters                                                                     
      real, parameter :: secang=1.66                                                    

      integer, intent(in )   ::  kts,ktep1
      integer, intent(in )   ::  laytrop,layswtch,laylow

      real, dimension( ngpt,kts:ktep1 ),                  &
            intent(inout)        ::                pfrac

      real, dimension( ngpt,kts:ktep1 ),                  &
            intent(inout)        ::                 taug

      real, dimension( maxxsec,kts:ktep1 ),               &
            intent(in   )        ::                   wx

      integer, dimension( ngpt,kts:ktep1 ),               &
               intent(inout)  ::                     itr

      real, dimension( kts:ktep1 ), intent(in   ) ::      &
                                                  coldry, &  
                                                  colh2o, &
                                                  colco2, &
                                                   colo3, &
                                                  coln2o, &
                                                  colch4, &
                                                   colo2, &
                                                 co2mult, &
                                                   fac00, &
                                                   fac01, &
                                                   fac10, &
                                                   fac11, &
                                                  forfac, &
                                                 selffac, &
                                                selffrac
 
      integer, dimension( kts:ktep1 ), intent(inout) ::   &
                                                      jp, &
                                                      jt, &
                                                     jt1, &
                                                 indself

! this compiler directive was added to insure private common block storage       
! in multi-tasked mode on a cray or sgi for all commons except those that        
! carry constants.                                                               
                                                                                 
! **************************************************************************     

!  calculate optical depth for each band                                         
     
      call taugb1(kts,ktep1,colh2o,fac00,fac01,fac10,fac11,              &
                  forfac,selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,  &
                  laytrop)
      call taugb2(kts,ktep1,coldry,colh2o,fac00,fac01,fac10,fac11,       &
                  forfac,selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,  &
                  laytrop)
      call taugb3(kts,ktep1,colh2o,colco2,coln2o,fac00,fac01,fac10,fac11,&
                  forfac,selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,  &
                  laytrop)
      call taugb4(kts,ktep1,colh2o,colco2,colo3,fac00,fac01,fac10,fac11, &
                  selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,         &
                  laytrop)
      call taugb5(kts,ktep1,colh2o,colco2,colo3,fac00,fac01,fac10,fac11, &
                  selffac,selffrac,jp,jt,jt1,indself,wx,pfrac,taug,      &
                  laytrop)
      call taugb6(kts,ktep1,colh2o,co2mult,fac00,fac01,fac10,fac11,      &
                  selffac,selffrac,jp,jt,jt1,indself,wx,pfrac,taug,      &
                  laytrop)
      call taugb7(kts,ktep1,colh2o,colo3,co2mult,fac00,fac01,fac10,fac11,&
                  selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,         &
                  laytrop)
      call taugb8(kts,ktep1,colh2o,colo3,coln2o,co2mult,fac00,fac01,fac10,&
                  fac11,selffac,selffrac,jp,jt,jt1,indself,wx,pfrac,taug,&
                  layswtch)
      call taugb9(kts,ktep1,colh2o,coln2o,colch4,fac00,fac01,fac10,fac11,&
                  selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,         &
                  laytrop,layswtch,laylow)
      call taugb10(kts,ktep1,colh2o,fac00,fac01,fac10,fac11,jp,jt,jt1,&
                  pfrac,taug,laytrop)
      call taugb11(kts,ktep1,colh2o,fac00,fac01,fac10,fac11,             &
                  selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,         &
                  laytrop)
      call taugb12(kts,ktep1,colh2o,colco2,fac00,fac01,fac10,fac11,      &
                  selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,         &
                  laytrop)
      call taugb13(kts,ktep1,colh2o,coln2o,fac00,fac01,fac10,fac11,      &
                  selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,         &
                  laytrop)
      call taugb14(kts,ktep1,colco2,fac00,fac01,fac10,fac11,             &
                  selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,         &
                  laytrop)
      call taugb15(kts,ktep1,colh2o,colco2,coln2o,fac00,fac01,fac10,fac11,&
                  selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,         &
                  laytrop)
      call taugb16(kts,ktep1,colh2o,colch4,fac00,fac01,fac10,fac11,      &
                  selffac,selffrac,jp,jt,jt1,indself,pfrac,taug,         &
                  laytrop)
                                                                                 
!  compute the lookup table index from the pade approximation of the             
!  tau transition function, which is derived from the optical depth.             
                                                                                 
      do 6000 lay = 1, nlayers                                                   
         do 5000 ipr = 1, ngpt                                                   
            odepth = secang * taug(ipr,lay)                                       
            tff = odepth/(bpade+odepth)                                           
            if (odepth.le.0.) tff=0.                                              
            itr(ipr,lay) = int(5.e3*tff+0.5)
 5000    continue                                                                
 6000 continue                                                                   
      
   end subroutine gasabs

!====================================================================
   subroutine rrtminit(rthraten,rthratenlw,cldfra,restart,          &
                       ids, ide, jds, jde, kds, kde,                &
                       ims, ime, jms, jme, kms, kme,                &
                       its, ite, jts, jte, kts, kte                 )
!--------------------------------------------------------------------
   implicit none
!--------------------------------------------------------------------

   logical , intent(in)           :: restart
   integer , intent(in)           :: ids, ide, jds, jde, kds, kde,  &
                                     ims, ime, jms, jme, kms, kme,  &
                                     its, ite, jts, jte, kts, kte

   real , dimension( ims:ime , kms:kme , jms:jme ) , intent(inout) ::        &
                                                          rthraten, &
                                                        rthratenlw, &
                                                            cldfra
   real :: pi

   integer :: i, j, k, itf, jtf, ktf

   !jtf=min0(jte,jde-1)
   !ktf=min0(kte,kde-1)
   !itf=min0(ite,ide-1)

   !if(.not.restart)then
   !  do j=jts,jtf
   !  do k=kts,ktf
   !  do i=its,itf
        rthraten  = 0.
        rthratenlw= 0.
        cldfra    = 0.
   !  enddo
   !  enddo
   !  enddo
   !endif

   pi = 2.*asin(1.) 
   fluxfac  = pi   * 2.d4                     
   nlayers = kme

   call rrtm_lookuptable

   end subroutine rrtminit


! **************************************************************************     
      subroutine rrtm_lookuptable
! zhangyi notes: for not using module_dm, we let every node real the binary
! data for the time being, in future, we will use our own bcast function
! such that only the master node will read the data
! changes: all .true. to .true. 
!          comment all bcast
! **************************************************************************     

!use module_wrf_error
use grist_handle_error, only: endrun
use grist_mpi
!use module_dm

!  rrtm longwave radiative transfer model                                        
!  atmospheric and environmental research, inc., cambridge, ma                   
!                                                                                
!  original version:       michael j. iacono; july, 1998                         
!  revision for ncar ccm:  michael j. iacono; september, 1998                    
!                                                                                
!  this subroutine performs calculations necessary for the initialization        
!  of the lw model, rrtm.  lookup tables are computed for use in the lw          
!  radiative transfer, and input absorption coefficient data for each            
!  spectral band are reduced from 256 g-points to 140 for use in rrtm.           
! **************************************************************************     
                                                                                 
! definitions                                                                    
!     arrays for 5000-point look-up tables:                                      
!     tau     clear-sky optical depth (used in cloudy radiative transfer)        
!     tf      tau transition function; i.e. the transition of the planck         
!             function from that for the mean layer temperature to that for      
!             the layer boundary temperature as a function of optical depth.     
!             the "linear in tau" method is used to make the table.              
!     trans   transmittance                                                      
!     bpade   inverse of the pade approximation constant (= 1./0.278)            

! local                                         
      logical                 :: opened
      logical , external      :: wrf_dm_on_monitor

      dimension wtsm(mg)                       
      character*80 errmess
      integer rrtm_unit
      integer :: comm, ierr, RWORDSIZE

      comm = MPI_COMM_WORLD
      RWORDSIZE = 4

      if ( .true. ) then
        do i = 10,99
          inquire ( i , opened = opened )
          if ( .not. opened ) then
            rrtm_unit = i
            goto 2010
          endif
        enddo
        rrtm_unit = -1
 2010   continue
      endif
      !call wrf_dm_bcast_bytes ( rrtm_unit , iwordsize )
      if ( rrtm_unit < 0 ) then
        call endrun ( 'module_ra_rrtm: rrtm_lookuptable: can not find unused fortran unit to read in lookup table.' )
      endif

! start data 1

! **************************************************************************     
!  rrtm longwave radiative transfer model                                        
!  atmospheric and environmental research, inc., cambridge, ma                   
!                                                                                
!  original version:       e. j. mlawer, et al.                                  
!  revision for ncar ccm:  michael j. iacono; september, 1998                    
!                                                                                
!  this routine contains 16 read statements that include the                
!  absorption coefficients and other data for each of the 16 longwave            
!  spectral bands used in rrtm.  here, the data are defined for 16               
!  g-points, or sub-intervals, per band.  these data are combined and            
!  weighted using a mapping procedure in routine rrtminit to reduce              
!  the total number of g-points from 256 to 140 for use in the ccm.              
! **************************************************************************     
        if ( mpi_rank().eq.0 ) then
          open(rrtm_unit,file='RRTM_DATA',                  &
               form='unformatted',status='old',err=9010)
        endif
                                                                                 
!     the array abscoefl1 contains absorption coefs at the 16 chosen g-values   
!     for a range of pressure levels > ~100mb and temperatures.  the first       
!     index in the array, jt, which runs from 1 to 5, corresponds to     
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the corresponding tref for this  pressure level,              
!     jt = 2 refers to the temperaturetref-15, jt = 1 is for tref-30,            
!     jt = 4 is for tref+15, and jt = 5 is for tref+30.  the second              
!     index, jp, runs from 1 to 13 and refers to the corresponding               
!     pressure level in pref (e.g. jp = 1 is for a pressure of 1053.63 mb).      
!     the third index, ig, goes from 1 to 16, and tells us which                 
!     g-interval the absorption coefficients are for.                            


                                                                                 
!     the array abscoefh1 contains absorption coefs at the 16 chosen g-values           
!     for a range of pressure levels < ~100mb and temperatures. the first        
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the reference temperature tref for this pressure              
!     level, jt = 2 refers to the temperature tref-15, jt = 1 is for             
!     tref-30, jt = 4 is for tref+15, and jt = 5 is for tref+30.                 
!     the second index, jp, runs from 13 to 59 and refers to the jpth            
!     reference pressure level (see taumol.f for the value of these              
!     pressure levels in mb).  the third index, ig, goes from 1 to 16, &        
!     and tells us which g-interval the absorption coefficients are for.         

                                                                                 
!     the array selfref1 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

#define dm_bcast_macro(a) call wrf_dm_bcast_bytes ( a , size ( a ) * rwordsize )

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl1, abscoefh1, selfref1
         !dm_bcast_macro(abscoefl1)
         !dm_bcast_macro(abscoefh1)
         !dm_bcast_macro(selfref1)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl1_r4, abscoefh1_r4, selfref1_r4
         call mpi_bcast(abscoefl1_r4 , size(abscoefl1_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh1_r4 , size(abscoefh1_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref1_r4  , size(selfref1_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl1 = abscoefl1_r4
         abscoefh1 = abscoefh1_r4
         selfref1  = selfref1_r4

! **************************************************************************     
!     the array abscoefl2 contains absorption coefs at the 16 chosen g-values 
!     for a range of pressure levels > ~100mb and temperatures.  the first       
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the corresponding tref for this  pressure level, &           
!     jt = 2 refers to the temperaturetref-15, jt = 1 is for tref-30, &         
!     jt = 4 is for tref+15, and jt = 5 is for tref+30.  the second              
!     index, jp, runs from 1 to 13 and refers to the corresponding               
!     pressure level in pref (e.g. jp = 1 is for a pressure of 1053.63 mb).      
!     the third index, ig, goes from 1 to 16, and tells us which                 
!     g-interval the absorption coefficients are for.                            

                                                                                 
!     the array abscoefh2 contains absorption coefs at the 16 chosen g-values           
!     for a range of pressure levels < ~100mb and temperatures. the first        
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the reference temperature tref for this pressure              
!     level, jt = 2 refers to the temperature tref-15, jt = 1 is for             
!     tref-30, jt = 4 is for tref+15, and jt = 5 is for tref+30.                 
!     the second index, jp, runs from 13 to 59 and refers to the jpth            
!     reference pressure level (see taumol.f for the value of these              
!     pressure levels in mb).  the third index, ig, goes from 1 to 16, &        
!     and tells us which g-interval the absorption coefficients are for.         

                                                                                 
!     the array selfref2 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl2, abscoefh2, selfref2
         !dm_bcast_macro(abscoefl2)
         !dm_bcast_macro(abscoefh2)
         !dm_bcast_macro(selfref2)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl2_r4, abscoefh2_r4, selfref2_r4
         call mpi_bcast(abscoefl2_r4, size(abscoefl2_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh2_r4, size(abscoefh2_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref2_r4 , size(selfref2_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl2 = abscoefl2_r4
         abscoefh2 = abscoefh2_r4
         selfref2  = selfref2_r4
                                                                                 
! **************************************************************************     

!     the array abscoefl3 contains absorption coefs for each of the 16 g-intervals   
!     for a range of pressure levels > ~100mb, temperatures, and ratios          
!     of water vapor to co2.  the first index in the array, js, runs             
!     from 1 to 10, and corresponds to different water vapor to co2 ratios, &   
!     as expressed through the binary species parameter eta, defined as          
!     eta = h2o/(h20 + (rat) * co2), where rat is the ratio of the integrated    
!     line strength in the band of co2 to that of h2o.  for instance, &         
!     js=1 refers to dry air (eta = 0), js = 10 corresponds to eta = 1.0.        
!     the 2nd index in the array, jt, which runs from 1 to 5, corresponds        
!     to different temperatures.  more specifically, jt = 3 means that the       
!     data are for the reference temperature tref for this  pressure             
!     level, jt = 2 refers to the temperature                                    
!     tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and jt = 5          
!     is for tref+30.  the third index, jp, runs from 1 to 13 and refers         
!     to the reference pressure level (e.g. jp = 1 is for a                      
!     pressure of 1053.63 mb).  the fourth index, ig, goes from 1 to 16, &      
!     and tells us which g-interval the absorption coefficients are for.         

                                                                                 
!     the array abscoefh3 contains absorption coefs for each of the 16 g-intervals      
!     for a range of pressure levels  < ~100mb, temperatures, and ratios         
!     of h2o to co2.  the first index in the array, js, runs from 1 to 5, &     
!     and corresponds to different h2o to co2 ratios, as expressed through       
!     the binary species parameter eta, defined as eta = h2o/(h2o+rat*co2), &   
!     where rat is the ratio of the integrated line strength in the band         
!     of co2 to that of h2o.  for instance, js=1 refers to no h2o, &            
!     js = 2 corresponds to eta = 0.25, etc.  the second index, jt, which        
!     runs from 1 to 5, corresponds to different temperatures.  more             
!     specifically, jt = 3 means that the data are for the corresponding         
!     reference temperature tref for this  pressure level, jt = 2 refers         
!     to the tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and          
!     jt = 5 is for tref+30.  the third index, jp, runs from 13 to 59 and        
!     refers to the corresponding pressure level in pref (e.g. jp = 13 is        
!     for a pressure of 95.5835 mb).  the fourth index, ig, goes from 1 to       
!     16, and tells us which g-interval the absorption coefficients are for.     

                                                                                 
!     the array selfref3 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl3, abscoefh3, selfref3
         !dm_bcast_macro(abscoefl3)
         !dm_bcast_macro(abscoefh3)
         !dm_bcast_macro(selfref3)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl3_r4, abscoefh3_r4, selfref3_r4
         call mpi_bcast(abscoefl3_r4 , size(abscoefl3_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh3_r4 , size(abscoefh3_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref3_r4  , size(selfref3_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl3 = abscoefl3_r4
         abscoefh3 = abscoefh3_r4
         selfref3  = selfref3_r4
                                                                                 
! **************************************************************************     
                                                                                 
!     the array abscoefl4 contains absorption coefs for each of the 16 g-intervals      
!     for a range of pressure levels > ~100mb, temperatures, and ratios          
!     of water vapor to co2.  the first index in the array, js, runs             
!     from 1 to 9 and corresponds to different water vapor to co2 ratios, &     
!     as expressed through the binary species parameter eta, defined as          
!     eta = h2o/(h20 + (rat) * co2), where rat is the ratio of the integrated    
!     line strength in the band of co2 to that of h2o.  for instance, &         
!     js=1 refers to dry air (eta = 0), js = 9 corresponds to eta = 1.0.         
!     the 2nd index in the array, jt, which runs from 1 to 5, corresponds        
!     to different temperatures.  more specifically, jt = 3 means that the       
!     data are for the reference temperature tref for this pressure              
!     level, jt = 2 refers to the temperature tref-15, &                        
!     jt = 1 is for tref-30, jt = 4 is for tref+15, and jt = 5                   
!     is for tref+30.  the third index, jp, runs from 1 to 13 and refers         
!     to the reference pressure level (e.g. jp = 1 is for a                      
!     pressure of 1053.63 mb).  the fourth index, ig, goes from 1 to 16, &      
!     and tells us which g-interval the absorption coefficients are for.         

                                                                                 
!     the array abscoefh4 contains absorption coefs for each of the 16 g-intervals      
!     for a range of pressure levels  < ~100mb, temperatures, and ratios         
!     of o3 to co2.  the first index in the array, js, runs from 1 to 6, &      
!     and corresponds to different o3 to co2 ratios, as expressed through        
!     the binary species parameter eta, defined as eta = o3/(o3+rat*h2o), &     
!     where rat is the ratio of the integrated line strength in the band         
!     of co2 to that of o3.  for instance, js=1 refers to no o3 (eta = 0)        
!     and js = 5 corresponds to eta = 1.0.  the second index, jt, which          
!     runs from 1 to 5, corresponds to different temperatures.  more             
!     specifically, jt = 3 means that the data are for the corresponding         
!     reference temperature tref for this  pressure level, jt = 2 refers         
!     to the tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and          
!     jt = 5 is for tref+30.  the third index, jp, runs from 13 to 59 and        
!     refers to the corresponding pressure level in pref (e.g. jp = 13 is        
!     for a pressure of 95.5835 mb).  the fourth index, ig, goes from 1 to       
!     16, and tells us which g-interval the absorption coefficients are for.     

                                                                                 
!     the array selfref4 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl4, abscoefh4, selfref4
         !dm_bcast_macro(abscoefl4)
         !dm_bcast_macro(abscoefh4)
         !dm_bcast_macro(selfref4)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl4_r4, abscoefh4_r4, selfref4_r4
         call mpi_bcast(abscoefl4_r4 , size(abscoefl4_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh4_r4 , size(abscoefh4_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref4_r4  , size(selfref4_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl4 = abscoefl4_r4
         abscoefh4 = abscoefh4_r4
         selfref4  = selfref4_r4
                                                                                 
! **************************************************************************     
                                                                                 
!     the array abscoefl5 contains absorption coefs for each of the 16 g-intervals
!     for a range of pressure levels > ~100mb, temperatures, and ratios          
!     of water vapor to co2.  the first index in the array, js, runs             
!     from 1 to 9 and corresponds to different water vapor to co2 ratios, &     
!     as expressed through the binary species parameter eta, defined as          
!     eta = h2o/(h20 + (rat) * co2), where rat is the ratio of the integrated    
!     line strength in the band of co2 to that of h2o.  for instance, &         
!     js=1 refers to dry air (eta = 0), js = 9 corresponds to eta = 1.0.         
!     the 2nd index in the array, jt, which runs from 1 to 5, corresponds        
!     to different temperatures.  more specifically, jt = 3 means that the       
!     data are for the reference temperature tref for this  pressure             
!     level, jt = 2 refers to the temperature tref-15, &                        
!     jt = 1 is for tref-30, jt = 4 is for tref+15, and jt = 5                   
!     is for tref+30.  the third index, jp, runs from 1 to 13 and refers         
!     to the reference pressure level (e.g. jp = 1 is for a                      
!     pressure of 1053.63 mb).  the fourth index, ig, goes from 1 to 16, &      
!     and tells us which g-interval the absorption coefficients are for.         

                                                                                 
!     the array abscoefh5 contains absorption coefs for each of the 16 g-intervals      
!     for a range of pressure levels  < ~100mb, temperatures, and ratios         
!     of o3 to co2.  the first index in the array, js, runs from 1 to 5, &      
!     and corresponds to different o3 to co2 ratios, as expressed through        
!     the binary species parameter eta, defined as eta = o3/(o3+rat*co2), &     
!     where rat is the ratio of the integrated line strength in the band         
!     of co2 to that of o3.  for instance, js=1 refers to no o3 (eta = 0)        
!     and js = 5 corresponds to eta = 1.0.  the second index, jt, which          
!     runs from 1 to 5, corresponds to different temperatures.  more             
!     specifically, jt = 3 means that the data are for the corresponding         
!     reference temperature tref for this  pressure level, jt = 2 refers         
!     to the tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and          
!     jt = 5 is for tref+30.  the third index, jp, runs from 13 to 59 and        
!     refers to the corresponding pressure level in pref (e.g. jp = 13 is        
!     for a pressure of 95.5835 mb).  the fourth index, ig, goes from 1 to       
!     16, and tells us which g-interval the absorption coefficients are for.     

                                                                                 
!     the array selfref5 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl5, abscoefh5, selfref5
         !dm_bcast_macro(abscoefl5)
         !dm_bcast_macro(abscoefh5)
         !dm_bcast_macro(selfref5)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl5_r4, abscoefh5_r4, selfref5_r4
         call mpi_bcast(abscoefl5_r4 , size(abscoefl5_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh5_r4 , size(abscoefh5_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref5_r4  , size(selfref5_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl5 = abscoefl5_r4
         abscoefh5 = abscoefh5_r4
         selfref5  = selfref5_r4
                                                                                 
! **************************************************************************     
                                                                                 
!     the array abscoefl6 contains absorption coefs at the 16 chosen g-values    
!     for a range of pressure levels > ~100mb and temperatures.  the first       
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the corresponding tref for this  pressure level, &           
!     jt = 2 refers to the temperaturetref-15, jt = 1 is for tref-30, &         
!     jt = 4 is for tref+15, and jt = 5 is for tref+30.  the second              
!     index, jp, runs from 1 to 13 and refers to the corresponding               
!     pressure level in pref (e.g. jp = 1 is for a pressure of 1053.63 mb).      
!     the third index, ig, goes from 1 to 16, and tells us which                 
!     g-interval the absorption coefficients are for.                            

                                                                                 
!     the array selfref6 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl6, selfref6
         !dm_bcast_macro(abscoefl6)
         !dm_bcast_macro(selfref6)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl6_r4, selfref6_r4
         call mpi_bcast(abscoefl6_r4 , size(abscoefl6_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref6_r4  , size(selfref6_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl6 = abscoefl6_r4
         selfref6  = selfref6_r4
                                                                                 
! **************************************************************************     
                                                                                 
!     the array abscoefl7 contains absorption coefs at the 16 chosen g-values           
!     for a range of pressure levels> ~100mb, temperatures, and binary           
!     species parameters (see taumol.f for definition).  the first               
!     index in the array, js, runs from 1 to 9, and corresponds to               
!     different values of the binary species parameter.  for instance, &        
!     js=1 refers to dry air, js = 2 corresponds to the paramter value 1/8, &   
!     js = 3 corresponds to the parameter value 2/8, etc.  the second index      
!     in the array, jt, which runs from 1 to 5, corresponds to different         
!     temperatures.  more specifically, jt = 3 means that the data are for       
!     the reference temperature tref for this  pressure level, jt = 2 refers     
!     to tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and jt = 5       
!     is for tref+30.  the third index, jp, runs from 1 to 13 and refers         
!     to the jpth reference pressure level (see taumol.f for these levels        
!     in mb).  the fourth index, ig, goes from 1 to 16, and indicates            
!     which g-interval the absorption coefficients are for.                      

                                                                                 
!     the array abscoefh7 contains absorption coefs at the 16 chosen g-values           
!     for a range of pressure levels < ~100mb and temperatures. the first        
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the reference temperature tref for this pressure              
!     level, jt = 2 refers to the temperature tref-15, jt = 1 is for             
!     tref-30, jt = 4 is for tref+15, and jt = 5 is for tref+30.                 
!     the second index, jp, runs from 13 to 59 and refers to the jpth            
!     reference pressure level (see taumol.f for the value of these              
!     pressure levels in mb).  the third index, ig, goes from 1 to 16, &        
!     and tells us which g-interval the absorption coefficients are for.         

                                                                                 
!     the array selfref7 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl7, abscoefh7, selfref7
         !dm_bcast_macro(abscoefl7)
         !dm_bcast_macro(abscoefh7)
         !dm_bcast_macro(selfref7)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl7_r4, abscoefh7_r4, selfref7_r4
         call mpi_bcast(abscoefl7_r4 , size(abscoefl7_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh7_r4 , size(abscoefh7_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref7_r4  , size(selfref7_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl7 = abscoefl7_r4
         abscoefh7 = abscoefh7_r4
         selfref7  = selfref7_r4
                                                                                 
! **************************************************************************
                                                                                 
!     the array abscoefl8 contains absorption coefs at the 16 chosen g-values    
!     for a range of pressure levels > ~100mb and temperatures.  the first       
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the corresponding tref for this  pressure level, &           
!     jt = 2 refers to the temperaturetref-15, jt = 1 is for tref-30, &         
!     jt = 4 is for tref+15, and jt = 5 is for tref+30.  the second              
!     index, jp, runs from 1 to 13 and refers to the corresponding               
!     pressure level in pref (e.g. jp = 1 is for a pressure of 1053.63 mb).      
!     the third index, ig, goes from 1 to 16, and tells us which                 
!     g-interval the absorption coefficients are for.                            
!     the array abscoefl8 contains absorption coef5s at the 16 chosen g-values          
!     for a range of pressure levels > ~100mb and temperatures.  the first       
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the cooresponding tref for this  pressure level, &           
!     jt = 2 refers to the temperature                                           
!     tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and jt = 5          
!     is for tref+30.  the second index, jp, runs from 1 to 13 and refers        
!     to the corresponding pressure level in pref (e.g. jp = 1 is for a          
!     pressure of 1053.63 mb).  the third index, ig, goes from 1 to 16, &       
!     and tells us which "g-channel" the absorption coefficients are for.        

                                                                                 
!     the array abscoefh8 contains absorption coefs at the 16 chosen g-values           
!     for a range of pressure levels < ~100mb and temperatures. the first        
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the reference temperature tref for this pressure              
!     level, jt = 2 refers to the temperature tref-15, jt = 1 is for             
!     tref-30, jt = 4 is for tref+15, and jt = 5 is for tref+30.                 
!     the second index, jp, runs from 13 to 59 and refers to the jpth            
!     reference pressure level (see taumol.f for the value of these              
!     pressure levels in mb).  the third index, ig, goes from 1 to 16, &        
!     and tells us which g-interval the absorption coefficients are for.         

!                                                                                
!       selfref8 is the array for the self-continuum.                                   
!                                                                                
         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl8, abscoefh8, selfref8
         !dm_bcast_macro(abscoefl8)
         !dm_bcast_macro(abscoefh8)
         !dm_bcast_macro(selfref8)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl8_r4, abscoefh8_r4, selfref8_r4
         call mpi_bcast(abscoefl8_r4 , size(abscoefl8_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh8_r4 , size(abscoefh8_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref8_r4  , size(selfref8_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl8 = abscoefl8_r4
         abscoefh8 = abscoefh8_r4
         selfref8  = selfref8_r4
                                                                                 
! **************************************************************************
                                                                                 
!     the array abscoefl9 contains absorption coefs at the 16 chosen g-values    
!     for a range of pressure levels> ~100mb, temperatures, and binary           
!     species parameters (see taumol.f for definition).  the first               
!     index in the array, js, runs from 1 to 11, and corresponds to              
!     different values of the binary species parameter.  for instance, &        
!     js=1 refers to dry air, js = 2 corresponds to the paramter value 1/8, &   
!     js = 3 corresponds to the parameter value 2/8, etc.  the second index      
!     in the array, jt, which runs from 1 to 5, corresponds to different         
!     temperatures.  more specifically, jt = 3 means that the data are for       
!     the reference temperature tref for this  pressure level, jt = 2 refers     
!     to tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and jt = 5       
!     is for tref+30.  the third index, jp, runs from 1 to 13 and refers         
!     to the jpth reference pressure level (see taumol.f for these levels        
!     in mb).  the fourth index, ig, goes from 1 to 16, and indicates            
!     which g-interval the absorption coefficients are for.                      

                                                                                 
!     the array abscoefh9 contains absorption coefs at the 16 chosen g-values           
!     for a range of pressure levels < ~100mb and temperatures. the first        
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the reference temperature tref for this pressure              
!     level, jt = 2 refers to the temperature tref-15, jt = 1 is for             
!     tref-30, jt = 4 is for tref+15, and jt = 5 is for tref+30.                 
!     the second index, jp, runs from 13 to 59 and refers to the jpth            
!     reference pressure level (see taumol.f for the value of these              
!     pressure levels in mb).  the third index, ig, goes from 1 to 16, &        
!     and tells us which g-interval the absorption coefficients are for.         

                                                                                 
!     the array selfref9 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl9, abscoefh9, selfref9
         !dm_bcast_macro(abscoefl9)
         !dm_bcast_macro(abscoefh9)
         !dm_bcast_macro(selfref9)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl9_r4, abscoefh9_r4, selfref9_r4
         call mpi_bcast(abscoefl9_r4 , size(abscoefl9_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh9_r4 , size(abscoefh9_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref9_r4  , size(selfref9_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl9 = abscoefl9_r4
         abscoefh9 = abscoefh9_r4
         selfref9  = selfref9_r4
                                                                                 
! **************************************************************************
                                                                                 
!     the array abscoefl10 contains absorption coefs at the 16 chosen g-values   
!     for a range of pressure levels > ~100mb and temperatures.  the first       
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the corresponding tref for this  pressure level, &           
!     jt = 2 refers to the temperaturetref-15, jt = 1 is for tref-30, &         
!     jt = 4 is for tref+15, and jt = 5 is for tref+30.  the second              
!     index, jp, runs from 1 to 13 and refers to the corresponding               
!     pressure level in pref (e.g. jp = 1 is for a pressure of 1053.63 mb).      
!     the third index, ig, goes from 1 to 16, and tells us which                 
!     g-interval the absorption coefficients are for.                            

                                                                                 
!     the array abscoefh10 contains absorption coefs at the 16 chosen g-values           
!     for a range of pressure levels < ~100mb and temperatures. the first        
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the reference temperature tref for this pressure              
!     level, jt = 2 refers to the temperature tref-15, jt = 1 is for             
!     tref-30, jt = 4 is for tref+15, and jt = 5 is for tref+30.                 
!     the second index, jp, runs from 13 to 59 and refers to the jpth            
!     reference pressure level (see taumol.f for the value of these              
!     pressure levels in mb).  the third index, ig, goes from 1 to 16, &        
!     and tells us which g-interval the absorption coefficients are for.         

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl10, abscoefh10
         !dm_bcast_macro(abscoefl10)
         !dm_bcast_macro(abscoefh10)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl10_r4, abscoefh10_r4
         call mpi_bcast(abscoefl10_r4 , size(abscoefl10_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh10_r4 , size(abscoefh10_r4), MPI_REAL8, 0, comm,ierr)
         abscoefl10 = abscoefl10_r4
         abscoefh10 = abscoefh10_r4
                                                                                 
! **************************************************************************
                                                                                 
!     the array abscoefl11 contains absorption coefs at the 16 chosen g-values   
!     for a range of pressure levels > ~100mb and temperatures.  the first       
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the corresponding tref for this  pressure level, &           
!     jt = 2 refers to the temperaturetref-15, jt = 1 is for tref-30, &         
!     jt = 4 is for tref+15, and jt = 5 is for tref+30.  the second              
!     index, jp, runs from 1 to 13 and refers to the corresponding               
!     pressure level in pref (e.g. jp = 1 is for a pressure of 1053.63 mb).      
!     the third index, ig, goes from 1 to 16, and tells us which                 
!     g-interval the absorption coefficients are for.                            

                                                                                 
!     the array abscoefh11 contains absorption coefs at the 16 chosen g-values           
!     for a range of pressure levels < ~100mb and temperatures. the first        
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the reference temperature tref for this pressure              
!     level, jt = 2 refers to the temperature tref-15, jt = 1 is for             
!     tref-30, jt = 4 is for tref+15, and jt = 5 is for tref+30.                 
!     the second index, jp, runs from 13 to 59 and refers to the jpth            
!     reference pressure level (see taumol.f for the value of these              
!     pressure levels in mb).  the third index, ig, goes from 1 to 16, &        
!     and tells us which g-interval the absorption coefficients are for.         

                                                                                 
!     the array selfref11 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl11, abscoefh11, selfref11
         !dm_bcast_macro(abscoefl11)
         !dm_bcast_macro(abscoefh11)
         !dm_bcast_macro(selfref11)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl11_r4, abscoefh11_r4, selfref11_r4
         call mpi_bcast(abscoefl11_r4 , size(abscoefl11_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh11_r4 , size(abscoefh11_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref11_r4  , size(selfref11_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl11 = abscoefl11_r4
         abscoefh11 = abscoefh11_r4
         selfref11  = selfref11_r4
                                                                                        
! **************************************************************************
                                                                                 
!     the array abscoefl12 contains absorption coefs at the 16 chosen g-values   
!     for a range of pressure levels> ~100mb, temperatures, and binary           
!     species parameters (see taumol.f for definition).  the first               
!     index in the array, js, runs from 1 to 9, and corresponds to               
!     different values of the binary species parameter.  for instance, &        
!     js=1 refers to dry air, js = 2 corresponds to the paramter value 1/8, &   
!     js = 3 corresponds to the parameter value 2/8, etc.  the second index      
!     in the array, jt, which runs from 1 to 5, corresponds to different         
!     temperatures.  more specifically, jt = 3 means that the data are for       
!     the reference temperature tref for this  pressure level, jt = 2 refers     
!     to tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and jt = 5       
!     is for tref+30.  the third index, jp, runs from 1 to 13 and refers         
!     to the jpth reference pressure level (see taumol.f for these levels        
!     in mb).  the fourth index, ig, goes from 1 to 16, and indicates            
!     which g-interval the absorption coefficients are for.                      

                                                                                 
!     the array selfref12 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl12, selfref12
         !dm_bcast_macro(abscoefl12)
         !dm_bcast_macro(selfref12)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl12_r4, selfref12_r4
         call mpi_bcast(abscoefl12_r4 , size(abscoefl12_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref12_r4  , size(selfref12_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl12 = abscoefl12_r4
         selfref12  = selfref12_r4
                                                                                 
! **************************************************************************
                                                                                 
!     the array abscoefl13 contains absorption coefs at the 16 chosen g-values   
!     for a range of pressure levels> ~100mb, temperatures, and binary           
!     species parameters (see taumol.f for definition).  the first               
!     index in the array, js, runs from 1 to 9, and corresponds to               
!     different values of the binary species parameter.  for instance, &        
!     js=1 refers to dry air, js = 2 corresponds to the paramter value 1/8, &   
!     js = 3 corresponds to the parameter value 2/8, etc.  the second index      
!     in the array, jt, which runs from 1 to 5, corresponds to different         
!     temperatures.  more specifically, jt = 3 means that the data are for       
!     the reference temperature tref for this  pressure level, jt = 2 refers     
!     to tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and jt = 5       
!     is for tref+30.  the third index, jp, runs from 1 to 13 and refers         
!     to the jpth reference pressure level (see taumol.f for these levels        
!     in mb).  the fourth index, ig, goes from 1 to 16, and indicates            
!     which g-interval the absorption coefficients are for.                      

                                                                                 
!     the array selfref13 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl13, selfref13
         !dm_bcast_macro(abscoefl13)
         !dm_bcast_macro(selfref13)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl13_r4, selfref13_r4
         call mpi_bcast(abscoefl13_r4 , size(abscoefl13_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref13_r4  , size(selfref13_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl13 = abscoefl13_r4
         selfref13  = selfref13_r4
                                                                                 
! **************************************************************************
                                                                                 
!     the array abscoefl14 contains absorption coefs at the 16 chosen g-values   
!     for a range of pressure levels > ~100mb and temperatures.  the first       
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the corresponding tref for this  pressure level, &           
!     jt = 2 refers to the temperaturetref-15, jt = 1 is for tref-30, &         
!     jt = 4 is for tref+15, and jt = 5 is for tref+30.  the second              
!     index, jp, runs from 1 to 13 and refers to the corresponding               
!     pressure level in pref (e.g. jp = 1 is for a pressure of 1053.63 mb).      
!     the third index, ig, goes from 1 to 16, and tells us which                 
!     g-interval the absorption coefficients are for.                            

                                                                                 
!     the array abscoefh14 contains absorption coefs at the 16 chosen g-values           
!     for a range of pressure levels < ~100mb and temperatures. the first        
!     index in the array, jt, which runs from 1 to 5, corresponds to             
!     different temperatures.  more specifically, jt = 3 means that the          
!     data are for the reference temperature tref for this pressure              
!     level, jt = 2 refers to the temperature tref-15, jt = 1 is for             
!     tref-30, jt = 4 is for tref+15, and jt = 5 is for tref+30.                 
!     the second index, jp, runs from 13 to 59 and refers to the jpth            
!     reference pressure level (see taumol.f for the value of these              
!     pressure levels in mb).  the third index, ig, goes from 1 to 16, &        
!     and tells us which g-interval the absorption coefficients are for.         

                                                                                 
!     the array selfref14 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl14, abscoefh14, selfref14
         !dm_bcast_macro(abscoefl14)
         !dm_bcast_macro(abscoefh14)
         !dm_bcast_macro(selfref14)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl14_r4, abscoefh14_r4, selfref14_r4
         call mpi_bcast(abscoefl14_r4 , size(abscoefl14_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(abscoefh14_r4 , size(abscoefh14_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref14_r4  , size(selfref14_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl14 = abscoefl14_r4
         abscoefh14 = abscoefh14_r4
         selfref14  = selfref14_r4
                                                                                        
! **************************************************************************
                                                                                 
!     the array abscoefl15 contains absorption coefs at the 16 chosen g-values   
!     for a range of pressure levels> ~100mb, temperatures, and binary           
!     species parameters (see taumol.f for definition).  the first               
!     index in the array, js, runs from 1 to 9, and corresponds to               
!     different values of the binary species parameter.  for instance, &        
!     js=1 refers to dry air, js = 2 corresponds to the paramter value 1/8, &   
!     js = 3 corresponds to the parameter value 2/8, etc.  the second index      
!     in the array, jt, which runs from 1 to 5, corresponds to different         
!     temperatures.  more specifically, jt = 3 means that the data are for       
!     the reference temperature tref for this  pressure level, jt = 2 refers     
!     to tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and jt = 5       
!     is for tref+30.  the third index, jp, runs from 1 to 13 and refers         
!     to the jpth reference pressure level (see taumol.f for these levels        
!     in mb).  the fourth index, ig, goes from 1 to 16, and indicates            
!     which g-interval the absorption coefficients are for.                      

                                                                                 
!     the array selfref15 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl15, selfref15
         !dm_bcast_macro(abscoefl15)
         !dm_bcast_macro(selfref15)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl15_r4, selfref15_r4
         call mpi_bcast(abscoefl15_r4 , size(abscoefl15_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref15_r4  , size(selfref15_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl15 = abscoefl15_r4
         selfref15  = selfref15_r4
                                                                                 
! **************************************************************************
                                                                                 
!     the array abscoefl16 contains absorption coefs at the 16 chosen g-values  
!     for a range of pressure levels> ~100mb, temperatures, and binary           
!     species parameters (see taumol.f for definition).  the first               
!     index in the array, js, runs from 1 to 9, and corresponds to               
!     different values of the binary species parameter.  for instance, &        
!     js=1 refers to dry air, js = 2 corresponds to the paramter value 1/8, &   
!     js = 3 corresponds to the parameter value 2/8, etc.  the second index      
!     in the array, jt, which runs from 1 to 5, corresponds to different         
!     temperatures.  more specifically, jt = 3 means that the data are for       
!     the reference temperature tref for this  pressure level, jt = 2 refers     
!     to tref-15, jt = 1 is for tref-30, jt = 4 is for tref+15, and jt = 5       
!     is for tref+30.  the third index, jp, runs from 1 to 13 and refers         
!     to the jpth reference pressure level (see taumol.f for these levels        
!     in mb).  the fourth index, ig, goes from 1 to 16, and indicates            
!     which g-interval the absorption coefficients are for.                      

                                                                                 
!     the array selfref16 contains the coefficient of the water vapor              
!     self-continuum (including the energy term).  the first index               
!     refers to temperature in 7.2 degree increments.  for instance, &          
!     jt = 1 refers to a temperature of 245.6, jt = 2 refers to 252.8, &        
!     etc.  the second index runs over the g-channel (1 to 16).                  

         !if ( wrf_dm_on_monitor() ) read (rrtm_unit,err=9010) abscoefl16, selfref16
         !dm_bcast_macro(abscoefl16)
         !dm_bcast_macro(selfref16)
         if ( mpi_rank().eq.0 ) read (rrtm_unit,err=9010) abscoefl16_r4, selfref16_r4
         call mpi_bcast(abscoefl16_r4 , size(abscoefl16_r4), MPI_REAL8, 0, comm,ierr)
         call mpi_bcast(selfref16_r4  , size(selfref16_r4) , MPI_REAL8, 0, comm,ierr)
         abscoefl16 = abscoefl16_r4
         selfref16  = selfref16_r4
         
         if ( mpi_rank().eq.0 ) print*, "abscoefl16 is done" 

         if ( mpi_rank().eq.0 ) close (rrtm_unit)
                                                                                 
!-----------------------------------------------------------------------
                                                            
                
                                                                           
!  compute lookup tables for transmittance, tau transition function,             
!  and clear sky tau (for the cloudy sky radiative transfer).  tau is            
!  computed as a function of the tau transition function, transmittance          
!  is calculated as a function of tau, and the tau transition function           
!  is calculated using the linear in tau formulation at values of tau            
!  above 0.01.  tf is approximated as tau/6 for tau < 0.01.  all tables          
!  are computed at intervals of 0.001.  the inverse of the constant used         
!  in the pade approximation to the tau transition function is set to b.         
                                                                                 
      tau(0) = 0.0                                                               
      tau(5000) = 1.e10                                                          
      trans(0) = 1.0                                                             
      trans(5000) = 0.0                                                          
      tf(0) = 0.0                                                                
      tf(5000) = 1.0                                                             
      bpade=1./0.278                                                             
      do 1000 itre = 1,4999                                                       
         tfn = itre/5.e3                                                          
         tau(itre) = bpade*tfn/(1.-tfn)                                           
         trans(itre) = exp(-tau(itre))                                             
         if (tau(itre).lt.0.1) then                                               
            tf(itre) = tau(itre)/6.                                                
         else                                                                    
            tf(itre) = 1.-2.*((1./tau(itre))-(trans(itre)/(1.-trans(itre))))         
         endif                                                                   
 1000 continue                                                                   
!  calculate lookup tables for functions needed in routine taumol (taugb2)       
      corr1(0) = 1.                                                              
      corr1(200) = 1.                                                            
      corr2(0) = 1.                                                              
      corr2(200) = 1.                                                            
      do 1200 i = 1,199                                                          
         fp = 0.005*float(i)                                                     
         rtfp = sqrt(fp)                                                         
         corr1(i) = rtfp/fp                                                      
         corr2(i) = (1.-rtfp)/(1.-fp)                                            
 1200 continue                                                                   
                                                                                 
!  perform g-point reduction from 16 per band (256 total points) to              
!  a band dependant number (140 total points) for all absorption                 
!  coefficient input data and planck fraction input data.                        
!  compute relative weighting for new g-point combinations.                      
                                                                                 
      igcsm = 0                                                                  
      do 500 ibnd = 1,nbands                                                     
         iprsm = 0                                                               
         if (ngc(ibnd).lt.16) then                                               
            do 450 igc = 1,ngc(ibnd)                                             
               igcsm = igcsm + 1                                                 
               wtsum = 0.                                                        
               do 420 ipr = 1, ngn(igcsm)                                        
                  iprsm = iprsm + 1                                              
                  wtsum = wtsum + wt(iprsm)                                      
 420           continue                                                          
               wtsm(igc) = wtsum                                                 
 450        continue                                                             
            do 400 ig = 1,ng(ibnd)                                               
               ind = (ibnd-1)*16 + ig                                            
               rwgt(ind) = wt(ig)/wtsm(ngm(ind))                                 
 400        continue                                                             
         else                                                                    
            do 300 ig = 1,ng(ibnd)                                               
               igcsm = igcsm + 1                                                 
               ind = (ibnd-1)*16 + ig                                            
               rwgt(ind) = 1.0                                                   
 300        continue                                                             
         endif                                                                   
 500  continue                                                                   
                                                                                 
!  reduce g-points for relevant data in each lw spectral band.                   
      if(mpi_rank().eq.0) print*,"reducing g-points data"
                                                                                 
      call cmbgb1 (abscoefl1,   abscoefh1,  selfref1,                   &
                   fracrefa1,   fracrefb1,  forref1,                    &
                   selfrefc1,  forrefc1, fracrefac1,                    &
                   fracrefbc1   &
                  )
      call cmbgb2 (abscoefl2,   abscoefh2,  selfref2,                   &
                   fracrefa2,   fracrefb2,  forref2,                    &
                   selfrefc2,  forrefc2, fracrefac2,                    &
                   fracrefbc2   &
                  )
      call cmbgb3 (abscoefl3,   abscoefh3,  selfref3,                   &
                   fracrefa3,   fracrefb3,                              &
                   forref3,     absn2oa3,   absn2ob3,                   &
                   selfrefc3,  forrefc3,                                &
                   absn2oac3,   absn2obc3,  fracrefac3, fracrefbc3      &
                  )
      call cmbgb4 (abscoefl4,   abscoefh4,  selfref4,                   &
                   fracrefa4,   fracrefb4,                              &
                   selfrefc4,  fracrefac4, fracrefbc4                   &
                  )
      call cmbgb5 (abscoefl5,   abscoefh5,  selfref5,                   &
                   fracrefa5,   fracrefb5,  ccl45,                      &
                   selfrefc5,  ccl4c5, fracrefac5,                      &
                   fracrefbc5   &
                  )
      call cmbgb6 (abscoefl6,               selfref6,                   &
                   fracrefa6,   absco26,    cfc11adj6, cfc126,          &
                   selfrefc6, absco2c6, cfc11adjc6, cfc12c6,            &
                   fracrefac6   &
                  )
      call cmbgb7 (abscoefl7,   abscoefh7,  selfref7,                   &
                   fracrefa7,   fracrefb7,  absco27,                    &
                   selfrefc7,  absco2c7, fracrefac7,                    &
                   fracrefbc7   &
                  )
      call cmbgb8 (abscoefl8,   abscoefh8,  selfref8,                   &
                   fracrefa8,   fracrefb8,  absco2a8, absco2b8,         &
                   absn2oa8,    absn2ob8,   cfc128,   cfc22adj8,        &
                   selfrefc8,  absco2ac8, absco2bc8,                    &
                   absn2oac8,   absn2obc8,  cfc12c8,   cfc22adjc8,      &
                   fracrefac8, fracrefbc8                               &
                  )
      call cmbgb9 (abscoefl9,   abscoefh9,  selfref9,                   &
                   fracrefa9,   fracrefb9,  absn2o9,                    &
                   selfrefc9,  absn2oc9, fracrefac9,                    &
                   fracrefbc9                                           &
                  )  
      call cmbgb10(abscoefl10, abscoefh10,                              &
                   fracrefa10, fracrefb10,                              &
                   fracrefac10, fracrefbc10                             &
                  )
      call cmbgb11(abscoefl11, abscoefh11, selfref11,                   &
                   fracrefa11, fracrefb11,                              &
                   selfrefc11,  fracrefac11,                            &
                   fracrefbc11  &
                  )
      call cmbgb12(abscoefl12,             selfref12,                   &
                   fracrefa12,                                          &
                   selfrefc12, fracrefac12                              &
                  )
      call cmbgb13(abscoefl13,             selfref13,                   &
                   fracrefa13,                                          &
                   selfrefc13, fracrefac13                              &
                  )
      call cmbgb14(abscoefl14, abscoefh14, selfref14,                   &
                   fracrefa14, fracrefb14,                              &
                   selfrefc14, fracrefac14,                             &
                   fracrefbc14 &
                  )
      call cmbgb15(abscoefl15,             selfref15,                   &
                   fracrefa15,                                          &
                   selfrefc15, fracrefac15                              &
                  )
      call cmbgb16(abscoefl16,             selfref16,                   &
                   fracrefa16,                                          &
                   selfrefc16, fracrefac16                              &
                  )
      if(mpi_rank().eq.0) print*,"after reducing g-points data"
      return
9010 continue
     write( errmess , '(a35,i4)' ) 'module_ra_rrtm: error reading unit ',rrtm_unit
     call endrun(errmess)
      end subroutine rrtm_lookuptable

!------------------------------------------------------------------

end module module_ra_rrtm_v2
